/*! full_ui_all.js
 * contains the following files: Detector.js, CanvasRenderer.js, TrackballControls.js, OrthographicTrackballControls.js, Projector.js, icn3d.js, full_ui.js
 */
/*! Detector.js
 * @author alteredq / http://alteredqualia.com/
 * @author mr.doob / http://mrdoob.com/
 */
var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:(function(){try{var a=document.createElement("canvas");return !!(window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl")))}catch(b){return false}})(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var a=document.createElement("div");a.id="webgl-error-message";a.style.fontFamily="monospace";a.style.fontSize="13px";a.style.fontWeight="normal";a.style.textAlign="center";a.style.background="#fff";a.style.color="#000";a.style.padding="1.5em";a.style.width="400px";a.style.margin="5em auto 0";if(!this.webgl){a.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")}return a},addGetWebGLMessage:function(c){var b,d,a;c=c||{};b=c.parent!==undefined?c.parent:document.body;d=c.id!==undefined?c.id:"oldie";a=Detector.getWebGLErrorMessage();a.id=d;b.appendChild(a)}};if(typeof module==="object"){module.exports=Detector;
/*! CanvasRenderer.js
 * @author mrdoob / http://mrdoob.com/
 */
}THREE.SpriteCanvasMaterial=function(a){THREE.Material.call(this);this.type="SpriteCanvasMaterial";this.color=new THREE.Color(16777215);this.program=function(c,b){};this.setValues(a)};THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial;THREE.SpriteCanvasMaterial.prototype.clone=function(){var a=new THREE.SpriteCanvasMaterial();a.copy(this);a.color.copy(this.color);a.program=this.program;return a};THREE.CanvasRenderer=function(H){var aE=THREE.Math.smoothstep;H=H||{};var z=this,E,J,n,a=new THREE.Projector(),j=H.canvas!==undefined?H.canvas:document.createElement("canvas"),C=j.width,aD=j.height,al=Math.floor(C/2),M=Math.floor(aD/2),c=0,b=0,aG=C,B=aD,p=1,g=j.getContext("2d",{alpha:H.alpha===true}),K=new THREE.Color(0),az=H.alpha===true?0:1,aF=1,aB=0,A=null,aA=null,O=null,l=null,aw=null,T=[],aN,ak,aj,ah,ag,af=new THREE.RenderableVertex(),ad=new THREE.RenderableVertex(),y,x,f,d,aM,aK,ay,ax,Y,W,S,Q,h=new THREE.Color(),u=new THREE.Color(),t=new THREE.Color(),r=new THREE.Color(),q=new THREE.Color(),ab=new THREE.Color(),v=new THREE.Color(),at=new THREE.Color(),L={},ac,k,aL,aI,av,ar,X,V,aP=new THREE.Box2(),w=new THREE.Box2(),D=new THREE.Box2(),aH=new THREE.Color(),G=new THREE.Color(),ai=new THREE.Color(),m=new THREE.Vector3(),aQ=new THREE.Vector3(),aa=new THREE.Vector3(),R=new THREE.Matrix3();if(g.setLineDash===undefined){g.setLineDash=function(){}}this.domElement=j;this.autoClear=true;this.sortObjects=true;this.sortElements=true;this.info={render:{vertices:0,faces:0}};this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.getContext=function(){return g};this.getContextAttributes=function(){return g.getContextAttributes()};this.getPixelRatio=function(){return p};this.setPixelRatio=function(aS){if(aS!==undefined){p=aS}};this.setSize=function(aT,aS,aU){C=aT*p;aD=aS*p;j.width=C;j.height=aD;al=Math.floor(C/2);M=Math.floor(aD/2);if(aU!==false){j.style.width=aT+"px";j.style.height=aS+"px"}aP.min.set(-al,-M);aP.max.set(al,M);w.min.set(-al,-M);w.max.set(al,M);aF=1;aB=0;A=null;aA=null;O=null;l=null;aw=null;this.setViewport(0,0,aT,aS)};this.setViewport=function(aT,aV,aU,aS){c=aT*p;b=aV*p;aG=aU*p;B=aS*p};this.setScissor=function(){};this.enableScissorTest=function(){};this.setClearColor=function(aS,aT){K.set(aS);az=aT!==undefined?aT:1;w.min.set(-al,-M);w.max.set(al,M)};this.setClearColorHex=function(aS,aT){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");this.setClearColor(aS,aT)};this.getClearColor=function(){return K};this.getClearAlpha=function(){return az};this.getMaxAnisotropy=function(){return 0};this.clear=function(){if(w.empty()===false){w.intersect(aP);w.expandByScalar(2);w.min.x=w.min.x+al;w.min.y=-w.min.y+M;w.max.x=w.max.x+al;w.max.y=-w.max.y+M;if(az<1){g.clearRect(w.min.x|0,w.max.y|0,(w.max.x-w.min.x)|0,(w.min.y-w.max.y)|0)}if(az>0){ao(THREE.NormalBlending);F(1);am("rgba("+Math.floor(K.r*255)+","+Math.floor(K.g*255)+","+Math.floor(K.b*255)+","+az+")");g.fillRect(w.min.x|0,w.max.y|0,(w.max.x-w.min.x)|0,(w.min.y-w.max.y)|0)}w.makeEmpty()}};this.clearColor=function(){};this.clearDepth=function(){};this.clearStencil=function(){};this.render=function(aX,aV){if(aV instanceof THREE.Camera===false){console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");return}if(this.autoClear===true){this.clear()}z.info.render.vertices=0;z.info.render.faces=0;g.setTransform(aG/C,0,0,-B/aD,c,aD-b);g.translate(al,M);E=a.projectScene(aX,aV,this.sortObjects,this.sortElements);J=E.elements;n=E.lights;aN=aV;R.getNormalMatrix(aV.matrixWorldInverse);aq();for(var aW=0,aU=J.length;aW<aU;aW++){var aS=J[aW];var aT=aS.material;if(aT===undefined||aT.opacity===0){continue}D.makeEmpty();if(aS instanceof THREE.RenderableSprite){ak=aS;ak.x*=al;ak.y*=M;o(ak,aS,aT)}else{if(aS instanceof THREE.RenderableLine){ak=aS.v1;aj=aS.v2;ak.positionScreen.x*=al;ak.positionScreen.y*=M;aj.positionScreen.x*=al;aj.positionScreen.y*=M;D.setFromPoints([ak.positionScreen,aj.positionScreen]);if(aP.isIntersectionBox(D)===true){au(ak,aj,aS,aT)}}else{if(aS instanceof THREE.RenderableFace){ak=aS.v1;aj=aS.v2;ah=aS.v3;if(ak.positionScreen.z<-1||ak.positionScreen.z>1){continue}if(aj.positionScreen.z<-1||aj.positionScreen.z>1){continue}if(ah.positionScreen.z<-1||ah.positionScreen.z>1){continue}ak.positionScreen.x*=al;ak.positionScreen.y*=M;aj.positionScreen.x*=al;aj.positionScreen.y*=M;ah.positionScreen.x*=al;ah.positionScreen.y*=M;if(aT.overdraw>0){an(ak.positionScreen,aj.positionScreen,aT.overdraw);an(aj.positionScreen,ah.positionScreen,aT.overdraw);an(ah.positionScreen,ak.positionScreen,aT.overdraw)}D.setFromPoints([ak.positionScreen,aj.positionScreen,ah.positionScreen]);if(aP.isIntersectionBox(D)===true){aR(ak,aj,ah,0,1,2,aS,aT)}}}}w.union(D)}g.setTransform(1,0,0,1,0,0)};function aq(){aH.setRGB(0,0,0);G.setRGB(0,0,0);ai.setRGB(0,0,0);for(var aU=0,aV=n.length;aU<aV;aU++){var aT=n[aU];var aS=aT.color;if(aT instanceof THREE.AmbientLight){aH.add(aS)}else{if(aT instanceof THREE.DirectionalLight){G.add(aS)}else{if(aT instanceof THREE.PointLight){ai.add(aS)}}}}}function e(aS,aZ,aW){for(var aV=0,aY=n.length;aV<aY;aV++){var aU=n[aV];at.copy(aU.color);if(aU instanceof THREE.DirectionalLight){var aT=m.setFromMatrixPosition(aU.matrixWorld).normalize();var aX=aZ.dot(aT);if(aX<=0){continue}aX*=aU.intensity;aW.add(at.multiplyScalar(aX))}else{if(aU instanceof THREE.PointLight){var aT=m.setFromMatrixPosition(aU.matrixWorld);var aX=aZ.dot(m.subVectors(aT,aS).normalize());if(aX<=0){continue}aX*=aU.distance==0?1:1-Math.min(aS.distanceTo(aT)/aU.distance,1);if(aX==0){continue}aX*=aU.intensity;aW.add(at.multiplyScalar(aX))}}}}function o(a4,aW,aX){F(aX.opacity);ao(aX.blending);var a6=aW.scale.x*al;var a5=aW.scale.y*M;var a0=0.5*Math.sqrt(a6*a6+a5*a5);D.min.set(a4.x-a0,a4.y-a0);D.max.set(a4.x+a0,a4.y+a0);if(aX instanceof THREE.SpriteMaterial){var aZ=aX.map;if(aZ!==null){var aY=L[aZ.id];if(aY===undefined||aY.version!==aZ.version){aY=P(aZ);L[aZ.id]=aY}if(aY.canvas!==undefined){am(aY.canvas);var a3=aZ.image;var aT=a3.width*aZ.offset.x;var aS=a3.height*aZ.offset.y;var a2=a3.width*aZ.repeat.x;var a1=a3.height*aZ.repeat.y;var aV=a6/a2;var aU=a5/a1;g.save();g.translate(a4.x,a4.y);if(aX.rotation!==0){g.rotate(aX.rotation)}g.translate(-a6/2,-a5/2);g.scale(aV,aU);g.translate(-aT,-aS);g.fillRect(aT,aS,a2,a1);g.restore()}}else{am(aX.color.getStyle());g.save();g.translate(a4.x,a4.y);if(aX.rotation!==0){g.rotate(aX.rotation)}g.scale(a6,-a5);g.fillRect(-0.5,-0.5,1,1);g.restore()}}else{if(aX instanceof THREE.SpriteCanvasMaterial){aC(aX.color.getStyle());am(aX.color.getStyle());g.save();g.translate(a4.x,a4.y);if(aX.rotation!==0){g.rotate(aX.rotation)}g.scale(a6,a5);aX.program(g);g.restore()}}}function au(aZ,aX,aV,aW){F(aW.opacity);ao(aW.blending);g.beginPath();g.moveTo(aZ.positionScreen.x,aZ.positionScreen.y);g.lineTo(aX.positionScreen.x,aX.positionScreen.y);if(aW instanceof THREE.LineBasicMaterial){N(aW.linewidth);ae(aW.linecap);aJ(aW.linejoin);if(aW.vertexColors!==THREE.VertexColors){aC(aW.color.getStyle())}else{var aU=aV.vertexColors[0].getStyle();var aS=aV.vertexColors[1].getStyle();if(aU===aS){aC(aU)}else{try{var aY=g.createLinearGradient(aZ.positionScreen.x,aZ.positionScreen.y,aX.positionScreen.x,aX.positionScreen.y);aY.addColorStop(0,aU);aY.addColorStop(1,aS)}catch(aT){aY=aU}aC(aY)}}g.stroke();D.expandByScalar(aW.linewidth*2)}else{if(aW instanceof THREE.LineDashedMaterial){N(aW.linewidth);ae(aW.linecap);aJ(aW.linejoin);aC(aW.color.getStyle());Z([aW.dashSize,aW.gapSize]);g.stroke();D.expandByScalar(aW.linewidth*2);Z([])}}}function aR(a0,aZ,aY,aV,aU,aT,aW,aX){z.info.render.vertices+=3;z.info.render.faces++;F(aX.opacity);ao(aX.blending);y=a0.positionScreen.x;x=a0.positionScreen.y;f=aZ.positionScreen.x;d=aZ.positionScreen.y;aM=aY.positionScreen.x;aK=aY.positionScreen.y;U(y,x,f,d,aM,aK);if((aX instanceof THREE.MeshLambertMaterial||aX instanceof THREE.MeshPhongMaterial)&&aX.map===null){ab.copy(aX.color);v.copy(aX.emissive);if(aX.vertexColors===THREE.FaceColors){ab.multiply(aW.color)}h.copy(aH);aQ.copy(a0.positionWorld).add(aZ.positionWorld).add(aY.positionWorld).divideScalar(3);e(aQ,aW.normalModel,h);h.multiply(ab).add(v);aX.wireframe===true?aO(h,aX.wireframeLinewidth,aX.wireframeLinecap,aX.wireframeLinejoin):i(h)}else{if(aX instanceof THREE.MeshBasicMaterial||aX instanceof THREE.MeshLambertMaterial||aX instanceof THREE.MeshPhongMaterial){if(aX.map!==null){var aS=aX.map.mapping;if(aS===THREE.UVMapping){k=aW.uvs;ap(y,x,f,d,aM,aK,k[aV].x,k[aV].y,k[aU].x,k[aU].y,k[aT].x,k[aT].y,aX.map)}}else{if(aX.envMap!==null){if(aX.envMap.mapping===THREE.SphericalReflectionMapping){aa.copy(aW.vertexNormalsModel[aV]).applyMatrix3(R);aL=0.5*aa.x+0.5;aI=0.5*aa.y+0.5;aa.copy(aW.vertexNormalsModel[aU]).applyMatrix3(R);av=0.5*aa.x+0.5;ar=0.5*aa.y+0.5;aa.copy(aW.vertexNormalsModel[aT]).applyMatrix3(R);X=0.5*aa.x+0.5;V=0.5*aa.y+0.5;ap(y,x,f,d,aM,aK,aL,aI,av,ar,X,V,aX.envMap)}}else{h.copy(aX.color);if(aX.vertexColors===THREE.FaceColors){h.multiply(aW.color)}aX.wireframe===true?aO(h,aX.wireframeLinewidth,aX.wireframeLinecap,aX.wireframeLinejoin):i(h)}}}else{if(aX instanceof THREE.MeshDepthMaterial){h.r=h.g=h.b=1-aE(a0.positionScreen.z*a0.positionScreen.w,aN.near,aN.far);aX.wireframe===true?aO(h,aX.wireframeLinewidth,aX.wireframeLinecap,aX.wireframeLinejoin):i(h)}else{if(aX instanceof THREE.MeshNormalMaterial){aa.copy(aW.normalModel).applyMatrix3(R);h.setRGB(aa.x,aa.y,aa.z).multiplyScalar(0.5).addScalar(0.5);aX.wireframe===true?aO(h,aX.wireframeLinewidth,aX.wireframeLinecap,aX.wireframeLinejoin):i(h)}else{h.setRGB(1,1,1);aX.wireframe===true?aO(h,aX.wireframeLinewidth,aX.wireframeLinecap,aX.wireframeLinejoin):i(h)}}}}}function U(aV,aX,aT,aW,aS,aU){g.beginPath();g.moveTo(aV,aX);g.lineTo(aT,aW);g.lineTo(aS,aU);g.closePath()}function aO(aS,aV,aU,aT){N(aV);ae(aU);aJ(aT);aC(aS.getStyle());g.stroke();D.expandByScalar(aV*2)}function i(aS){am(aS.getStyle());g.fill()}function P(aW){if(aW.version===0||aW instanceof THREE.CompressedTexture||aW instanceof THREE.DataTexture){return{canvas:undefined,version:aW.version}}var aY=aW.image;var aS=document.createElement("canvas");aS.width=aY.width;aS.height=aY.height;var aT=aS.getContext("2d");aT.setTransform(1,0,0,-1,0,aY.height);aT.drawImage(aY,0,0);var aV=aW.wrapS===THREE.RepeatWrapping;var aU=aW.wrapT===THREE.RepeatWrapping;var aX="no-repeat";if(aV===true&&aU===true){aX="repeat"}else{if(aV===true){aX="repeat-x"}else{if(aU===true){aX="repeat-y"}}}return{canvas:g.createPattern(aS,aX),version:aW.version}}function ap(ba,aX,a7,aW,a4,aU,a6,aV,a3,aT,a2,aS,aZ){var a5=L[aZ.id];if(a5===undefined||a5.version!==aZ.version){a5=P(aZ);L[aZ.id]=a5}if(a5.canvas!==undefined){am(a5.canvas)}else{am("rgba( 0, 0, 0, 1)");g.fill();return}var bh,bg,bf,be,bc,a9,aY,bd,bb=aZ.offset.x/aZ.repeat.x,a8=aZ.offset.y/aZ.repeat.y,a1=aZ.image.width*aZ.repeat.x,a0=aZ.image.height*aZ.repeat.y;a6=(a6+bb)*a1;aV=(aV+a8)*a0;a3=(a3+bb)*a1;aT=(aT+a8)*a0;a2=(a2+bb)*a1;aS=(aS+a8)*a0;a7-=ba;aW-=aX;a4-=ba;aU-=aX;a3-=a6;aT-=aV;a2-=a6;aS-=aV;aY=a3*aS-a2*aT;if(aY===0){return}bd=1/aY;bh=(aS*a7-aT*a4)*bd;bg=(aS*aW-aT*aU)*bd;bf=(a3*a4-a2*a7)*bd;be=(a3*aU-a2*aW)*bd;bc=ba-bh*a6-bf*aV;a9=aX-bg*a6-be*aV;g.save();g.transform(bh,bg,bf,be,bc,a9);g.fill();g.restore()}function I(a8,aX,a6,aW,a4,aU,a5,aV,a3,aT,a2,aS,a0){var be,bd,bc,bb,a9,a7,aY,ba,a1=a0.width-1,aZ=a0.height-1;a5*=a1;aV*=aZ;a3*=a1;aT*=aZ;a2*=a1;aS*=aZ;a6-=a8;aW-=aX;a4-=a8;aU-=aX;a3-=a5;aT-=aV;a2-=a5;aS-=aV;aY=a3*aS-a2*aT;ba=1/aY;be=(aS*a6-aT*a4)*ba;bd=(aS*aW-aT*aU)*ba;bc=(a3*a4-a2*a6)*ba;bb=(a3*aU-a2*aW)*ba;a9=a8-be*a5-bc*aV;a7=aX-bd*a5-bb*aV;g.save();g.transform(be,bd,bc,bb,a9,a7);g.clip();g.drawImage(a0,0,0);g.restore()}function an(aY,aV,aX){var aS=aV.x-aY.x,aW=aV.y-aY.y,aT=aS*aS+aW*aW,aU;if(aT===0){return}aU=aX/Math.sqrt(aT);aS*=aU;aW*=aU;aV.x+=aS;aV.y+=aW;aY.x-=aS;aY.y-=aW}function F(aS){if(aF!==aS){g.globalAlpha=aS;aF=aS}}function ao(aS){if(aB!==aS){if(aS===THREE.NormalBlending){g.globalCompositeOperation="source-over"}else{if(aS===THREE.AdditiveBlending){g.globalCompositeOperation="lighter"}else{if(aS===THREE.SubtractiveBlending){g.globalCompositeOperation="darker"}}}aB=aS}}function N(aS){if(O!==aS){g.lineWidth=aS;O=aS}}function ae(aS){if(l!==aS){g.lineCap=aS;l=aS}}function aJ(aS){if(aw!==aS){g.lineJoin=aS;aw=aS}}function aC(aS){if(A!==aS){g.strokeStyle=aS;A=aS}}function am(aS){if(aA!==aS){g.fillStyle=aS;aA=aS}}function Z(aS){if(T.length!==aS.length){g.setLineDash(aS);T=aS}}};
/*! TrackballControls.js from three.js
 * @author Eberhard Graether / http://egraether.com/
 * @author Mark Lundin  / http://mark-lundin.com
 */
THREE.TrackballControls=function(y,x,j){var r=this;this.STATE={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=y;this.domElement=(x!==undefined)?x:document;this.enabled=true;this.screen={left:0,top:0,width:0,height:0};this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=0.3;this.noRotate=false;this.noZoom=false;this.noPan=false;this.noRoll=false;this.staticMoving=false;this.dynamicDampingFactor=0.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new THREE.Vector3();var l=0.000001;var k=new THREE.Vector3();this._state=this.STATE.NONE;var m=this.STATE.NONE;var a=new THREE.Vector3();this._rotateStart=new THREE.Vector3();this._rotateEnd=new THREE.Vector3();this._zoomStart=new THREE.Vector2();this._zoomEnd=new THREE.Vector2();var h=0;var d=0;this._panStart=new THREE.Vector2();this._panEnd=new THREE.Vector2();this.target0=this.target.clone();this.position0=this.object.position.clone();this.up0=this.object.up.clone();var w={type:"change"};var n={type:"start"};var g={type:"end"};this.handleResize=function(){if(this.domElement===document){this.screen.left=0;this.screen.top=0;this.screen.width=window.innerWidth;this.screen.height=window.innerHeight}else{var z=this.domElement.getBoundingClientRect();var A=this.domElement.ownerDocument.documentElement;this.screen.left=z.left+window.pageXOffset-A.clientLeft;this.screen.top=z.top+window.pageYOffset-A.clientTop;this.screen.width=z.width;this.screen.height=z.height}};this.handleEvent=function(z){if(typeof this[z.type]==="function"){this[z.type](z)}};var c=(function(){var z=new THREE.Vector2();return function(B,A){z.set((B-r.screen.left)/r.screen.width,(A-r.screen.top)/r.screen.height);return z}}());var b=(function(){var A=new THREE.Vector3();var z=new THREE.Vector3();var B=new THREE.Vector3();return function(D,C){B.set((D-r.screen.width*0.5-r.screen.left)/(r.screen.width*0.5),(r.screen.height*0.5+r.screen.top-C)/(r.screen.height*0.5),0);var E=B.length();if(r.noRoll){if(E<Math.SQRT1_2){B.z=Math.sqrt(1-E*E)}else{B.z=0.5/E}}else{if(E>1){B.normalize()}else{B.z=Math.sqrt(1-E*E)}}a.copy(r.object.position).sub(r.target);A.copy(r.object.up).setLength(B.y);A.add(z.copy(r.object.up).cross(a).setLength(B.x));A.add(a.setLength(B.z));return A}}());this.rotateCamera=(function(B,C){var z=new THREE.Vector3(),A=new THREE.Quaternion();return function(E,F){var D;if(E===undefined){D=Math.acos(r._rotateStart.dot(r._rotateEnd)/r._rotateStart.length()/r._rotateEnd.length())}if(D||E!==undefined){if(E===undefined){z.crossVectors(r._rotateStart,r._rotateEnd).normalize();D*=r.rotateSpeed;A.setFromAxisAngle(z,-D)}else{A.copy(E)}if(F===undefined||F===true){j.quaternion.multiplyQuaternions(A,j.quaternion)}a.applyQuaternion(A);r.object.up.applyQuaternion(A);r._rotateEnd.applyQuaternion(A);if(r.staticMoving){r._rotateStart.copy(r._rotateEnd)}else{A.setFromAxisAngle(z,D*(r.dynamicDampingFactor-1));r._rotateStart.applyQuaternion(A)}}}}());this.zoomCamera=function(A,B){if(r._state===r.STATE.TOUCH_ZOOM_PAN){var z;if(A!==undefined){z=A}else{z=h/d;h=d}a.multiplyScalar(z);if(B===undefined||B===true){j._zoomFactor*=z}}else{var z;if(A!==undefined){z=A}else{z=1+(r._zoomEnd.y-r._zoomStart.y)*r.zoomSpeed}if(B===undefined||B===true){j._zoomFactor*=z}if(z!==1){a.multiplyScalar(z);if(r.staticMoving){r._zoomStart.copy(r._zoomEnd)}else{r._zoomStart.y+=(r._zoomEnd.y-r._zoomStart.y)*this.dynamicDampingFactor}}}};this.panCamera=(function(A,D){var B=new THREE.Vector2(),z=new THREE.Vector3(),C=new THREE.Vector3();return function(E,F){if(E!==undefined){B=E;if(F===undefined||F===true){j.mouseChange.add(E)}}else{B.copy(r._panEnd).sub(r._panStart);if(F===undefined||F===true){j.mouseChange.add(r._panEnd).sub(r._panStart)}}if(B.lengthSq()){B.multiplyScalar(a.length()*r.panSpeed);C.copy(a).cross(r.object.up).setLength(B.x);C.add(z.copy(r.object.up).setLength(B.y));r.object.position.add(C);r.target.add(C);if(r.staticMoving){r._panStart.copy(r._panEnd)}else{r._panStart.add(B.subVectors(r._panEnd,r._panStart).multiplyScalar(r.dynamicDampingFactor))}}}}());this.checkDistances=function(){if(!r.noZoom||!r.noPan){if(a.lengthSq()>r.maxDistance*r.maxDistance){r.object.position.addVectors(r.target,a.setLength(r.maxDistance))}if(a.lengthSq()<r.minDistance*r.minDistance){r.object.position.addVectors(r.target,a.setLength(r.minDistance))}}};this.update=function(z){a.subVectors(r.object.position,r.target);if(!r.noRotate){if(z!==undefined&&z.quaternion!==undefined){r.rotateCamera(z.quaternion,z.update)}else{r.rotateCamera()}}if(!r.noZoom){if(z!==undefined&&z._zoomFactor!==undefined){r.zoomCamera(z._zoomFactor,z.update)}else{r.zoomCamera()}}if(!r.noPan){if(z!==undefined&&z.mouseChange!==undefined){r.panCamera(z.mouseChange,z.update)}else{r.panCamera()}}r.object.position.addVectors(r.target,a);r.checkDistances();r.object.lookAt(r.target);if(k.distanceToSquared(r.object.position)>l){r.dispatchEvent(w);k.copy(r.object.position)}};this.reset=function(){r._state=r.STATE.NONE;m=r.STATE.NONE;r.target.copy(r.target0);r.object.position.copy(r.position0);r.object.up.copy(r.up0);a.subVectors(r.object.position,r.target);r.object.lookAt(r.target);r.dispatchEvent(w);k.copy(r.object.position)};function i(z){if(r.enabled===false){return}window.removeEventListener("keydown",i);m=r._state;if(r._state!==r.STATE.NONE){return}else{if(z.keyCode===r.keys[r.STATE.ROTATE]&&!r.noRotate){r._state=r.STATE.ROTATE}else{if((z.keyCode===r.keys[r.STATE.ZOOM]||z.shiftKey)&&!r.noZoom){r._state=r.STATE.ZOOM}else{if((z.keyCode===r.keys[r.STATE.PAN]||z.ctrlKey)&&!r.noPan){r._state=r.STATE.PAN}}}}}function e(z){if(r.enabled===false){return}r._state=m;window.addEventListener("keydown",i,false)}function p(z){if(r.enabled===false){return}z.preventDefault();z.stopPropagation();if(r._state===r.STATE.NONE){r._state=z.button}if(r._state===r.STATE.ROTATE&&!r.noRotate){r._rotateStart.copy(b(z.pageX,z.pageY));r._rotateEnd.copy(r._rotateStart)}else{if(r._state===r.STATE.ZOOM&&!r.noZoom){r._zoomStart.copy(c(z.pageX,z.pageY));r._zoomEnd.copy(r._zoomStart)}else{if(r._state===r.STATE.PAN&&!r.noPan){r._panStart.copy(c(z.pageX,z.pageY));r._panEnd.copy(r._panStart)}}}document.addEventListener("mousemove",u,false);document.addEventListener("mouseup",q,false);r.dispatchEvent(n)}function u(z){if(r.enabled===false){return}z.preventDefault();z.stopPropagation();if(r._state===r.STATE.ROTATE&&!r.noRotate){r._rotateEnd.copy(b(z.pageX,z.pageY))}else{if(r._state===r.STATE.ZOOM&&!r.noZoom){r._zoomEnd.copy(c(z.pageX,z.pageY))}else{if(r._state===r.STATE.PAN&&!r.noPan){r._panEnd.copy(c(z.pageX,z.pageY))}}}}function q(z){if(r.enabled===false){return}z.preventDefault();z.stopPropagation();r._state=r.STATE.NONE;document.removeEventListener("mousemove",u);document.removeEventListener("mouseup",q);r.dispatchEvent(g)}function o(z){if(r.enabled===false){return}z.preventDefault();z.stopPropagation();var A=0;if(z.wheelDelta){A=z.wheelDelta/40}else{if(z.detail){A=-z.detail/3}}r._zoomStart.y=A*0.01;r.dispatchEvent(n);r.dispatchEvent(g)}function t(C){if(r.enabled===false){return}switch(C.touches.length){case 1:r._state=r.STATE.TOUCH_ROTATE;r._rotateStart.copy(b(C.touches[0].pageX,C.touches[0].pageY));r._rotateEnd.copy(r._rotateStart);break;case 2:r._state=r.STATE.TOUCH_ZOOM_PAN;var B=C.touches[0].pageX-C.touches[1].pageX;var A=C.touches[0].pageY-C.touches[1].pageY;d=h=Math.sqrt(B*B+A*A);var z=(C.touches[0].pageX+C.touches[1].pageX)/2;var D=(C.touches[0].pageY+C.touches[1].pageY)/2;r._panStart.copy(c(z,D));r._panEnd.copy(r._panStart);break;default:r._state=r.STATE.NONE}r.dispatchEvent(n)}function f(C){if(r.enabled===false){return}C.preventDefault();C.stopPropagation();switch(C.touches.length){case 1:r._rotateEnd.copy(b(C.touches[0].pageX,C.touches[0].pageY));break;case 2:var B=C.touches[0].pageX-C.touches[1].pageX;var A=C.touches[0].pageY-C.touches[1].pageY;d=Math.sqrt(B*B+A*A);var z=(C.touches[0].pageX+C.touches[1].pageX)/2;var D=(C.touches[0].pageY+C.touches[1].pageY)/2;r._panEnd.copy(c(z,D));break;default:r._state=r.STATE.NONE}}function v(A){if(r.enabled===false){return}switch(A.touches.length){case 1:r._rotateEnd.copy(b(A.touches[0].pageX,A.touches[0].pageY));r._rotateStart.copy(r._rotateEnd);break;case 2:h=d=0;var z=(A.touches[0].pageX+A.touches[1].pageX)/2;var B=(A.touches[0].pageY+A.touches[1].pageY)/2;r._panEnd.copy(c(z,B));r._panStart.copy(r._panEnd);break}r._state=r.STATE.NONE;r.dispatchEvent(g)}this.domElement.addEventListener("contextmenu",function(z){z.preventDefault()},false);this.domElement.addEventListener("mousedown",p,false);this.domElement.addEventListener("mousewheel",o,false);this.domElement.addEventListener("DOMMouseScroll",o,false);this.domElement.addEventListener("touchstart",t,false);this.domElement.addEventListener("touchend",v,false);this.domElement.addEventListener("touchmove",f,false);window.addEventListener("keydown",i,false);window.addEventListener("keyup",e,false);this.handleResize();this.update()};THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.TrackballControls.prototype.constructor=THREE.TrackballControls;
/*! OrthographicTrackballControls.js from three.js
 * @author Eberhard Graether / http://egraether.com/
 * @author Mark Lundin  / http://mark-lundin.com
 * @author Patrick Fuller / http://patrick-fuller.com
 */
THREE.OrthographicTrackballControls=function(B,z,k){var t=this;var u={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=B;this.domElement=(z!==undefined)?z:document;this.enabled=true;this.screen={left:0,top:0,width:0,height:0};this.rotateSpeed=0.5;this.zoomSpeed=1.2;var A=0.01;this.zoomSpeed*=A;this.panSpeed=0.03;this.noRotate=false;this.noZoom=false;this.noPan=false;this.noRoll=false;this.staticMoving=false;this.dynamicDampingFactor=0.2;this.keys=[65,83,68];this.target=new THREE.Vector3();var m=0.000001;var l=new THREE.Vector3();this._state=u.NONE;var n=u.NONE;var b=new THREE.Vector3();this._rotateStart=new THREE.Vector3();this._rotateEnd=new THREE.Vector3();this._zoomStart=new THREE.Vector2();this._zoomEnd=new THREE.Vector2();var i=1;var j=0;var d=0;this._panStart=new THREE.Vector2();this._panEnd=new THREE.Vector2();this.target0=this.target.clone();this.position0=this.object.position.clone();this.up0=this.object.up.clone();this.left0=this.object.left;this.right0=this.object.right;this.top0=this.object.top;this.bottom0=this.object.bottom;this.center0=new THREE.Vector2((this.left0+this.right0)/2,(this.top0+this.bottom0)/2);var y={type:"change"};var o={type:"start"};var h={type:"end"};this.handleResize=function(){if(this.domElement===document){this.screen.left=0;this.screen.top=0;this.screen.width=window.innerWidth;this.screen.height=window.innerHeight}else{var C=this.domElement.getBoundingClientRect();var D=this.domElement.ownerDocument.documentElement;this.screen.left=C.left+window.pageXOffset-D.clientLeft;this.screen.top=C.top+window.pageYOffset-D.clientTop;this.screen.width=C.width;this.screen.height=C.height}this.left0=this.object.left;this.right0=this.object.right;this.top0=this.object.top;this.bottom0=this.object.bottom;this.center0.set((this.left0+this.right0)/2,(this.top0+this.bottom0)/2)};this.handleEvent=function(C){if(typeof this[C.type]==="function"){this[C.type](C)}};var c=(function(){var C=new THREE.Vector2();return function(E,D){C.set((E-t.screen.left)/t.screen.width,(D-t.screen.top)/t.screen.height);return C}}());var a=(function(){var D=new THREE.Vector3();var C=new THREE.Vector3();var E=new THREE.Vector3();return function(G,F){E.set((G-t.screen.width*0.5-t.screen.left)/(t.screen.width*0.5),(t.screen.height*0.5+t.screen.top-F)/(t.screen.height*0.5),0);var H=E.length();if(t.noRoll){if(H<Math.SQRT1_2){E.z=Math.sqrt(1-H*H)}else{E.z=0.5/H}}else{if(H>1){E.normalize()}else{E.z=Math.sqrt(1-H*H)}}b.copy(t.object.position).sub(t.target);D.copy(t.object.up).setLength(E.y);D.add(C.copy(t.object.up).cross(b).setLength(E.x));D.add(b.setLength(E.z));return D}}());this.rotateCamera=(function(E,F){var C=new THREE.Vector3(),D=new THREE.Quaternion();return function(H,I){var G;if(H===undefined){G=Math.acos(t._rotateStart.dot(t._rotateEnd)/t._rotateStart.length()/t._rotateEnd.length())}if(G||H!==undefined){if(H===undefined){C.crossVectors(t._rotateStart,t._rotateEnd).normalize();G*=t.rotateSpeed;D.setFromAxisAngle(C,-G)}else{D.copy(H)}if(I===undefined||I===true){k.quaternion.multiplyQuaternions(D,k.quaternion)}b.applyQuaternion(D);t.object.up.applyQuaternion(D);t._rotateEnd.applyQuaternion(D);if(t.staticMoving){t._rotateStart.copy(t._rotateEnd)}else{D.setFromAxisAngle(C,G*(t.dynamicDampingFactor-1));t._rotateStart.applyQuaternion(D)}}}}());this.zoomCamera=function(D,E){var C;if(t._state===u.TOUCH_ZOOM_PAN){if(D!==undefined){C=D}else{C=j/d;j=d}}else{if(D!==undefined){C=D}else{C=1+(t._zoomEnd.y-t._zoomStart.y)*t.zoomSpeed/A}}if(E===undefined||E===true){k._zoomFactor*=C}if(C!==1){i=C;t.object.left=i*t.left0+(1-i)*t.center0.x;t.object.right=i*t.right0+(1-i)*t.center0.x;t.object.top=i*t.top0+(1-i)*t.center0.y;t.object.bottom=i*t.bottom0+(1-i)*t.center0.y;if(t.staticMoving){t._zoomStart.copy(t._zoomEnd)}else{t._zoomStart.y+=(t._zoomEnd.y-t._zoomStart.y)*this.dynamicDampingFactor}}};this.panCamera=(function(D,G){var E=new THREE.Vector2(),C=new THREE.Vector3(),F=new THREE.Vector3();return function(H,I){if(H!==undefined){E=H;if(I===undefined||I===true){k.mouseChange.add(H)}}else{E.copy(t._panEnd).sub(t._panStart);if(I===undefined||I===true){k.mouseChange.add(t._panEnd).sub(t._panStart)}}if(E.lengthSq()){E.multiplyScalar(b.length()*t.panSpeed);F.copy(b).cross(t.object.up).setLength(E.x);F.add(C.copy(t.object.up).setLength(E.y));t.object.position.add(F);t.target.add(F);if(t.staticMoving){t._panStart.copy(t._panEnd)}else{t._panStart.add(E.subVectors(t._panEnd,t._panStart).multiplyScalar(t.dynamicDampingFactor))}}}}());this.update=function(C){b.subVectors(t.object.position,t.target);if(!t.noRotate){if(C!==undefined&&C.quaternion!==undefined){t.rotateCamera(C.quaternion,C.update)}else{t.rotateCamera()}}if(!t.noZoom){if(C!==undefined&&C._zoomFactor!==undefined){t.zoomCamera(C._zoomFactor,C.update)}else{t.zoomCamera()}t.object.updateProjectionMatrix()}if(!t.noPan){if(C!==undefined&&C.mouseChange!==undefined){t.panCamera(C.mouseChange,C.update)}else{t.panCamera()}}t.object.position.addVectors(t.target,b);t.object.lookAt(t.target);if(l.distanceToSquared(t.object.position)>m){t.dispatchEvent(y);l.copy(t.object.position)}};this.reset=function(){t._state=u.NONE;n=u.NONE;t.target.copy(t.target0);t.object.position.copy(t.position0);t.object.up.copy(t.up0);b.subVectors(t.object.position,t.target);t.object.left=t.left0;t.object.right=t.right0;t.object.top=t.top0;t.object.bottom=t.bottom0;t.object.lookAt(t.target);t.dispatchEvent(y);l.copy(t.object.position)};function g(C){if(t.enabled===false){return}window.removeEventListener("keydown",g);n=t._state;if(t._state!==u.NONE){return}else{if(C.keyCode===t.keys[u.ROTATE]&&!t.noRotate){t._state=u.ROTATE}else{if((C.keyCode===t.keys[u.ZOOM]||C.shiftKey)&&!t.noZoom){t._state=u.ZOOM}else{if((C.keyCode===t.keys[u.PAN]||C.ctrlKey)&&!t.noPan){t._state=u.PAN}}}}}function e(C){if(t.enabled===false){return}t._state=n;window.addEventListener("keydown",g,false)}function q(C){if(t.enabled===false){return}C.preventDefault();C.stopPropagation();if(t._state===u.NONE){t._state=C.button}if(t._state===u.ROTATE&&!t.noRotate){t._rotateStart.copy(a(C.pageX,C.pageY));t._rotateEnd.copy(t._rotateStart)}else{if(t._state===u.ZOOM&&!t.noZoom){t._zoomStart.copy(c(C.pageX,C.pageY));t._zoomEnd.copy(t._zoomStart)}else{if(t._state===u.PAN&&!t.noPan){t._panStart.copy(c(C.pageX,C.pageY));t._panEnd.copy(t._panStart)}}}document.addEventListener("mousemove",w,false);document.addEventListener("mouseup",r,false);t.dispatchEvent(o)}function w(C){if(t.enabled===false){return}C.preventDefault();C.stopPropagation();if(t._state===u.ROTATE&&!t.noRotate){t._rotateEnd.copy(a(C.pageX,C.pageY))}else{if(t._state===u.ZOOM&&!t.noZoom){t._zoomEnd.copy(c(C.pageX,C.pageY))}else{if(t._state===u.PAN&&!t.noPan){t._panEnd.copy(c(C.pageX,C.pageY))}}}}function r(C){if(t.enabled===false){return}C.preventDefault();C.stopPropagation();t._state=u.NONE;document.removeEventListener("mousemove",w);document.removeEventListener("mouseup",r);t.dispatchEvent(h)}function p(C){if(t.enabled===false){return}C.preventDefault();C.stopPropagation();var D=0;if(C.wheelDelta){D=C.wheelDelta/40}else{if(C.detail){D=-C.detail/3}}t._zoomStart.y=D*0.01;t.dispatchEvent(o);t.dispatchEvent(h)}function v(F){if(t.enabled===false){return}switch(F.touches.length){case 1:t._state=u.TOUCH_ROTATE;t._rotateStart.copy(a(F.touches[0].pageX,F.touches[0].pageY));t._rotateEnd.copy(t._rotateStart);break;case 2:t._state=u.TOUCH_ZOOM_PAN;var E=F.touches[0].pageX-F.touches[1].pageX;var D=F.touches[0].pageY-F.touches[1].pageY;d=j=Math.sqrt(E*E+D*D);var C=(F.touches[0].pageX+F.touches[1].pageX)/2;var G=(F.touches[0].pageY+F.touches[1].pageY)/2;t._panStart.copy(c(C,G));t._panEnd.copy(t._panStart);break;default:t._state=u.NONE}t.dispatchEvent(o)}function f(F){if(t.enabled===false){return}F.preventDefault();F.stopPropagation();switch(F.touches.length){case 1:t._rotateEnd.copy(a(F.touches[0].pageX,F.touches[0].pageY));break;case 2:var E=F.touches[0].pageX-F.touches[1].pageX;var D=F.touches[0].pageY-F.touches[1].pageY;d=Math.sqrt(E*E+D*D);var C=(F.touches[0].pageX+F.touches[1].pageX)/2;var G=(F.touches[0].pageY+F.touches[1].pageY)/2;t._panEnd.copy(c(C,G));break;default:t._state=u.NONE}}function x(D){if(t.enabled===false){return}switch(D.touches.length){case 1:t._rotateEnd.copy(a(D.touches[0].pageX,D.touches[0].pageY));t._rotateStart.copy(t._rotateEnd);break;case 2:j=d=0;var C=(D.touches[0].pageX+D.touches[1].pageX)/2;var E=(D.touches[0].pageY+D.touches[1].pageY)/2;t._panEnd.copy(c(C,E));t._panStart.copy(t._panEnd);break}t._state=u.NONE;t.dispatchEvent(h)}this.domElement.addEventListener("contextmenu",function(C){C.preventDefault()},false);this.domElement.addEventListener("mousedown",q,false);this.domElement.addEventListener("mousewheel",p,false);this.domElement.addEventListener("DOMMouseScroll",p,false);this.domElement.addEventListener("touchstart",v,false);this.domElement.addEventListener("touchend",x,false);this.domElement.addEventListener("touchmove",f,false);window.addEventListener("keydown",g,false);window.addEventListener("keyup",e,false);this.handleResize();this.update()};THREE.OrthographicTrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.OrthographicTrackballControls.prototype.constructor=THREE.OrthographicTrackballControls;
/*! Projector.js from three.js
 * @author mrdoob / http://mrdoob.com/
 * @author supereggbert / http://www.paulbrunt.co.uk/
 * @author julianwa / https://github.com/julianwa
 */
THREE.RenderableObject=function(){this.id=0;this.object=null;this.z=0};THREE.RenderableFace=function(){this.id=0;this.v1=new THREE.RenderableVertex();this.v2=new THREE.RenderableVertex();this.v3=new THREE.RenderableVertex();this.normalModel=new THREE.Vector3();this.vertexNormalsModel=[new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3()];this.vertexNormalsLength=0;this.color=new THREE.Color();this.material=null;this.uvs=[new THREE.Vector2(),new THREE.Vector2(),new THREE.Vector2()];this.z=0};THREE.RenderableVertex=function(){this.position=new THREE.Vector3();this.positionWorld=new THREE.Vector3();this.positionScreen=new THREE.Vector4();this.visible=true};THREE.RenderableVertex.prototype.copy=function(a){this.positionWorld.copy(a.positionWorld);this.positionScreen.copy(a.positionScreen)};THREE.RenderableLine=function(){this.id=0;this.v1=new THREE.RenderableVertex();this.v2=new THREE.RenderableVertex();this.vertexColors=[new THREE.Color(),new THREE.Color()];this.material=null;this.z=0};THREE.RenderableSprite=function(){this.id=0;this.object=null;this.x=0;this.y=0;this.z=0;this.rotation=0;this.scale=new THREE.Vector2();this.material=null};THREE.Projector=function(){var U,D,N=[],n=0,w,c,f=[],b=0,l,B,G=[],y=0,i,Q,S=[],u=0,z,q,e=[],T=0,J={objects:[],lights:[],elements:[]},M=new THREE.Vector3(),K=new THREE.Vector3(),H=new THREE.Vector3(),L=new THREE.Vector3(),I=new THREE.Vector4(),r=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),V=new THREE.Box3(),P=new Array(3),O=new Array(4),a=new THREE.Matrix4(),g=new THREE.Matrix4(),A,C=new THREE.Matrix4(),o=new THREE.Matrix3(),R=new THREE.Frustum(),t=new THREE.Vector4(),h=new THREE.Vector4();this.projectVector=function(W,X){console.warn("THREE.Projector: .projectVector() is now vector.project().");W.project(X)};this.unprojectVector=function(W,X){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");W.unproject(X)};this.pickingRay=function(W,X){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var d=function(){var ai=[];var ae=[];var ad=null;var ag=null;var ac=new THREE.Matrix3();var aa=function(ak){ad=ak;ag=ad.material;ac.getNormalMatrix(ad.matrixWorld);ai.length=0;ae.length=0};var af=function(am){var ak=am.position;var an=am.positionWorld;var al=am.positionScreen;an.copy(ak).applyMatrix4(A);al.copy(an).applyMatrix4(g);var ao=1/al.w;al.x*=ao;al.y*=ao;al.z*=ao;am.visible=al.x>=-1&&al.x<=1&&al.y>=-1&&al.y<=1&&al.z>=-1&&al.z<=1};var X=function(ak,am,al){w=v();w.position.set(ak,am,al);af(w)};var Z=function(ak,am,al){ai.push(ak,am,al)};var Y=function(ak,al){ae.push(ak,al)};var ab=function(am,al,ak){if(am.visible===true||al.visible===true||ak.visible===true){return true}P[0]=am.positionScreen;P[1]=al.positionScreen;P[2]=ak.positionScreen;return r.isIntersectionBox(V.setFromPoints(P))};var ah=function(am,al,ak){return((ak.positionScreen.x-am.positionScreen.x)*(al.positionScreen.y-am.positionScreen.y)-(ak.positionScreen.y-am.positionScreen.y)*(al.positionScreen.x-am.positionScreen.x))<0};var aj=function(al,ak){var an=f[al];var am=f[ak];i=F();i.id=ad.id;i.v1.copy(an);i.v2.copy(am);i.z=(an.positionScreen.z+am.positionScreen.z)/2;i.material=ad.material;J.elements.push(i)};var W=function(au,ar,ap){var av=f[au];var at=f[ar];var aq=f[ap];if(ab(av,at,aq)===false){return}if(ag.side===THREE.DoubleSide||ah(av,at,aq)===true){l=k();l.id=ad.id;l.v1.copy(av);l.v2.copy(at);l.v3.copy(aq);l.z=(av.positionScreen.z+at.positionScreen.z+aq.positionScreen.z)/3;for(var an=0;an<3;an++){var am=arguments[an]*3;var ao=l.vertexNormalsModel[an];ao.set(ai[am],ai[am+1],ai[am+2]);ao.applyMatrix3(ac).normalize();var ak=arguments[an]*2;var al=l.uvs[an];al.set(ae[ak],ae[ak+1])}l.vertexNormalsLength=3;l.material=ad.material;J.elements.push(l)}};return{setObject:aa,projectVertex:af,checkTriangleVisibility:ab,checkBackfaceCulling:ah,pushVertex:X,pushNormal:Z,pushUv:Y,pushLine:aj,pushTriangle:W}};var E=new d();this.projectScene=function(at,ak,av,Z){B=0;Q=0;q=0;J.elements.length=0;if(at.autoUpdate===true){at.updateMatrixWorld()}if(ak.parent===undefined){ak.updateMatrixWorld()}a.copy(ak.matrixWorldInverse.getInverse(ak.matrixWorld));g.multiplyMatrices(ak.projectionMatrix,a);R.setFromMatrix(g);D=0;J.objects.length=0;J.lights.length=0;at.traverseVisible(function(aX){if(aX instanceof THREE.Light){J.lights.push(aX)}else{if(aX instanceof THREE.Mesh||aX instanceof THREE.Line||aX instanceof THREE.Sprite){if(aX.material.visible===false){return}if(aX.frustumCulled===false||R.intersectsObject(aX)===true){U=m();U.id=aX.id;U.object=aX;L.setFromMatrixPosition(aX.matrixWorld);L.applyProjection(g);U.z=L.z;J.objects.push(U)}}}});if(av===true){J.objects.sort(p)}for(var aJ=0,ay=J.objects.length;aJ<ay;aJ++){var aF=J.objects[aJ].object;var ag=aF.geometry;E.setObject(aF);A=aF.matrixWorld;c=0;if(aF instanceof THREE.Mesh){if(ag instanceof THREE.BufferGeometry){var aD=ag.attributes;var ap=ag.offsets;if(aD.position===undefined){continue}var ae=aD.position.array;for(var aP=0,aN=ae.length;aP<aN;aP+=3){E.pushVertex(ae[aP],ae[aP+1],ae[aP+2])}if(aD.normal!==undefined){var an=aD.normal.array;for(var aP=0,aN=an.length;aP<aN;aP+=3){E.pushNormal(an[aP],an[aP+1],an[aP+2])}}if(aD.uv!==undefined){var aC=aD.uv.array;for(var aP=0,aN=aC.length;aP<aN;aP+=2){E.pushUv(aC[aP],aC[aP+1])}}if(aD.index!==undefined){var Y=aD.index.array;if(ap.length>0){for(var aJ=0;aJ<ap.length;aJ++){var aE=ap[aJ];var aw=aE.index;for(var aP=aE.start,aN=aE.start+aE.count;aP<aN;aP+=3){E.pushTriangle(Y[aP]+aw,Y[aP+1]+aw,Y[aP+2]+aw)}}}else{for(var aP=0,aN=Y.length;aP<aN;aP+=3){E.pushTriangle(Y[aP],Y[aP+1],Y[aP+2])}}}else{for(var aP=0,aN=ae.length/3;aP<aN;aP+=3){E.pushTriangle(aP,aP+1,aP+2)}}}else{if(ag instanceof THREE.Geometry){var X=ag.vertices;var af=ag.faces;var aB=ag.faceVertexUvs[0];o.getNormalMatrix(A);var ac=aF.material instanceof THREE.MeshFaceMaterial;var ao=ac===true?aF.material:null;for(var aG=0,ai=X.length;aG<ai;aG++){var am=X[aG];E.pushVertex(am.x,am.y,am.z)}for(var aQ=0,au=af.length;aQ<au;aQ++){var ad=af[aQ];var aO=ac===true?ao.materials[ad.materialIndex]:aF.material;if(aO===undefined){continue}var aj=aO.side;var aW=f[ad.a];var aU=f[ad.b];var aS=f[ad.c];if(aO.morphTargets===true){var ah=ag.morphTargets;var aM=aF.morphTargetInfluences;var aa=aW.position;var aL=aU.position;var ar=aS.position;M.set(0,0,0);K.set(0,0,0);H.set(0,0,0);for(var aI=0,W=ah.length;aI<W;aI++){var az=aM[aI];if(az===0){continue}var aA=ah[aI].vertices;M.x+=(aA[ad.a].x-aa.x)*az;M.y+=(aA[ad.a].y-aa.y)*az;M.z+=(aA[ad.a].z-aa.z)*az;K.x+=(aA[ad.b].x-aL.x)*az;K.y+=(aA[ad.b].y-aL.y)*az;K.z+=(aA[ad.b].z-aL.z)*az;H.x+=(aA[ad.c].x-ar.x)*az;H.y+=(aA[ad.c].y-ar.y)*az;H.z+=(aA[ad.c].z-ar.z)*az}aW.position.add(M);aU.position.add(K);aS.position.add(H);E.projectVertex(aW);E.projectVertex(aU);E.projectVertex(aS)}if(E.checkTriangleVisibility(aW,aU,aS)===false){continue}var aq=E.checkBackfaceCulling(aW,aU,aS);if(aj!==THREE.DoubleSide){if(aj===THREE.FrontSide&&aq===false){continue}if(aj===THREE.BackSide&&aq===true){continue}}l=k();l.id=aF.id;l.v1.copy(aW);l.v2.copy(aU);l.v3.copy(aS);l.normalModel.copy(ad.normal);if(aq===false&&(aj===THREE.BackSide||aj===THREE.DoubleSide)){l.normalModel.negate()}l.normalModel.applyMatrix3(o).normalize();var ab=ad.vertexNormals;for(var aK=0,aT=Math.min(ab.length,3);aK<aT;aK++){var aV=l.vertexNormalsModel[aK];aV.copy(ab[aK]);if(aq===false&&(aj===THREE.BackSide||aj===THREE.DoubleSide)){aV.negate()}aV.applyMatrix3(o).normalize()}l.vertexNormalsLength=ab.length;var al=aB[aQ];if(al!==undefined){for(var aH=0;aH<3;aH++){l.uvs[aH].copy(al[aH])}}l.color=ad.color;l.material=aO;l.z=(aW.positionScreen.z+aU.positionScreen.z+aS.positionScreen.z)/3;J.elements.push(l)}}}}else{if(aF instanceof THREE.Line){if(ag instanceof THREE.BufferGeometry){var aD=ag.attributes;if(aD.position!==undefined){var ae=aD.position.array;for(var aP=0,aN=ae.length;aP<aN;aP+=3){E.pushVertex(ae[aP],ae[aP+1],ae[aP+2])}if(aD.index!==undefined){var Y=aD.index.array;for(var aP=0,aN=Y.length;aP<aN;aP+=2){E.pushLine(Y[aP],Y[aP+1])}}else{var ax=aF.mode===THREE.LinePieces?2:1;for(var aP=0,aN=(ae.length/3)-1;aP<aN;aP+=ax){E.pushLine(aP,aP+1)}}}}else{if(ag instanceof THREE.Geometry){C.multiplyMatrices(g,A);var X=aF.geometry.vertices;if(X.length===0){continue}aW=v();aW.positionScreen.copy(X[0]).applyMatrix4(C);var ax=aF.mode===THREE.LinePieces?2:1;for(var aG=1,ai=X.length;aG<ai;aG++){aW=v();aW.positionScreen.copy(X[aG]).applyMatrix4(C);if((aG+1)%ax>0){continue}aU=f[c-2];t.copy(aW.positionScreen);h.copy(aU.positionScreen);if(x(t,h)===true){t.multiplyScalar(1/t.w);h.multiplyScalar(1/h.w);i=F();i.id=aF.id;i.v1.positionScreen.copy(t);i.v2.positionScreen.copy(h);i.z=Math.max(t.z,h.z);i.material=aF.material;if(aF.material.vertexColors===THREE.VertexColors){i.vertexColors[0].copy(aF.geometry.colors[aG]);i.vertexColors[1].copy(aF.geometry.colors[aG-1])}J.elements.push(i)}}}}}else{if(aF instanceof THREE.Sprite){I.set(A.elements[12],A.elements[13],A.elements[14],1);I.applyMatrix4(g);var aR=1/I.w;I.z*=aR;if(I.z>=-1&&I.z<=1){z=j();z.id=aF.id;z.x=I.x*aR;z.y=I.y*aR;z.z=I.z;z.object=aF;z.rotation=aF.rotation;z.scale.x=aF.scale.x*Math.abs(z.x-(I.x+ak.projectionMatrix.elements[0])/(I.w+ak.projectionMatrix.elements[12]));z.scale.y=aF.scale.y*Math.abs(z.y-(I.y+ak.projectionMatrix.elements[5])/(I.w+ak.projectionMatrix.elements[13]));z.material=aF.material;J.elements.push(z)}}}}}if(Z===true){J.elements.sort(p)}return J};function m(){if(D===n){var W=new THREE.RenderableObject();N.push(W);n++;D++;return W}return N[D++]}function v(){if(c===b){var W=new THREE.RenderableVertex();f.push(W);b++;c++;return W}return f[c++]}function k(){if(B===y){var W=new THREE.RenderableFace();G.push(W);y++;B++;return W}return G[B++]}function F(){if(Q===u){var W=new THREE.RenderableLine();S.push(W);u++;Q++;return W}return S[Q++]}function j(){if(q===T){var W=new THREE.RenderableSprite();e.push(W);T++;q++;return W}return e[q++]}function p(X,W){if(X.z!==W.z){return W.z-X.z}else{if(X.id!==W.id){return X.id-W.id}else{return 0}}}function x(aa,Z){var Y=0,ad=1,ab=aa.z+aa.w,X=Z.z+Z.w,W=-aa.z+aa.w,ac=-Z.z+Z.w;if(ab>=0&&X>=0&&W>=0&&ac>=0){return true}else{if((ab<0&&X<0)||(W<0&&ac<0)){return false}else{if(ab<0){Y=Math.max(Y,ab/(ab-X))}else{if(X<0){ad=Math.min(ad,ab/(ab-X))}}if(W<0){Y=Math.max(Y,W/(W-ac))}else{if(ac<0){ad=Math.min(ad,W/(W-ac))}}if(ad<Y){return false}else{aa.lerp(Z,Y);Z.lerp(aa,1-ad);return true}}}}};
/*! icn3d.js
 * iCn3D has been developed based on iview (http://istar.cse.cuhk.edu.hk/iview/). The following new features has been added so far.
 * 1. Allowed users to pick atoms, both in perspective and orthographics camera. In order to make this work, the methods of rotation, translation and zooming have been dramatically changed.
 * 2. Allowed users to select residues based on structure, chain, sequence, etc. Userscan also defne their own subset and save the selection.
 * 3. Used standard libraries from three.js for rotation, translation, and zooming.
 * 4. Improved the labeling mechanism.
 * 5. The picking allows users to pick atoms, add labels, choose a new rotation center, etc.
 * 6. Added key operations for rotation, translation, and zooming.
 * 7. Enabled to show nucleotides.
 * 8. Make the tubes shiny.
 * 9. Enabled to save the current state and open the state later.
 *
 * iCn3D used the following standard libraries. We can easily adopt the new versions of these libraries.
 * 1. jquery and jquery ui. Jquery ui is used for show the menu at the top.
 * 2. Recent version of Three.js.
 * 3. surface.js from the iview group in Hongkong for displaying molecular surfaces.
 *
 * Files in #4-9 are combined in one file: full_ui_all.min.js.
 *
 * 4. The rotation, translation operation libraries from Three.js: TrackballControls.js and OrthographicTrackballControls.js.
 * 5. Projector.js from Three.js for the picking.
 * 6. Canvas render library: CanvasRenderer.js. This is used when WebGL render is no working in the browser.
 * 7. A library to detect whether WebGL is working in the browser: Detector.js.
 * 8. The 3D drawing library: icn3d.js
 * 9. Advanced UI library for iCn3D: full_ui.js.
 */
if(typeof jQuery==="undefined"){throw new Error("iCn3D requires jQuery")}var iCn3D=function(b){this.REVISION="1";this.id=b;this.container=$("#"+b);this.overdraw=0;this.bHighlight=1;if(Detector.webgl){this.renderer=new THREE.WebGLRenderer({canvas:this.container.get(0),antialias:true,preserveDrawingBuffer:true});this.overdraw=0}else{alert("Currently your web browser has a problem on WebGL, and CanvasRenderer instead of WebGLRenderer is used. If you are using Chrome, open a new tab for the same URL and WebGL may work again.");this.renderer=new THREE.CanvasRenderer({canvas:this.container.get(0)});this.overdraw=0.5;this.bHighlight=2}this.matShader=this.setOutlineColor("yellow");this.fractionOfColor=new THREE.Color(0.1,0.1,0.1);this.WIDTH=this.container.width(),this.HEIGHT=this.container.height();this.setWidthHeight(this.WIDTH,this.HEIGHT);this.axis=false;this.picking=1;this.pickpair=false;this.pickedatomNum=0;this.pickedatom=undefined;this.pickedatom2=undefined;this.bStopRotate=false;this.bCalphaOnly=false;this.bSSOnly=false;this.effects={none:this.renderer};this.maxD=500;this.camera_z=-this.maxD*2;this.commands=[];this.logs=[];this.bRender=true;this.highlightColor=new THREE.Color(16776960);this.sphereGeometry=new THREE.SphereGeometry(1,32,32);this.boxGeometry=new THREE.BoxGeometry(1,1,1);this.cylinderGeometry=new THREE.CylinderGeometry(1,1,1,32,1);this.cylinderGeometryOutline=new THREE.CylinderGeometry(1,1,1,32,1,true);this.sphereRadius=1.5;this.cylinderRadius=0.4;this.linewidth=1;this.curveWidth=3;this.helixSheetWidth=1.3;this.coilWidth=0.3;this.thickness=0.4;this.axisDIV=5;this.strandDIV=6;this.tubeDIV=8;this.LABELSIZE=40;this.nucleicAcidStrandDIV=6;this.nucleicAcidWidth=0.8;this.options={camera:"perspective",background:"black",color:"spectrum",sidechains:"nothing",secondary:"cylinder & plate",surface:"Van der Waals surface",wireframe:"no",opacity:"0.8",ligands:"stick",water:"nothing",ions:"sphere",hbonds:"no",labels:"no",lines:"no",rotationcenter:"molecule center",axis:"no",picking:"no",nucleotides:"nucleotide cartoon",showsurface:"no"};this._zoomFactor=1;this.mouseChange=new THREE.Vector2(0,0);this.quaternion=new THREE.Quaternion(0,0,0,1);var a=this;this.container.bind("contextmenu",function(c){c.preventDefault()});a.typetext=false;$(document).bind("keydown",function(h){if(!a.controls){return}a.bStopRotate=true;$("input, textarea").focus(function(){a.typetext=true});$("input, textarea").blur(function(){a.typetext=false});if(!a.typetext){if(h.keyCode===90){var c={};if(a.camera===a.perspectiveCamera){c._zoomFactor=0.9}else{if(a.camera===a.orthographicCamera){if(a._zoomFactor<0.1){a._zoomFactor=0.1}else{if(a._zoomFactor>1){a._zoomFactor=1}}c._zoomFactor=a._zoomFactor*0.9;if(c._zoomFactor<0.1){c._zoomFactor=0.1}}}c.update=true;a.controls.update(c)}else{if(h.keyCode===88){var c={};if(a.camera===a.perspectiveCamera){c._zoomFactor=1.1}else{if(a.camera===a.orthographicCamera){if(a._zoomFactor>20){a._zoomFactor=20}else{if(a._zoomFactor<1){a._zoomFactor=1}}c._zoomFactor=a._zoomFactor*1.03;if(c._zoomFactor>20){c._zoomFactor=20}}}c.update=true;a.controls.update(c)}else{if(h.keyCode===76){var d=new THREE.Vector3(0,1,0);var i=-5/180*Math.PI;d.applyQuaternion(a.camera.quaternion).normalize();var g=new THREE.Quaternion();g.setFromAxisAngle(d,-i);var c={};c.quaternion=g;c.update=true;a.controls.update(c)}else{if(h.keyCode===74){var d=new THREE.Vector3(0,1,0);var i=5/180*Math.PI;d.applyQuaternion(a.camera.quaternion).normalize();var g=new THREE.Quaternion();g.setFromAxisAngle(d,-i);var c={};c.quaternion=g;c.update=true;a.controls.update(c)}else{if(h.keyCode===73){var d=new THREE.Vector3(1,0,0);var i=-5/180*Math.PI;d.applyQuaternion(a.camera.quaternion).normalize();var g=new THREE.Quaternion();g.setFromAxisAngle(d,-i);var c={};c.quaternion=g;c.update=true;a.controls.update(c)}else{if(h.keyCode===77){var d=new THREE.Vector3(1,0,0);var i=5/180*Math.PI;d.applyQuaternion(a.camera.quaternion).normalize();var g=new THREE.Quaternion();g.setFromAxisAngle(d,-i);var c={};c.quaternion=g;c.update=true;a.controls.update(c)}else{if(h.keyCode===37){h.preventDefault();var f=new THREE.Vector2(0,0);f.x-=0.01;var c={};c.mouseChange=f;c.update=true;a.controls.update(c)}else{if(h.keyCode===39){h.preventDefault();var f=new THREE.Vector2(0,0);f.x+=0.01;var c={};c.mouseChange=f;c.update=true;a.controls.update(c)}else{if(h.keyCode===38){h.preventDefault();var f=new THREE.Vector2(0,0);f.y-=0.01;var c={};c.mouseChange=f;c.update=true;a.controls.update(c)}else{if(h.keyCode===40){h.preventDefault();var f=new THREE.Vector2(0,0);f.y+=0.01;var c={};c.mouseChange=f;c.update=true;a.controls.update(c)}}}}}}}}}}a.render()}});this.container.bind("mouseup touchend",function(c){a.isDragging=false});this.container.bind("mousedown touchstart",function(i){i.preventDefault();if(!a.scene){return}a.bStopRotate=true;var d=i.pageX,j=i.pageY;if(i.originalEvent.targetTouches&&i.originalEvent.targetTouches[0]){d=i.originalEvent.targetTouches[0].pageX;j=i.originalEvent.targetTouches[0].pageY}a.isDragging=true;if(a.picking){a.mouse.x=((d-a.container.offset().left)/a.container.width())*2-1;a.mouse.y=-((j-a.container.offset().top)/a.container.height())*2+1;var h=new THREE.Vector3();h.x=a.mouse.x;h.y=a.mouse.y;if(this.camera_z>0){h.z=-1}else{h.z=1}if(a.camera===a.perspectiveCamera){if(this.camera_z>0){h.z=-1}else{h.z=1}h.unproject(a.camera);a.raycaster.set(a.camera.position,h.sub(a.camera.position).normalize())}else{if(a.camera===a.orthographicCamera){if(this.camera_z>0){h.z=1}else{h.z=-1}h.unproject(a.camera);a.raycaster.set(h,new THREE.Vector3(0,0,-1).transformDirection(a.camera.matrixWorld))}}var g=a.raycaster.intersectObjects(a.objects);if(g.length>0){g[0].point.sub(a.mdl.position);var c=1;var f=a.getAtomsFromPosition(g[0].point,c);while(!f&&c<10){++c;f=a.getAtomsFromPosition(g[0].point,c)}if(f){if(a.pickpair){if(a.pickedatomNum%2===0){a.pickedatom=f}else{a.pickedatom2=f}++a.pickedatomNum}else{a.pickedatom=f}a.showPicking(f)}else{console.log("No atoms were found in 10 andstrom range")}}}a.controls.handleResize();a.controls.update();a.render()});this.container.bind("mousemove touchmove",function(c){c.preventDefault();if(!a.scene){return}if(!a.isDragging){return}a.controls.handleResize();a.controls.update();a.render()});this.container.bind("mousewheel",function(c){c.preventDefault();if(!a.scene){return}a.bStopRotate=true;a.controls.handleResize();a.controls.update();a.render()});this.container.bind("DOMMouseScroll",function(c){c.preventDefault();if(!a.scene){return}a.bStopRotate=true;a.controls.handleResize();a.controls.update();a.render()})};iCn3D.prototype={constructor:iCn3D,setOutlineColor:function(d){var e={outline:{vertex_shader:["uniform float offset;","void main() {","vec4 pos = modelViewMatrix * vec4( position + normal * offset, 1.0 );","gl_Position = projectionMatrix * pos;","}"].join("\n"),fragment_shader:["void main(){","gl_FragColor = vec4( 1.0, 1.0, 0.0, 1.0 );","}"].join("\n")}};if(d==="yellow"){e.outline.fragment_shader=["void main(){","gl_FragColor = vec4( 1.0, 1.0, 0.0, 1.0 );","}"].join("\n")}else{if(d==="green"){e.outline.fragment_shader=["void main(){","gl_FragColor = vec4( 0.0, 1.0, 0.0, 1.0 );","}"].join("\n")}else{if(d==="red"){e.outline.fragment_shader=["void main(){","gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );","}"].join("\n")}}}var a={offset:{type:"f",value:0.5}};var c=e.outline;var b=new THREE.ShaderMaterial({uniforms:a,vertexShader:c.vertex_shader,fragmentShader:c.fragment_shader,depthTest:false,depthWrite:false,needsUpdate:true});return b},setWidthHeight:function(b,a){this.renderer.setSize(b,a);this.container.widthInv=1/b;this.container.heightInv=1/a;this.container.whratio=b/a},nucleotidesArray:["  G","  A","  T","  C","  U"," DG"," DA"," DT"," DC"," DU"],ionsArray:[" NA"," MG"," AL"," CA"," TI"," MN"," FE"," NI"," CU"," ZN"," AG"," BA","  F"," CL"," BR","  I"],vdwRadii:{H:1.08,HE:1.34,LI:1.75,BE:2.05,B:1.47,C:1.49,N:1.41,O:1.4,F:1.39,NE:1.68,NA:1.84,MG:2.05,AL:2.11,SI:2.07,P:1.92,S:1.82,CL:1.83,AR:1.93,K:2.05,CA:2.21,SC:2.16,TI:1.87,V:1.79,CR:1.89,MN:1.97,FE:1.94,CO:1.92,NI:1.84,CU:1.86,ZN:2.1,GA:2.08,GE:2.15,AS:2.06,SE:1.93,BR:1.98,KR:2.12,RB:2.16,SR:2.24,Y:2.19,ZR:1.86,NB:2.07,MO:2.09,TC:2.09,RU:2.07,RH:1.95,PD:2.02,AG:2.03,CD:2.3,IN:2.36,SN:2.33,SB:2.25,TE:2.23,I:2.23,XE:2.21,CS:2.22,BA:2.51,LA:2.4,CE:2.35,PR:2.39,ND:2.29,PM:2.36,SM:2.29,EU:2.33,GD:2.37,TB:2.21,DY:2.29,HO:2.16,ER:2.35,TM:2.27,YB:2.42,LU:2.21,HF:2.12,TA:2.17,W:2.1,RE:2.17,OS:2.16,IR:2.02,PT:2.09,AU:2.17,HG:2.09,TL:2.35,PB:2.32,BI:2.43,PO:2.29,AT:2.36,RN:2.43,FR:2.56,RA:2.43,AC:2.6,TH:2.37,PA:2.43,U:2.4,NP:2.21,PU:2.56,AM:2.56,CM:2.56,BK:2.56,CF:2.56,ES:2.56,FM:2.56,},covalentRadii:{H:0.31,HE:0.28,LI:1.28,BE:0.96,B:0.84,C:0.76,N:0.71,O:0.66,F:0.57,NE:0.58,NA:1.66,MG:1.41,AL:1.21,SI:1.11,P:1.07,S:1.05,CL:1.02,AR:1.06,K:2.03,CA:1.76,SC:1.7,TI:1.6,V:1.53,CR:1.39,MN:1.39,FE:1.32,CO:1.26,NI:1.24,CU:1.32,ZN:1.22,GA:1.22,GE:1.2,AS:1.19,SE:1.2,BR:1.2,KR:1.16,RB:2.2,SR:1.95,Y:1.9,ZR:1.75,NB:1.64,MO:1.54,TC:1.47,RU:1.46,RH:1.42,PD:1.39,AG:1.45,CD:1.44,IN:1.42,SN:1.39,SB:1.39,TE:1.38,I:1.39,XE:1.4,CS:2.44,BA:2.15,LA:2.07,CE:2.04,PR:2.03,ND:2.01,PM:1.99,SM:1.98,EU:1.98,GD:1.96,TB:1.94,DY:1.92,HO:1.92,ER:1.89,TM:1.9,YB:1.87,LU:1.87,HF:1.75,TA:1.7,W:1.62,RE:1.51,OS:1.44,IR:1.41,PT:1.36,AU:1.36,HG:1.32,TL:1.45,PB:1.46,BI:1.48,PO:1.4,AT:1.5,RN:1.5,FR:2.6,RA:2.21,AC:2.15,TH:2.06,PA:2,U:1.96,NP:1.9,PU:1.87,AM:1.8,CM:1.69,},atomColors:{H:new THREE.Color(16777215),He:new THREE.Color(16761035),HE:new THREE.Color(16761035),Li:new THREE.Color(11674146),LI:new THREE.Color(11674146),B:new THREE.Color(65280),C:new THREE.Color(13158600),N:new THREE.Color(9408511),O:new THREE.Color(15728640),F:new THREE.Color(14329120),Na:new THREE.Color(255),NA:new THREE.Color(255),Mg:new THREE.Color(2263842),MG:new THREE.Color(2263842),Al:new THREE.Color(8421520),AL:new THREE.Color(8421520),Si:new THREE.Color(14329120),SI:new THREE.Color(14329120),P:new THREE.Color(16753920),S:new THREE.Color(16762930),Cl:new THREE.Color(65280),CL:new THREE.Color(65280),Ca:new THREE.Color(8421520),CA:new THREE.Color(8421520),Ti:new THREE.Color(8421520),TI:new THREE.Color(8421520),Cr:new THREE.Color(8421520),CR:new THREE.Color(8421520),Mn:new THREE.Color(8421520),MN:new THREE.Color(8421520),Fe:new THREE.Color(16753920),FE:new THREE.Color(16753920),Ni:new THREE.Color(10824234),NI:new THREE.Color(10824234),Cu:new THREE.Color(10824234),CU:new THREE.Color(10824234),Zn:new THREE.Color(10824234),ZN:new THREE.Color(10824234),Br:new THREE.Color(10824234),BR:new THREE.Color(10824234),Ag:new THREE.Color(8421520),AG:new THREE.Color(8421520),I:new THREE.Color(10494192),Ba:new THREE.Color(16753920),BA:new THREE.Color(16753920),Au:new THREE.Color(14329120),AU:new THREE.Color(14329120)},defaultAtomColor:new THREE.Color(13421772),stdChainColors:[new THREE.Color(3329330),new THREE.Color(2003199),new THREE.Color(16416882),new THREE.Color(16753920),new THREE.Color(52945),new THREE.Color(16738740),new THREE.Color(65280),new THREE.Color(255),new THREE.Color(16711680),new THREE.Color(16776960),new THREE.Color(65535),new THREE.Color(16711935),new THREE.Color(3978097),new THREE.Color(4620980),new THREE.Color(13458524),new THREE.Color(16770229),new THREE.Color(11529966),new THREE.Color(15631086),new THREE.Color(25600),new THREE.Color(139),new THREE.Color(9109504),new THREE.Color(13468991),new THREE.Color(35723),new THREE.Color(9699539)],backgroundColors:{black:new THREE.Color(0),grey:new THREE.Color(13421772),white:new THREE.Color(16777215),},residueColors:{ALA:new THREE.Color(13158600),ARG:new THREE.Color(1334015),ASN:new THREE.Color(56540),ASP:new THREE.Color(15075850),CYS:new THREE.Color(15132160),GLN:new THREE.Color(56540),GLU:new THREE.Color(15075850),GLY:new THREE.Color(15461355),HIS:new THREE.Color(8553170),ILE:new THREE.Color(1016335),LEU:new THREE.Color(1016335),LYS:new THREE.Color(1334015),MET:new THREE.Color(15132160),PHE:new THREE.Color(3289770),PRO:new THREE.Color(14456450),SER:new THREE.Color(16422400),THR:new THREE.Color(16422400),TRP:new THREE.Color(11819700),TYR:new THREE.Color(3289770),VAL:new THREE.Color(1016335),ASX:new THREE.Color(16738740),GLX:new THREE.Color(16738740),},defaultResidueColor:new THREE.Color(12492910),polarityColors:{ARG:new THREE.Color(13369344),HIS:new THREE.Color(13369344),LYS:new THREE.Color(13369344),ASP:new THREE.Color(13369344),GLU:new THREE.Color(13369344),SER:new THREE.Color(13369344),THR:new THREE.Color(13369344),ASN:new THREE.Color(13369344),GLN:new THREE.Color(13369344),TYR:new THREE.Color(13369344),GLY:new THREE.Color(52428),PRO:new THREE.Color(52428),ALA:new THREE.Color(52428),VAL:new THREE.Color(52428),LEU:new THREE.Color(52428),ILE:new THREE.Color(52428),MET:new THREE.Color(52428),PHE:new THREE.Color(52428),CYS:new THREE.Color(52428),TRP:new THREE.Color(52428),},ssColors:{helix:new THREE.Color(16711808),sheet:new THREE.Color(16762880),coil:new THREE.Color(6324479),},defaultBondColor:new THREE.Color(2200790),surfaces:{1:undefined,2:undefined,3:undefined,4:undefined},hasCovalentBond:function(b,a){var c=this.covalentRadii[b.elem]+this.covalentRadii[a.elem];return b.coord.distanceToSquared(a.coord)<1.3*c*c},init:function(){this.structures={};this.chains={};this.residues={};this.secondarys={};this.alignChains={};this.chainsSeq={};this.chainsColor={};this.chainsAnno={};this.chainsAnnoTitle={};this.alignChainsSeq={};this.alignChainsAnno={};this.alignChainsAnnoTitle={};this.displayAtoms={};this.highlightAtoms={};this.prevHighlightObjects=[];this.definedNames2Residues={};this.definedNames2Atoms={};this.definedNames2Descr={};this.definedNames2Command={};this.residueId2Name={};this.moleculeTitle="";this.atoms={};this.displayAtoms={};this.highlightAtoms={};this.peptides={};this.nucleotides={};this.nucleotidesP={};this.ligands={};this.ions={};this.water={};this.calphas={};this.hbondpoints=[];this.atomPrevColors={};this.style2atoms={};this.labels=[];this.lines=[];this.inputid={idtype:undefined,id:undefined};this.biomtMatrices=[];this.bAssembly=false},loadPDB:function(F){var V=[],J=[];var aB=F.split("\n");var I={};var ap={};this.init();var Y=[],aE=[],B=[],U=[],az=[],l=[];var u=0;var w=1;var ax,am;var P="",aC="";var ah="";var D={};for(var T in aB){var h=aB[T];var at=h.substr(0,6);if(at==="HEADER"){var ai=h.substr(10,40);var Q=h.substr(62,4);this.moleculeTitle=ai.trim()+" ("+Q+")"}else{if(at==="HELIX "){var ag=h.substr(19,1);var A=parseInt(h.substr(21,4));var a=parseInt(h.substr(33,4));var N;for(var S=A;S<=a;++S){N=ag+"_"+S;U.push(N);if(S===A){az.push(N)}if(S===a){l.push(N)}}V.push({chain:ag,initialResidue:A,initialInscode:h.substr(25,1),terminalResidue:a,terminalInscode:h.substr(37,1),})}else{if(at==="SHEET "){var ag=h.substr(21,1);var A=parseInt(h.substr(22,4));var a=parseInt(h.substr(33,4));for(var S=A;S<=a;++S){var N=ag+"_"+S;Y.push(N);if(S===A){aE.push(N)}if(S===a){B.push(N)}}J.push({chain:ag,initialResidue:A,initialInscode:h.substr(26,1),terminalResidue:a,terminalInscode:h.substr(37,1),})}else{if(at==="HBOND "){bCalculateHbond=false;var k=h.substr(6,1);var q=h.substr(8,4).replace(/ /g,"");var aA=h.substr(14,4).replace(/ /g,"");var au=h.substr(18,1);var c=h.substr(20,4).replace(/ /g,"");var ao=h.substr(25,4).replace(/ /g,"");var g=parseFloat(h.substr(30,8));var f=parseFloat(h.substr(38,8));var d=parseFloat(h.substr(46,8));var r=parseFloat(h.substr(54,8));var p=parseFloat(h.substr(62,8));var o=parseFloat(h.substr(70,8));var b=h.substr(78,8).replace(/ /g,"");this.hbondpoints.push(new THREE.Vector3(g,f,d));this.hbondpoints.push(new THREE.Vector3(r,p,o))}else{if(at==="REMARK"){var Z=parseInt(h.substr(7,3));if(Z==350&&h.substr(13,5)=="BIOMT"){var L=parseInt(h[18])-1;var O=parseInt(h.substr(21,2));if(this.biomtMatrices[O]==undefined){this.biomtMatrices[O]=new THREE.Matrix4().identity()}this.biomtMatrices[O].elements[L]=parseFloat(h.substr(24,9));this.biomtMatrices[O].elements[L+4]=parseFloat(h.substr(34,9));this.biomtMatrices[O].elements[L+8]=parseFloat(h.substr(44,9));this.biomtMatrices[O].elements[L+12]=parseFloat(h.substr(54,10))}}else{if(at==="ENDMDL"){++w}else{if(at==="JRNL  "){if(h.substr(12,4)==="PMID"){this.pmid=h.substr(19).trim()}}else{if(at==="ATOM  "||at==="HETATM"){var aq=h.substr(16,1);++u;var aj=parseInt(h.substr(6,5));D[aj]=u;var t=h.substr(76,2).replace(/ /g,"");if(t===""){t=h.substr(12,2).replace(/ /g,"")}var K=h.substr(21,1);if(K===""){K=1}var af=parseInt(h.substr(22,4));var v=h.substr(12,4).replace(/ /g,"");var N=K+"_"+af;var H=parseFloat(h.substr(30,8));var E=parseFloat(h.substr(38,8));var C=parseFloat(h.substr(46,8));var ac=h.substr(17,3);var ak=new THREE.Vector3(H,E,C);var R={het:at[0]==="H",serial:u,name:v,alt:aq,resn:ac,structure:w,chain:K,resi:af,coord:ak,b:parseFloat(h.substr(60,8)),elem:t,bonds:[],ss:"coil",ssbegin:false,ssend:false};this.atoms[u]=R;this.displayAtoms[u]=1;this.highlightAtoms[u]=1;if($.inArray(N,U)!==-1){this.atoms[u].ss="helix";if($.inArray(N,az)!==-1){this.atoms[u].ssbegin=true}if($.inArray(N,l)!==-1){this.atoms[u].ssend=true}}else{if($.inArray(N,Y)!==-1){this.atoms[u].ss="sheet";if($.inArray(N,aE)!==-1){this.atoms[u].ssbegin=true}if($.inArray(N,B)!==-1){this.atoms[u].ssend=true}}}ax=w+"_"+K;am=ax+"_"+af;var aa="-";if(this.atoms[u].ss==="helix"){aa="H"}else{if(this.atoms[u].ss==="sheet"){aa="E"}else{if(!this.atoms[u].het){aa="C"}}}this.secondarys[am]=aa;if(am!==aC){var ar=this.residueName2Abbr(ac);this.residueId2Name[am]=ar;if(u!==1){this.residues[aC]=ap}ap={};if(ax!==P){if(u!==1){this.chains[P]=this.unionHash2Atoms(this.chains[P],I)}I={};if(this.structures[w.toString()]===undefined){this.structures[w.toString()]=[]}this.structures[w.toString()].push(ax);if(this.chainsSeq[ax]===undefined){this.chainsSeq[ax]=[]}if(this.chainsAnno[ax]===undefined){this.chainsAnno[ax]=[]}if(this.chainsAnno[ax][0]===undefined){this.chainsAnno[ax][0]=[]}if(this.chainsAnno[ax][1]===undefined){this.chainsAnno[ax][1]=[]}if(this.chainsAnnoTitle[ax]===undefined){this.chainsAnnoTitle[ax]=[]}if(this.chainsAnnoTitle[ax][0]===undefined){this.chainsAnnoTitle[ax][0]=[]}if(this.chainsAnnoTitle[ax][1]===undefined){this.chainsAnnoTitle[ax][1]=[]}var av={};av.resi=af;av.name=ar;this.chainsSeq[ax].push(av);var aD="";if(af%10===0){aD=af.toString()}this.chainsAnno[ax][0].push(aD);this.chainsAnno[ax][1].push(aa);this.chainsAnnoTitle[ax][0].push("");this.chainsAnnoTitle[ax][1].push("SS")}else{var av={};av.resi=af;av.name=ar;this.chainsSeq[ax].push(av);var aD="";if(af%10===0){aD=af.toString()}this.chainsAnno[ax][0].push(aD);this.chainsAnno[ax][1].push(aa)}}I[u]=1;ap[u]=1;ah=at;P=ax;aC=am}else{if(at==="CONECT"){var W=parseInt(h.substr(6,5));for(var S=0;S<4;++S){var ae=parseInt(h.substr([11,16,21,26][S],5));if(isNaN(ae)){continue}if(this.atoms[D[W]]!==undefined){this.atoms[D[W]].bonds.push(D[ae])}}}else{if(at==="TER   "){++u}}}}}}}}}}}aB=null;var ar=this.residueName2Abbr(ac);this.chains[ax]=I;this.residues[am]=ap;var X,aw,G,ab=[],an=this;var ad=function(z){var aF=ab.length;for(var y=0;y<aF;++y){var x=ab[y];for(var m=y+1;m<aF;++m){var i=ab[m];if(x.alt===i.alt&&an.hasCovalentBond(x,i)){x.bonds.push(i.serial);i.bonds.push(x.serial)}}z&&z(x)}};var ay=new THREE.Vector3(9999,9999,9999);var e=new THREE.Vector3(-9999,-9999,-9999);var al=new THREE.Vector3();var M=0;for(var T in this.atoms){var v=this.atoms[T];var ak=v.coord;al.add(ak);ay.min(ak);e.max(ak);++M;if(!v.het){if($.inArray(v.resn,this.nucleotidesArray)!==-1){this.nucleotides[v.serial]=1;if(v.name==="P"){this.nucleotidesP[v.serial]=1}}else{this.peptides[v.serial]=1;if(v.name==="CA"){this.calphas[v.serial]=1}}}else{if(v.het){if(v.resn==="HOH"||v.resn==="WAT"){this.water[v.serial]=1}else{if($.inArray(v.resn,this.ionsArray)!==-1){this.ions[v.serial]=1}else{this.ligands[v.serial]=1}}}}if(!(X===v.chain&&aw===v.resi)){ad(function(i){if(((i.name==="C"&&v.name==="N")||(i.name==="O3'"&&v.name==="P"))&&an.hasCovalentBond(i,v)){i.bonds.push(v.serial);v.bonds.push(i.serial)}});X=v.chain;aw=v.resi;ab.length=0}ab.push(v)}ad();this.pmin=ay;this.pmax=e;this.cnt=M;this.maxD=this.pmax.distanceTo(this.pmin);this.center=al.multiplyScalar(1/this.cnt);if(this.maxD<25){this.maxD=25}},cloneHash:function(c,b){for(var a in c){b[a]=c[a]}},residueName2Abbr:function(a){if(a!==undefined&&a.charAt(0)!==" "&&a.charAt(1)===" "){a=a.charAt(0)}switch(a){case"  A":return"A";break;case"  C":return"C";break;case"  G":return"G";break;case"  T":return"T";break;case"  U":return"U";break;case"  I":return"I";break;case"ALA":return"A";break;case"ARG":return"R";break;case"ASN":return"N";break;case"ASP":return"D";break;case"CYS":return"C";break;case"GLU":return"E";break;case"GLN":return"Q";break;case"GLY":return"G";break;case"HIS":return"H";break;case"ILE":return"I";break;case"LEU":return"L";break;case"LYS":return"K";break;case"MET":return"M";break;case"PHE":return"F";break;case"PRO":return"P";break;case"SER":return"S";break;case"THR":return"T";break;case"TRP":return"W";break;case"TYR":return"Y";break;case"VAL":return"V";break;case"SEC":return"U";break;case"PYL":return"O";break;default:return a}},calculateLigandHbonds:function(n,q,l){if(Object.keys(n).length===0||Object.keys(q).length===0){return}var g={};var o;var r=l*l;for(var h in n){var m=n[h];if(m.elem==="N"||m.elem==="O"||m.elem==="F"){o=m.structure+"_"+m.chain+"_"+m.resi+"_"+m.name;g[o]=m}}this.highlightAtoms={};for(var h in q){var m=q[h];if(m.elem==="N"||m.elem==="O"||m.elem==="F"){o=m.structure+"_"+m.chain+"_"+m.resi+"_"+m.name;for(var f in g){var e=Math.abs(m.coord.x-g[f].coord.x);if(e>l){continue}var c=Math.abs(m.coord.y-g[f].coord.y);if(c>l){continue}var a=Math.abs(m.coord.z-g[f].coord.z);if(a>l){continue}var p=e*e+c*c+a*a;if(p>r){continue}var b=f.split("_");this.hbondpoints.push(m.coord);this.hbondpoints.push(g[f].coord);for(var d in this.residues[b[0]+"_"+b[1]+"_"+b[2]]){this.highlightAtoms[d]=1}}}}},createSphere:function(c,e,d,f,b){var g;if(e===undefined){e=0.8}if(d===undefined){d=false}if(f===undefined){f=1}if(b===2){if(f>0.9){f=1.5}else{if(f<0.5){f=1}}var a=this.highlightColor;g=new THREE.Mesh(this.sphereGeometry,new THREE.MeshPhongMaterial({transparent:true,opacity:0.5,metal:false,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,color:a}))}else{if(b===1){g=new THREE.Mesh(this.sphereGeometry,this.matShader)}else{var a=c.color;g=new THREE.Mesh(this.sphereGeometry,new THREE.MeshPhongMaterial({metal:false,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,color:a}))}}g.scale.x=g.scale.y=g.scale.z=d?e:(this.vdwRadii[c.elem]||e)*(f?f:1);g.position.copy(c.coord);this.mdl.add(g);if(b===1||b===2){this.prevHighlightObjects.push(g)}else{this.objects.push(g)}},createBox:function(c,e,d,f,a,b){var g;if(e===undefined){e=0.8}if(d===undefined){d=false}if(f===undefined){f=0.8}if(b){if(a===undefined){a=this.highlightColor}g=new THREE.Mesh(this.boxGeometry,new THREE.MeshPhongMaterial({transparent:true,opacity:0.5,metal:false,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,color:a}))}else{if(a===undefined){a=c.color}g=new THREE.Mesh(this.boxGeometry,new THREE.MeshPhongMaterial({metal:false,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,color:a}))}g.scale.x=g.scale.y=g.scale.z=d?e:(this.vdwRadii[c.elem]||e)*(f?f:1);g.position.copy(c.coord);this.mdl.add(g);if(b){this.prevHighlightObjects.push(g)}else{this.objects.push(g)}},createCylinder:function(f,d,a,b,c){var e;if(c===2){e=new THREE.Mesh(this.cylinderGeometry,new THREE.MeshPhongMaterial({transparent:true,opacity:0.5,metal:false,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,color:b}));a*=1.5}else{if(c===1){e=new THREE.Mesh(this.cylinderGeometryOutline,this.matShader)}else{e=new THREE.Mesh(this.cylinderGeometry,new THREE.MeshPhongMaterial({metal:false,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,color:b}))}}e.position.copy(f).add(d).multiplyScalar(0.5);e.matrixAutoUpdate=false;e.lookAt(f);e.updateMatrix();e.matrix.multiply(new THREE.Matrix4().makeScale(a,a,f.distanceTo(d))).multiply(new THREE.Matrix4().makeRotationX(Math.PI*0.5));this.mdl.add(e);if(c===1||c===2){this.prevHighlightObjects.push(e)}else{this.objects.push(e)}},createRepresentationSub:function(d,b,a){var h=new THREE.Geometry();for(var g in d){var f=d[g];b&&b(f);for(var e in f.bonds){var c=this.atoms[f.bonds[e]];if(c===undefined||c.serial<f.serial){continue}a&&a(f,c)}}},createSphereRepresentation:function(a,e,d,f,b){var c=this;this.createRepresentationSub(a,function(g){c.createSphere(g,e,d,f,b)})},createBoxRepresentation_P_CA:function(a,d,b){var c=this;this.createRepresentationSub(a,function(e){if(e.name==="CA"||e.name==="P"){c.createBox(e,undefined,undefined,d,undefined,b)}})},createStickRepresentation:function(b,a,f,e,c){var d=this;if(c!==2){this.createRepresentationSub(b,function(g){d.createSphere(g,a,!e,e,c)},function(h,g){if(h.color===g.color){d.createCylinder(h.coord,g.coord,f,h.color,c)}else{var i=h.coord.clone().add(g.coord).multiplyScalar(0.5);d.createCylinder(h.coord,i,f,h.color,c);d.createCylinder(g.coord,i,f,g.color,c)}})}else{if(c===2){this.createBoxRepresentation_P_CA(b,1.2,c)}}},createLineRepresentation:function(b,c){var d=this;var e=new THREE.Geometry();this.createRepresentationSub(b,undefined,function(g,f){if(g.color===f.color){e.vertices.push(g.coord);e.vertices.push(f.coord);e.colors.push(g.color);e.colors.push(f.color)}else{var h=g.coord.clone().add(f.coord).multiplyScalar(0.5);e.vertices.push(g.coord);e.vertices.push(h);e.vertices.push(f.coord);e.vertices.push(h);e.colors.push(g.color);e.colors.push(g.color);e.colors.push(f.color);e.colors.push(f.color)}});if(c!==2){var a;if(c===1){}else{a=new THREE.Line(e,new THREE.LineBasicMaterial({linewidth:this.linewidth,vertexColors:true}),THREE.LinePieces)}this.mdl.add(a);if(c===1){this.prevHighlightObjects.push(a)}else{this.objects.push(a)}}else{if(c===2){this.createBoxRepresentation_P_CA(b,0.8,c)}}},subdivide:function(g,u,o,B){var C=[];var w=new Array();w.push(g[0]);for(var A=1,k=g.length-1;A<k;++A){var d=g[A],c=g[A+1];w.push(d.smoothen?d.clone().add(c).multiplyScalar(0.5):d)}w.push(g[g.length-1]);var h=[];for(var A=-1,q=w.length,r=1/u;A<=q-3;++A){var d=w[A===-1?0:A];var c=w[A+1],b=w[A+2];var a=w[A===q-3?q-1:A+3];var f=b.clone().sub(d).multiplyScalar(0.5);var e=a.clone().sub(c).multiplyScalar(0.5);if(A>-1&&B&&o!==undefined&&o[A+1]){C=C.concat(h)}h=[];for(var v=0;v<u;++v){var p=r*v;var n=c.x+p*f.x+p*p*(-3*c.x+3*b.x-2*f.x-e.x)+p*p*p*(2*c.x-2*b.x+f.x+e.x);var m=c.y+p*f.y+p*p*(-3*c.y+3*b.y-2*f.y-e.y)+p*p*p*(2*c.y-2*b.y+f.y+e.y);var l=c.z+p*f.z+p*p*(-3*c.z+3*b.z-2*f.z-e.z)+p*p*p*(2*c.z-2*b.z+f.z+e.z);if(!o){C.push(new THREE.Vector3(n,m,l))}else{if(o[A+1]){if(v<=parseInt((u+1)/2)){C.push(new THREE.Vector3(n,m,l))}}else{if(o[A+2]){if(v>=parseInt((u+1)/2)){h.push(new THREE.Vector3(n,m,l))}}}}}}if(!o||o[A+1]){if(B){C=C.concat(h)}C.push(w[w.length-1])}return C},createCurveSubArrow:function(c,d,a,b,k,h,i,j,g,m,l){var e=[],f=[];e.push(c);f.push(j);this.prepareStrand(e,f,d,a,b,undefined,k,h,i,g,m,false,l)},createCurveSub:function(f,c,a,b,o,j,k,p){if(f.length===0){return}b=b||5;var q;if(!k){q=this.subdivide(f,b,p,o)}else{q=f}if(q.length===0){return}var h=new THREE.Geometry();if(o===2&&j){for(var g=0,d=1/b;g<q.length;++g){q[g].addScalar(0.6);h.vertices.push(q[g]);h.colors.push(new THREE.Color(a[g===0?0:Math.round((g-1)*d)]))}}else{if(o===1){var m=this.coilWidth/2;var e=32;var l=false;if(q.length>1){var n=new THREE.TubeGeometry(new THREE.SplineCurve3(q),q.length,m,e,l);mesh=new THREE.Mesh(n,this.matShader);this.mdl.add(mesh);this.prevHighlightObjects.push(mesh)}}else{for(var g=0,d=1/b;g<q.length;++g){h.vertices.push(q[g]);h.colors.push(new THREE.Color(a[g===0?0:Math.round((g-1)*d)]))}}}var r=new THREE.Line(h,new THREE.LineBasicMaterial({linewidth:c,vertexColors:true}),THREE.LineStrip);this.mdl.add(r);if(o===2){this.prevHighlightObjects.push(r)}else{this.objects.push(r)}},createLines:function(h){if(h!==undefined){for(var d in h){var j=h[d];var g=j.position1;var f=j.position2;var e;if(j.color){var b=/^\#([0-9a-f]{6})$/i.exec(j.color);e=parseInt(b[1],16)}else{e=16776960}var c=(j.dashed)?j.dashed:false;var a=0.3;this.mdl.add(this.createSingleLine(g,f,e,c,a))}}},createCylinderCurve:function(g,k,j,n,l){var c=null;var b,f;var e;var m=[],a=[],d=[];for(e in g){var h=g[e];if(h.het){continue}if(h.name!==k){continue}if(c!==null&&b===h.chain&&f+1===h.resi){if(!l){if(n){var o=this.createSingleLine(c.coord,h.coord,h.color,false);this.mdl.add(o);this.objects.push(o)}else{this.createCylinder(c.coord,h.coord,j,h.color);this.createSphere(h,j,true,1)}}else{if(l===1){this.createCylinder(c.coord,h.coord,j,h.color,l);this.createSphere(h,j,true,1,l)}}}c=h;b=h.chain;f=h.resi;if(l===2){this.createBox(h,undefined,undefined,undefined,undefined,l)}}if(c!==null&&b===h.chain&&f+1===h.resi){if(!l){if(n){var o=this.createSingleLine(c.coord,h.coord,h.color,false);this.mdl.add(o);this.objects.push(o)}else{this.createCylinder(c.coord,h.coord,j,h.color)}}else{if(l===1){this.createCylinder(c.coord,h.coord,j,h.color,l);this.createSphere(h,j,true,1,l)}}}},prepareStrand:function(q,h,u,k,p,a,E,t,g,d,D,B,n){if(d.length===1){return}p=p||this.axisDIV;var r=2/(g-1);var C,w,f,m;var z={},A=[];for(var y=0,l=h.length;y<l;++y){z[y]=[]}var c=this.subdivide(d,p);if(c.length===1){return}for(var y=0,l=d.length-2;y<l;++y){for(var e=0,b=h.length;e<b;++e){z[e].push(q[e][y])}A.push(k[y])}A.push(k[y]);for(var y=0,l=h.length;y<l;++y){C=-1+r*h[y];w=c.length-1-p;f=d.length-2;m=new THREE.Vector3(c[w].x+D[f].x*C,c[w].y+D[f].y*C,c[w].z+D[f].z*C);z[y].push(m)}for(var y=0,l=h.length;y<l;++y){z[y]=this.subdivide(z[y],p,n,E)}if(B){this.createStrip(z[0],z[1],A,p,a,E,true)}else{this.createCurveSub(z[0],u,A,p,E,t,true)}for(var y=0,l=h.length;y<l;++y){z[y]=[]}A=[];for(var e=0,b=h.length;e<b;++e){for(var y=p*(d.length-2),l=p*(d.length-1);n[parseInt(y/p)]&&y<l;y=y+p){for(var x=0;x<p;++x){var C=-1+r*h[e];var F=1.8;C=C*F*(p-x)/p;var o=parseInt(y/p);var m=new THREE.Vector3(c[y+x].x+D[o].x*C,c[y+x].y+D[o].y*C,c[y+x].z+D[o].z*C);m.smoothen=true;z[e].push(m)}}var C=0;var w=c.length-1;var f=d.length-1;var m=new THREE.Vector3(c[w].x+D[f].x*C,c[w].y+D[f].y*C,c[w].z+D[f].z*C);m.smoothen=true;z[e].push(m)}A.push(k[k.length-2]);A.push(k[k.length-1]);if(B){this.createStrip(z[0],z[1],A,p,a,E,true)}else{this.createCurveSub(z[0],u,A,p,E,t,true)}},createStripArrow:function(m,l,a,b,k,i,h,c,e,g,n,j){var d=[],f=[];d.push(m);d.push(l);f.push(c);f.push(e);this.prepareStrand(d,f,undefined,a,b,k,i,undefined,h,g,n,true,j)},createStrip:function(e,d,p,v,a,F,w,r){if(e.length<2){return}v=v||this.axisDIV;if(!w){e=this.subdivide(e,v,r,F);d=this.subdivide(d,v,r,F)}if(e.length<2){return}var G=new THREE.Geometry();var z=G.vertices,n=G.faces;var g,C,h,t,D;for(var B=0,k=e.length;B<k;++B){z.push(C=e[B]);z.push(C);z.push(h=d[B]);z.push(h);if(B<k-1){g=d[B].clone().sub(e[B]).cross(e[B+1].clone().sub(e[B])).normalize().multiplyScalar(a)}z.push(t=e[B].clone().add(g));z.push(t);z.push(D=d[B].clone().add(g));z.push(D)}var c=[[0,2,-6,-8],[-4,-2,6,4],[7,3,-5,-1],[-3,-7,1,5]];for(var B=1,k=e.length,E=1/v;B<k;++B){var m=8*B,y=new THREE.Color(p[Math.round((B-1)*E)]);for(var A=0;A<4;++A){n.push(new THREE.Face3(m+c[A][0],m+c[A][1],m+c[A][2],undefined,y));n.push(new THREE.Face3(m+c[A][3],m+c[A][0],m+c[A][2],undefined,y))}}var o=z.length-8;for(var B=0;B<4;++B){z.push(z[B*2]);z.push(z[o+B*2])}o+=8;n.push(new THREE.Face3(o,o+2,o+6,undefined,n[0].color));n.push(new THREE.Face3(o+4,o,o+6,undefined,n[0].color));n.push(new THREE.Face3(o+1,o+5,o+7,undefined,n[n.length-3].color));n.push(new THREE.Face3(o+3,o+1,o+7,undefined,n[n.length-3].color));G.computeFaceNormals();G.computeVertexNormals(false);var b;if(F===2){b=new THREE.Mesh(G,new THREE.MeshPhongMaterial({transparent:true,opacity:0.5,metal:false,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,vertexColors:THREE.FaceColors,side:THREE.DoubleSide}));this.mdl.add(b);this.prevHighlightObjects.push(b)}else{if(F===1){var l=this.coilWidth/2;var x=32;var f=false;var u=new THREE.TubeGeometry(new THREE.SplineCurve3(e),e.length,l,x,f);b=new THREE.Mesh(u,this.matShader);this.mdl.add(b);this.prevHighlightObjects.push(b);var q=new THREE.TubeGeometry(new THREE.SplineCurve3(d),d.length,l,x,f);b=new THREE.Mesh(q,this.matShader);this.mdl.add(b);this.prevHighlightObjects.push(b)}else{b=new THREE.Mesh(G,new THREE.MeshPhongMaterial({metal:false,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,vertexColors:THREE.FaceColors,side:THREE.DoubleSide}));this.mdl.add(b);this.objects.push(b)}}},createBrick:function(f,a){var c=new THREE.Geometry();for(var b=0,d=f.length;b<d;++b){c.vertices.push(new THREE.Vector3(f[b][0],f[b][1],f[b][2]))}c.faces=[new THREE.Face3(1,5,7,undefined,a),new THREE.Face3(1,7,3,undefined,a),new THREE.Face3(0,2,6,undefined,a),new THREE.Face3(0,6,4,undefined,a),new THREE.Face3(2,3,7,undefined,a),new THREE.Face3(2,7,6,undefined,a),new THREE.Face3(0,4,5,undefined,a),new THREE.Face3(0,5,1,undefined,a),new THREE.Face3(4,6,7,undefined,a),new THREE.Face3(4,7,5,undefined,a),new THREE.Face3(0,1,3,undefined,a),new THREE.Face3(0,3,2,undefined,a)];c.computeFaceNormals();c.computeVertexNormals(false);var e;e=new THREE.Mesh(c,new THREE.MeshPhongMaterial({metal:false,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,vertexColors:THREE.FaceColors,side:THREE.DoubleSide}));this.mdl.add(e);this.objects.push(e)},getFirstAtomObj:function(c){var b=Object.keys(c);var a=b[0];return this.atoms[a]},getLastAtomObj:function(c){var a=Object.keys(c);var b=a[a.length-1];return this.atoms[b]},createStrand:function(G,ag,af,z,Q,u,K,C,P){var y=z?true:false;var ai={};if(P===1||P===2){var I=this.getFirstAtomObj(G);var o=this.getLastAtomObj(G);var A=I.resi;if(I.ss!=="coil"&&!(I.ssbegin)){for(var ad=I.resi-1;ad>0;--ad){var M=I.structure+"_"+I.chain+"_"+ad;var b=this.getFirstAtomObj(this.residues[M]);if(b.ss===I.ss&&b.ssbegin){A=b.resi;break}}for(var ad=A;ad<I.resi;++ad){var M=I.structure+"_"+I.chain+"_"+ad;ai=this.unionHash(ai,this.hash2Atoms(this.residues[M]))}}ai=this.unionHash(ai,G);var al=o.resi;if(o.ss!=="coil"&&!(o.ssend)&&!(o.notshow)){var L=this.getLastAtomObj(this.chains[o.structure+"_"+o.chain]).resi;for(var ad=o.resi+1;ad<=L;++ad){var M=o.structure+"_"+o.chain+"_"+ad;var b=this.getFirstAtomObj(this.residues[M]);if(b.ss===o.ss&&b.ssend){al=b.resi;break}}for(var ad=o.resi+1;ad<=al;++ad){var M=o.structure+"_"+o.chain+"_"+ad;ai=this.unionHash(ai,this.hash2Atoms(this.residues[M]))}}if(o.notshow){o.notshow=undefined}}else{ai=G}if(P===2){if(z){z=false;ag=null;af=null;Q=null;u=null;C=undefined}else{z=true;ag=2;af=undefined;Q=undefined;u=undefined;C=this.thickness}}ag=ag||this.strandDIV;af=af||this.axisDIV;Q=Q||this.coilWidth;K=K||false;u=u||this.helixSheetWidth;var X={};for(var ab=0;ab<ag;++ab){X[ab]=[]}var ae=[];var T=[];var F=[];var Z=[],aj=[];var E,R,am=null,W=null,a=null,d=null,l=null,g=null;var U=null,t=null,f=false,ah=null,H=null;var h,ak=false,q=false;var b,m={};this.bCalphaOnly=false;var N=0,r=30;var c=false;for(var ad in G){if(N<r){if(G[ad].name!=="CA"){c=true;break}}else{break}++N}if(!c){this.bCalphaOnly=true}var w=this.hash2Atoms(ai);var S={};for(var ad in w){var b=w[ad];M=b.structure+"_"+b.chain+"_"+b.resi;S[M]=1}var p=Object.keys(S).length;var x=0;for(var ad in ai){b=ai[ad];var e=undefined;if((b.name==="O"||b.name==="CA")&&!b.het){if(b.name==="CA"){if(G.hasOwnProperty(ad)&&(b.ss==="coil"||b.ssend||b.ssbegin)){m[ad]=b}am=b.coord.clone();a=b.color}if(b.name==="O"||(this.bCalphaOnly&&b.name==="CA")){if(b.name==="O"){W=b.coord.clone()}var D=true;if(E!==b.chain||R+1!==b.resi){D=false}if(b.ssend&&b.ss==="sheet"){ak=true}else{if(b.ssend&&b.ss==="helix"){q=true}}if(l){if(P===1||P===2){Z.push(this.highlightColor)}else{Z.push(g)}if(t!=="coil"&&b.ss==="coil"){h=Q}else{if(f&&b.ssbegin){h=Q}else{h=(t==="coil")?Q:u}}var n;if(b.name==="O"){n=l.clone();n.sub(d)}else{if(this.bCalphaOnly&&b.name==="CA"){n=new THREE.Vector3(Math.random(),Math.random(),Math.random())}}n.normalize();n.multiplyScalar(h);if(U!==null&&n.dot(U)<0){n.negate()}U=n;for(var ac=0,aa=2/(ag-1);ac<ag;++ac){var V=-1+aa*ac;var Y=new THREE.Vector3(d.x+U.x*V,d.y+U.y*V,d.z+U.z*V);if(!K&&t!=="coil"){Y.smoothen=true}X[ac].push(Y)}ae.push(d);T.push(U);if(G.hasOwnProperty(H)){F.push(true)}else{F.push(false)}++x}if((b.ssbegin||b.ssend||(x===p-1))&&X[0].length>0&&D){if(P===1||P===2){Z.push(this.highlightColor)}else{Z.push(b.color)}if(b.ssend&&b.ss==="sheet"){h=0}else{if(t==="coil"&&b.ssbegin){h=Q}else{if(f&&b.ssbegin){h=Q}else{h=(b.ss==="coil")?Q:u}}}var n;if(b.name==="O"){n=W.clone();n.sub(am)}else{if(this.bCalphaOnly&&b.name==="CA"){n=new THREE.Vector3(Math.random(),Math.random(),Math.random())}}n.normalize();n.multiplyScalar(h);if(U!==null&&n.dot(U)<0){n.negate()}U=n;for(var ac=0,aa=2/(ag-1);ac<ag;++ac){var V=-1+aa*ac;var Y=new THREE.Vector3(am.x+U.x*V,am.y+U.y*V,am.z+U.z*V);if(!K&&t!=="coil"){Y.smoothen=true}X[ac].push(Y)}ah=b.serial;ae.push(am);T.push(U);if(G.hasOwnProperty(ah)){F.push(true)}else{F.push(false)}for(var ac=0;!z&&ac<ag;++ac){if(ak){this.createCurveSubArrow(X[ac],1,Z,af,P,y,ag,ac,ae,T,F)}else{this.createCurveSub(X[ac],1,Z,af,P,y,false,F)}}if(z){if(ak){var J=0,B=ag-1;this.createStripArrow(X[0],X[ag-1],Z,af,C,P,ag,J,B,ae,T,F)}else{if(q){this.createStrip(X[0],X[ag-1],Z,af,C,P,false,F)}else{if(P===2){this.createStrip(X[0],X[ag-1],Z,af,C,P,false,F)}}}}for(var ab=0;ab<ag;++ab){X[ab]=[]}Z=[];ae=[];T=[];F=[];ak=false;q=false}if((E!==b.chain||R+1!==b.resi)&&X[0].length>0){for(var ac=0;!z&&ac<ag;++ac){if(ak){this.createCurveSubArrow(X[ac],1,Z,af,P,y,ag,ac,ae,T,F)}else{if(q){this.createCurveSub(X[ac],1,Z,af,P,y,false,F)}}}if(z){if(ak){var J=0,B=ag-1;this.createStripArrow(X[0],X[ag-1],Z,af,C,P,ag,J,B,ae,T,F)}else{if(q){this.createStrip(X[0],X[ag-1],Z,af,C,P,false,F)}}}for(var ab=0;ab<ag;++ab){X[ab]=[]}Z=[];ae=[];T=[];F=[];ak=false;q=false}E=b.chain;R=b.resi;t=b.ss;f=b.ssend;H=b.serial;d=am;l=b.coord;g=a}}}this.createTube(m,"CA",0.3,P)},createStrandBrick:function(x,p,a){var c=this.strandDIV;var l=this.axisDIV;var m=false;var e=this.helixSheetWidth;var t={};for(var q=0;q<c;++q){t[q]=[]}var d=[];var h=null,o=null;for(var u=0;u<2;++u){var f=x.coords[u];d.push(new THREE.Color(p));var b=new THREE.Vector3(x.coords[2].x,x.coords[2].y,x.coords[2].z);b.normalize();b.multiplyScalar(e);if(h!==null&&b.dot(h)<0){b.negate()}h=b;for(var r=0,n=2/(c-1);r<c;++r){var w=-1+n*r;var g=new THREE.Vector3(f.x+h.x*w,f.y+h.y*w,f.z+h.z*w);if(!m){g.smoothen=true}t[r].push(g)}}this.createStrip(t[0],t[c-1],d,l,a)},createTubeSub:function(b,h,m,E){if(b.length<2){return}var w=this.tubeDIV,g=this.axisDIV;var p=1/w,u=1/g;var H=new THREE.Geometry();var t=this.subdivide(b,g);var G=new THREE.Vector3(),F;for(var v=0,d=t.length;v<d;++v){var l,k=(v-1)*u;if(v===0){l=m[0]}else{if(k%1===0){l=m[k]}else{var I=Math.floor(k);var B=k-I;l=m[I]*B+m[I+1]*(1-B)}}var D,C,A;if(v<d-1){D=t[v].clone().sub(t[v+1]);C=new THREE.Vector3(0,-D.z,D.y).normalize().multiplyScalar(l);A=D.clone().cross(C).normalize().multiplyScalar(l);if(G.dot(C)<0){C.negate();A.negate()}G=C;F=A}else{C=G;A=F}for(var o=0;o<w;++o){var y=2*Math.PI*p*o;H.vertices.push(t[v].clone().add(C.clone().multiplyScalar(Math.cos(y))).add(A.clone().multiplyScalar(Math.sin(y))))}}var f=0;for(var v=0,d=t.length-1;v<d;++v){var x=v;if(v<g){x=g}var z=new THREE.Color(h[parseInt(x*u)]);var e=0;var q=H.vertices[f].clone().sub(H.vertices[f+w]).lengthSq();var n=H.vertices[f].clone().sub(H.vertices[f+w+1]).lengthSq();if(q>n){q=n;e=1}for(var o=0;o<w;++o){H.faces.push(new THREE.Face3(f+o,f+(o+e)%w+w,f+(o+1)%w,undefined,z));H.faces.push(new THREE.Face3(f+(o+1)%w,f+(o+e)%w+w,f+(o+e+1)%w+w,undefined,z))}f+=w}H.computeFaceNormals();H.computeVertexNormals(false);var a;if(E===2){a=new THREE.Mesh(H,new THREE.MeshPhongMaterial({transparent:true,opacity:0.5,metal:false,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,vertexColors:THREE.FaceColors,side:THREE.DoubleSide}))}else{if(E===1){a=new THREE.Mesh(H,this.matShader)}else{a=new THREE.Mesh(H,new THREE.MeshPhongMaterial({metal:false,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,vertexColors:THREE.FaceColors,side:THREE.DoubleSide}))}}this.mdl.add(a);if(E===1||E===2){this.prevHighlightObjects.push(a)}else{this.objects.push(a)}},createTube:function(g,k,j,l){var m=[],a=[],e=[];var b,f;for(var d in g){var h=g[d];if((h.name===k)&&!h.het){if(b!==h.chain||f+1!==h.resi){if(l!==2){this.createTubeSub(m,a,e,l)}m=[];a=[];e=[]}m.push(h.coord);e.push(j||(h.b>0?h.b*0.01:0.3));a.push(h.color);b=h.chain;f=h.resi;var c=1.2;if(l===2&&!h.ssbegin){this.createBox(h,undefined,undefined,c,undefined,l)}}}if(l!==2){this.createTubeSub(m,a,e,l)}},createCylinderHelix:function(f,h,j){var b=null;var a,e;var c={},k={};var d;for(d in f){var g=f[d];if(g.het){continue}if((g.ss!=="helix"&&g.ss!=="sheet")||g.ssend||g.ssbegin){c[g.serial]=g}if(g.ss==="sheet"){k[g.serial]=g}if(g.name!=="CA"){continue}if(g.ss==="helix"&&g.ssend){if(b!==null&&a===g.chain&&e<g.resi){if(j===1||j===2){this.createCylinder(b.coord,g.coord,h,this.highlightColor,j)}else{this.createCylinder(b.coord,g.coord,h,g.color)}}b=null}if(b===null&&g.ss==="helix"&&g.ssbegin){b=g;a=g.chain;e=g.resi}}if(j===1||j===2){if(Object.keys(c).length>0){this.createTube(c,"CA",0.3,j)}if(Object.keys(k).length>0){this.createStrand(k,undefined,undefined,true,0,this.helixSheetWidth,false,this.thickness*2,j)}}else{if(Object.keys(c).length>0){this.createTube(c,"CA",0.3)}if(Object.keys(k).length>0){this.createStrand(k,undefined,undefined,true,0,this.helixSheetWidth,false,this.thickness*2)}}},createSurfaceRepresentation:function(d,g,f,e){var c;var a=ProteinSurface({min:this.pmin,max:this.pmax,atoms:d,type:g});var h=a.verts;var b=a.faces;c=new THREE.Geometry();c.vertices=h.map(function(j){var k=new THREE.Vector3(j.x,j.y,j.z);k.atomid=j.atomid;return k});c.faces=b.map(function(j){return new THREE.Face3(j.a,j.b,j.c)});a=null;c.computeFaceNormals();c.computeVertexNormals(false);c.colorsNeedUpdate=true;c.faces.forEach(function(j){j.vertexColors=["a","b","c"].map(function(k){return d[c.vertices[j[k]].atomid].color})});var i=new THREE.Mesh(c,new THREE.MeshLambertMaterial({overdraw:this.overdraw,vertexColors:THREE.VertexColors,wireframe:f,opacity:e,transparent:true,}));this.mdl.add(i)},drawNucleicAcidStick:function(g,e){var b,c,h=null,a=null;var d;for(d in g){var f=g[d];if(f===undefined||f.het){continue}if(f.resi!==c||f.chain!==b){if(h!==null&&a!==null){this.createCylinder(new THREE.Vector3(h.coord.x,h.coord.y,h.coord.z),new THREE.Vector3(a.coord.x,a.coord.y,a.coord.z),0.3,h.color,e)}h=null;a=null}if(f.name==="O3'"){h=f}if(f.resn==="  A"||f.resn==="  G"||f.resn===" DA"||f.resn===" DG"){if(f.name==="N1"){a=f}}else{if(f.name==="N3"){a=f}}c=f.resi;b=f.chain}if(h!==null&&a!==null){this.createCylinder(new THREE.Vector3(h.coord.x,h.coord.y,h.coord.z),new THREE.Vector3(a.coord.x,a.coord.y,a.coord.z),0.3,h.color,e)}},drawCartoonNucleicAcid:function(c,d,a,b){this.drawStrandNucleicAcid(c,2,d,true,undefined,a,b)},drawStrandNucleicAcid:function(n,e,l,p,h,a,w){if(w===2){e=undefined;a=undefined}h=h||this.nucleicAcidWidth;l=l||this.axisDIV;e=e||this.nucleicAcidStrandDIV;var t,q,o;var r=[];for(o=0;o<e;o++){r[o]=[]}var g=[];var f,c,u;var m=null;for(t in n){var b=n[t];if(b===undefined){continue}if((b.name==="O3'"||b.name==="OP2")&&!b.het){if(b.name==="O3'"){if(f!==b.chain||c+1!==b.resi){if(u&&m){for(q=0;q<e;q++){var v=-1+2/(e-1)*q;r[q].push(new THREE.Vector3(u.x+m.x*v,u.y+m.y*v,u.z+m.z*v))}}if(p){this.createStrip(r[0],r[1],g,l,a,w)}for(q=0;!a&&q<e;q++){this.createCurveSub(r[q],1,g,l,w)}var r=[];for(o=0;o<e;o++){r[o]=[]}g=[];m=null}u=new THREE.Vector3(b.coord.x,b.coord.y,b.coord.z);f=b.chain;c=b.resi;if(w===1||w===2){g.push(this.highlightColor)}else{g.push(b.color)}}else{if(!u){m=null;continue}var d=new THREE.Vector3(b.coord.x,b.coord.y,b.coord.z);d.sub(u);d.normalize().multiplyScalar(h);if(m!==null&&d.dot(m)<0){d.negate()}m=d;for(q=0;q<e;q++){var v=-1+2/(e-1)*q;r[q].push(new THREE.Vector3(u.x+m.x*v,u.y+m.y*v,u.z+m.z*v))}u=null}}}if(u&&m){for(q=0;q<e;q++){var v=-1+2/(e-1)*q;r[q].push(new THREE.Vector3(u.x+m.x*v,u.y+m.y*v,u.z+m.z*v))}}if(p){this.createStrip(r[0],r[1],g,l,a,w)}for(q=0;!a&&q<e;q++){this.createCurveSub(r[q],1,g,l,w)}},drawSymmetryMates2:function(){if(this.biomtMatrices===undefined){return}var c=1;var k=this.center.clone();for(var f=0;f<this.biomtMatrices.length;f++){var h=this.biomtMatrices[f];if(h===undefined){continue}var b=h.toArray();var e=1;for(var d in b){if(d==0||d==5||d==10){if(parseInt(1000*b[d])!=1000){e=0}}else{if(d!=0&&d!=5&&d!=10&&d!=15){if(parseInt(1000*b[d])!=0){e=0}}}}if(e){continue}var g=this.mdl.clone();g.applyMatrix(h);var a=this.center.clone();a.applyMatrix4(h);k.add(a);this.mdl.add(g);++c}this.maxD*=Math.sqrt(c);this.mdl.position.add(this.center).sub(k.multiplyScalar(1/c));this.setCamera()},makeTextSprite:function(l,k){if(k===undefined){k={}}var q=k.hasOwnProperty("fontface")?k.fontface:"Arial";var t=k.hasOwnProperty("fontsize")?k.fontsize:18;var d=k.hasOwnProperty("borderThickness")?k.borderThickness:4;var u=1;var c=k.hasOwnProperty("borderColor")?this.hexToRgb(k.borderColor,u):{r:0,g:0,b:0,a:1};var j=k.hasOwnProperty("backgroundColor")?this.hexToRgb(k.backgroundColor,u):{r:0,g:0,b:0,a:0.5};u=1;var h=k.hasOwnProperty("textColor")?this.hexToRgb(k.textColor,u):{r:255,g:255,b:0,a:1};var g=document.createElement("canvas");var e=g.getContext("2d");e.font="Bold "+t+"px "+q;var p=e.measureText(l);var f=p.width;var i=e.measureText("M").width;e.fillStyle="rgba("+j.r+","+j.g+","+j.b+","+j.a+")";e.strokeStyle="rgba("+c.r+","+c.g+","+c.b+","+c.a+")";e.lineWidth=d;this.roundRect(e,d/2,d/2,(f+d)*1.1,t*1.4+d,i*0.3);e.fillStyle="rgba("+h.r+", "+h.g+", "+h.b+", 1.0)";e.strokeStyle="rgba("+h.r+", "+h.g+", "+h.b+", 1.0)";e.fillText(l,d+t*0.1,t+d);var m=new THREE.Texture(g);m.needsUpdate=true;var b=true;var r=new THREE.SpriteMaterial({map:m,useScreenCoordinates:false,depthTest:!b,depthWrite:!b});var o=new THREE.Sprite(r);var n=this.maxD/100;o.scale.set(16*n,8*n,1);return o},hexToRgb:function(d,c){var b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(d);return b?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16),a:c}:null},roundRect:function(c,a,f,b,d,e){c.beginPath();c.moveTo(a+e,f);c.lineTo(a+b-e,f);c.quadraticCurveTo(a+b,f,a+b,f+e);c.lineTo(a+b,f+d-e);c.quadraticCurveTo(a+b,f+d,a+b-e,f+d);c.lineTo(a+e,f+d);c.quadraticCurveTo(a,f+d,a,f+d-e);c.lineTo(a,f+e);c.quadraticCurveTo(a,f,a+e,f);c.closePath();c.fill();c.stroke()},createLabelRepresentation:function(g){for(var e in g){var c=g[e];var d=(c.size)?c.size:this.LABELSIZE;var a=(c.color)?c.color:"#ffff00";var b=(c.background)?c.background:"#cccccc";var f=this.makeTextSprite(c.text,{fontsize:parseInt(d),textColor:a,borderColor:b,backgroundColor:b});f.position.set(c.position.x,c.position.y,c.position.z);this.mdl.add(f)}},getAtomsWithinAtom:function(n,o,a){var r=this.getExtent(o);var c=(r[2][0]-r[0][0])*(r[2][0]-r[0][0])+(r[2][1]-r[0][1])*(r[2][1]-r[0][1])+(r[2][2]-r[0][2])*(r[2][2]-r[0][2]);var b=(r[2][0]-r[1][0])*(r[2][0]-r[1][0])+(r[2][1]-r[1][1])*(r[2][1]-r[1][1])+(r[2][2]-r[1][2])*(r[2][2]-r[1][2]);var h=(c>b)?c:b;var d=Math.sqrt(h);var q=(d+a)*(d+a);var p={};for(var g in n){var l=n[g];if(l.serial in o){continue}if(l.coord.x<r[0][0]-a||l.coord.x>r[1][0]+a){continue}if(l.coord.y<r[0][1]-a||l.coord.y>r[1][1]+a){continue}if(l.coord.z<r[0][2]-a||l.coord.z>r[1][2]+a){continue}var e=(l.coord.x-r[2][0])*(l.coord.x-r[2][0])+(l.coord.y-r[2][1])*(l.coord.y-r[2][1])+(l.coord.z-r[2][2])*(l.coord.z-r[2][2]);if(e<q){p[l.serial]=l}}var m={};for(var g in o){var t=o[g];var k=this.vdwRadii[t.elem]||this.defaultRadius;for(var f in p){var l=p[f];var e=(l.coord.x-t.coord.x)*(l.coord.x-t.coord.x)+(l.coord.y-t.coord.y)*(l.coord.y-t.coord.y)+(l.coord.z-t.coord.z)*(l.coord.z-t.coord.z);q=(k+a)*(k+a);if(e<q){m[l.serial]=l}}}return m},getExtent:function(f){var d=ymin=zmin=9999;var a=ymax=zmax=-9999;var e=ysum=zsum=cnt=0;var b;for(b in f){var c=f[b];cnt++;e+=c.coord.x;ysum+=c.coord.y;zsum+=c.coord.z;d=(d<c.coord.x)?d:c.coord.x;ymin=(ymin<c.coord.y)?ymin:c.coord.y;zmin=(zmin<c.coord.z)?zmin:c.coord.z;a=(a>c.coord.x)?a:c.coord.x;ymax=(ymax>c.coord.y)?ymax:c.coord.y;zmax=(zmax>c.coord.z)?zmax:c.coord.z}return[[d,ymin,zmin],[a,ymax,zmax],[e/cnt,ysum/cnt,zsum/cnt]]},getAtomsFromPosition:function(b,a){var c,d;if(a===undefined||a===null){a=1}for(c in this.atoms){var d=this.atoms[c];if(d.coord.x<b.x-a||d.coord.x>b.x+a){continue}if(d.coord.y<b.y-a||d.coord.y>b.y+a){continue}if(d.coord.z<b.z-a||d.coord.z>b.z+a){continue}return d}return null},buildAxes:function(a){var b=new THREE.Object3D();b.add(this.createSingleLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0+a,0,0),16711680,false,0.5));b.add(this.createSingleLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0-a,0,0),8388608,true,0.5));b.add(this.createSingleLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0+a,0),65280,false,0.5));b.add(this.createSingleLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0-a,0),32768,true,0.5));b.add(this.createSingleLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,0+a),255,false,0.5));b.add(this.createSingleLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,0-a),128,true,0.5));this.scene.add(b)},createSingleLine:function(g,h,c,b,a){var e=new THREE.Geometry();var d;if(b){d=new THREE.LineDashedMaterial({linewidth:1,color:c,dashSize:a,gapSize:a})}else{d=new THREE.LineBasicMaterial({linewidth:1,color:c})}e.vertices.push(g);e.vertices.push(h);if(b){e.computeLineDistances()}var f=new THREE.Line(e,d,THREE.LinePieces);return f},intersectHash:function(b,a){var d={};if(Object.keys(b).length<Object.keys(a).length){for(var c in b){if(a!==undefined&&a[c]){d[c]=b[c]}}}else{for(var c in a){if(b!==undefined&&b[c]){d[c]=a[c]}}}return d},excludeHash:function(d,a){var c={};for(var b in d){if(!(b in a)){c[b]=d[b]}}return c},unionHash:function(b,a){return jQuery.extend({},b,a)},intersectHash2Atoms:function(b,a){return this.hash2Atoms(this.intersectHash(b,a))},excludeHash2Atoms:function(b,a){return this.hash2Atoms(this.excludeHash(b,a))},unionHash2Atoms:function(b,a){return this.hash2Atoms(this.unionHash(b,a))},hash2Atoms:function(c){var a={};for(var b in c){a[b]=this.atoms[b]}return a},centerAtoms:function(f){var a=new THREE.Vector3(9999,9999,9999);var e=new THREE.Vector3(-9999,-9999,-9999);var c=new THREE.Vector3();var b=0;for(var d in f){var h=this.atoms[d];var g=h.coord;c.add(g);a.min(g);e.max(g);++b}var j=e.distanceTo(a);return{center:c.multiplyScalar(1/b),maxD:j}},exportCanvas:function(){this.render();window.open(this.renderer.domElement.toDataURL("image/png"))},applyPrevColor:function(){for(var a in this.atoms){var b=this.atoms[a];b.color=this.atomPrevColors[a]}},setColorByOptions:function(n,f,d){if(d!==undefined&&d){for(var e in f){var g=this.atoms[e];this.atomPrevColors[e]=g.color}}else{if(n.color.indexOf("#")===0){for(var e in f){var g=this.atoms[e];g.color=new THREE.Color().setStyle(n.color.toLowerCase());this.atomPrevColors[e]=g.color}}else{switch(n.color.toLowerCase()){case"spectrum":var m=0;var l=1/this.cnt;for(var e in f){var g=this.atoms[e];g.color=g.het?this.atomColors[g.elem]||this.defaultAtomColor:new THREE.Color().setHSL(2/3*(1-m++*l),1,0.45);this.atomPrevColors[e]=g.color}break;case"chain":var h=-1,k="",j=this.stdChainColors.length;for(var e in f){var g=this.atoms[e];if(g.chain!=k){++h;h=h%j}g.color=this.stdChainColors[h];if(Object.keys(this.chainsColor).length>0){this.updateChainsColor(g)}this.atomPrevColors[e]=g.color;k=g.chain}break;case"secondary structure":for(var e in f){var g=this.atoms[e];g.color=g.het?this.atomColors[g.elem]||this.defaultAtomColor:this.ssColors[g.ss];this.atomPrevColors[e]=g.color}break;case"B factor":var c=this.getFirstAtomObj(this.atoms);if(!this.middB&&c.b!==undefined){var b=1000,a=-1000;for(var e in f){var g=this.atoms[e];if(b>parseFloat(g.b)){b=parseFloat(g.b)}if(a<parseFloat(g.b)){a=parseFloat(g.b)}}this.middB=(a+b)*0.5;this.spanB=(a-b)*0.5;this.spanBinv=1/this.spanB}for(var e in f){var g=this.atoms[e];if(g.b!==undefined&&this.middB!==undefined){g.color=g.b<this.middB?new THREE.Color().setRGB(1-(s=(this.middB-g.b)*this.spanBinv),1-s,1):new THREE.Color().setRGB(1,1-(s=(g.b-this.middB)*this.spanBinv),1-s)}this.atomPrevColors[e]=g.color}break;case"residue":for(var e in f){var g=this.atoms[e];g.color=g.het?this.atomColors[g.elem]||this.defaultAtomColor:this.residueColors[g.resn]||this.defaultResidueColor;this.atomPrevColors[e]=g.color}break;case"polarity":for(var e in f){var g=this.atoms[e];g.color=g.het?this.atomColors[g.elem]||this.defaultAtomColor:this.polarityColors[g.resn]||this.defaultResidueColor;this.atomPrevColors[e]=g.color}break;case"atom":for(var e in f){var g=this.atoms[e];g.color=this.atomColors[g.elem]||this.defaultAtomColor;this.atomPrevColors[e]=g.color}break;case"white":for(var e in f){var g=this.atoms[e];g.color=new THREE.Color().setHex(16777215);if(Object.keys(this.chainsColor).length>0){this.updateChainsColor(g)}this.atomPrevColors[e]=g.color}break;case"grey":for(var e in f){var g=this.atoms[e];g.color=new THREE.Color().setHex(8947848);if(Object.keys(this.chainsColor).length>0){this.updateChainsColor(g)}this.atomPrevColors[e]=g.color}break;case"red":for(var e in f){var g=this.atoms[e];g.color=new THREE.Color().setHex(16711680);if(Object.keys(this.chainsColor).length>0){this.updateChainsColor(g)}this.atomPrevColors[e]=g.color}break;case"green":for(var e in f){var g=this.atoms[e];g.color=new THREE.Color().setHex(65280);if(Object.keys(this.chainsColor).length>0){this.updateChainsColor(g)}this.atomPrevColors[e]=g.color}break;case"blue":for(var e in f){var g=this.atoms[e];g.color=new THREE.Color().setHex(255);if(Object.keys(this.chainsColor).length>0){this.updateChainsColor(g)}this.atomPrevColors[e]=g.color}break;case"magenta":for(var e in f){var g=this.atoms[e];g.color=new THREE.Color().setHex(16711935);if(Object.keys(this.chainsColor).length>0){this.updateChainsColor(g)}this.atomPrevColors[e]=g.color}break;case"yellow":for(var e in f){var g=this.atoms[e];g.color=new THREE.Color().setHex(16776960);if(Object.keys(this.chainsColor).length>0){this.updateChainsColor(g)}this.atomPrevColors[e]=g.color}break;case"cyan":for(var e in f){var g=this.atoms[e];g.color=new THREE.Color().setHex(65535);if(Object.keys(this.chainsColor).length>0){this.updateChainsColor(g)}this.atomPrevColors[e]=g.color}break;case"custom":break}}}},updateChainsColor:function(b){var a=b.structure+"_"+b.chain;if(this.chainsColor[a]!==undefined){this.chainsColor[a]=b.color}},applyOptions:function(d){if(d===undefined){d=this.options}this.applyDisplayOptions(d,this.displayAtoms);if(d.labels.toLowerCase()==="yes"){this.createLabelRepresentation(this.labels)}if(d.lines.toLowerCase()==="yes"){this.createLines(this.lines)}if(d.hbonds.toLowerCase()==="yes"){var c="#FFFFFF";if(d.background.toLowerCase()!=="black"){c="#000000"}for(var e=0,h=Math.floor(this.hbondpoints.length/2);e<h;e++){var g=this.hbondpoints[2*e],f=this.hbondpoints[2*e+1];var b={};b.position1=this.hbondpoints[2*e];b.position2=this.hbondpoints[2*e+1];b.color=c;b.dashed=true;this.lines.push(b)}this.createLines(this.lines)}switch(d.rotationcenter.toLowerCase()){case"molecule center":if(this.center!==undefined){this.mdl.position.sub(this.center)}break;case"pick center":if(this.pickedatom!==undefined){this.mdl.position.sub(this.pickedatom.coord)}break;case"display center":var a=this.centerAtoms(this.displayAtoms).center;this.mdl.position.sub(a);break;case"highlight center":var a=this.centerAtoms(this.highlightAtoms).center;this.mdl.position.sub(a);break}switch(d.axis.toLowerCase()){case"yes":this.axis=true;this.buildAxes(this.maxD/2);break;case"no":this.axis=false;break}switch(d.picking.toLowerCase()){case"atom":this.picking=1;break;case"no":this.picking=0;break;case"residue":this.picking=2;break}},drawHelixBrick:function(c,k){for(var b in c){for(var e=0,g=c[b].length;e<g;++e){if(c[b][e].type==="helix"){var i=1.6;var d=new THREE.Color(k[b]);var n=new THREE.Vector3(c[b][e].coords[0].x,c[b][e].coords[0].y,c[b][e].coords[0].z);var m=new THREE.Vector3(c[b][e].coords[1].x,c[b][e].coords[1].y,c[b][e].coords[1].z);this.createCylinder(n,m,i,d)}else{if(c[b][e].type==="brick"){var h=c[b][e];var d=k[b];this.createStrandBrick(h,d,this.thickness)}else{if(c[b][e].type==="coil"){var l=[],a=[],f=[];var n=new THREE.Vector3(c[b][e].coords[0].x,c[b][e].coords[0].y,c[b][e].coords[0].z);var m=new THREE.Vector3(c[b][e].coords[1].x,c[b][e].coords[1].y,c[b][e].coords[1].z);var d=new THREE.Color(k[b]);var o=this.createSingleLine(n,m,d,false);this.mdl.add(o);this.objects.push(o)}}}}}},applyDisplayOptions:function(c,d,u){if(c===undefined){c=this.options}var v={};var k={};var q={};var h;if(u===1){q=this.hash2Atoms(d);for(var r in q){var b=q[r];h=b.structure+"_"+b.chain+"_"+b.resi;v[h]=1}for(var r in v){var l=r.lastIndexOf("_");var f=r.substr(0,l+1);var j=parseInt(r.substr(l+1));var a=f+(j-1).toString();var e=f+(j+1).toString();if(!v.hasOwnProperty(a)&&!v.hasOwnProperty(a)){k[r]=1}}if(Object.keys(q).length===1&&Object.keys(this.residues[h]).length>1&&q[Object.keys(q)[0]].style!=="sphere"&&q[Object.keys(q)[0]].style!=="dot"){if(this.bCid===undefined||!this.bCid){for(var r in q){var b=q[r];var w=1;this.createBox(b,undefined,undefined,w,undefined,u)}}}else{for(var h in k){var b=this.getFirstAtomObj(this.residues[h]);var a=b.structure+"_"+b.chain+"_"+parseInt(b.resi-1);var e=b.structure+"_"+b.chain+"_"+parseInt(b.resi+1);if(b.style==="cylinder & plate"&&b.ss==="helix"){for(var r in this.residues[h]){var b=this.atoms[r];var w=1;this.createBox(b,undefined,undefined,w,undefined,u)}}else{if((b.style==="ribbon"&&b.ss==="coil")||(b.style==="strand"&&b.ss==="coil")||b.style==="phosphorus trace"||b.style==="C alpha trace"||b.style==="B factor tube"||(b.style==="cylinder & plate"&&b.ss!=="helix")){var o=false;if(!o&&this.residues.hasOwnProperty(e)){var g=Object.keys(this.residues[e])[0];var m=this.hash2Atoms(this.residues[e])[g];if((b.style===m.style&&!m.ssbegin)||m.ssbegin){var p=this.residues[e];d=this.unionHash(d,p);o=true;if(m.ssbegin){for(var r in p){this.atoms[r].notshow=true}}}}if(!o&&this.residues.hasOwnProperty(a)){var g=Object.keys(this.residues[a])[0];var m=this.hash2Atoms(this.residues[a])[g];if(b.style===m.style){d=this.unionHash(d,this.residues[a]);o=true}}}else{if((b.style==="ribbon"&&b.ss!=="coil"&&b.ssend)||(b.style==="strand"&&b.ss!=="coil"&&b.ssend)){var o=false;if(!o&&this.residues.hasOwnProperty(e)){var g=Object.keys(this.residues[e])[0];var m=this.hash2Atoms(this.residues[e])[g];d=this.unionHash(d,this.residues[e]);o=true}}}}}}}this.setStyle2Atoms(d);for(var t in this.style2atoms){atomHash=this.style2atoms[t];if(t==="ribbon"){this.createStrand(this.hash2Atoms(atomHash),2,undefined,true,undefined,undefined,false,this.thickness,u)}else{if(t==="strand"){this.createStrand(this.hash2Atoms(atomHash),null,null,null,null,null,false,undefined,u)}else{if(t==="cylinder & plate"){this.createCylinderHelix(this.hash2Atoms(atomHash),1.6,u)}else{if(t==="nucleotide cartoon"){this.drawCartoonNucleicAcid(this.hash2Atoms(atomHash),null,this.thickness,u);if(u!==2){this.drawNucleicAcidStick(this.hash2Atoms(atomHash),u)}}else{if(t==="phosphorus trace"){this.createCylinderCurve(this.hash2Atoms(atomHash),"P",0.2,false,u)}else{if(t==="phosphorus lines"){this.createCylinderCurve(this.hash2Atoms(atomHash),"P",0.2,true,u)}else{if(t==="C alpha trace"){this.createCylinderCurve(this.hash2Atoms(atomHash),"CA",0.2,false,u)}else{if(t==="B factor tube"){this.createTube(this.hash2Atoms(atomHash),"CA",null,u)}else{if(t==="lines"){if(u===1){this.createStickRepresentation(this.hash2Atoms(atomHash),0.1,0.1,undefined,u)}else{this.createLineRepresentation(this.hash2Atoms(atomHash),u)}}else{if(t==="stick"){this.createStickRepresentation(this.hash2Atoms(atomHash),this.cylinderRadius,this.cylinderRadius,undefined,u)}else{if(t==="ball & stick"){this.createStickRepresentation(this.hash2Atoms(atomHash),this.cylinderRadius,this.cylinderRadius*0.5,0.3,u)}else{if(t==="sphere"){this.createSphereRepresentation(this.hash2Atoms(atomHash),this.sphereRadius,undefined,undefined,u)}else{if(t==="dot"){this.createSphereRepresentation(this.hash2Atoms(atomHash),this.sphereRadius,false,0.3,u)}}}}}}}}}}}}}}switch(c.wireframe){case"yes":c.wireframe=true;break;case"no":c.wireframe=false;break}c.opacity=parseFloat(c.opacity);if(c.showsurface.toLowerCase()==="yes"){var n={};n=this.hash2Atoms(this.highlightAtoms);switch(c.surface.toLowerCase()){case"van der waals surface":this.createSurfaceRepresentation(n,1,c.wireframe,c.opacity);break;case"solvent excluded surface":this.createSurfaceRepresentation(n,2,c.wireframe,c.opacity);break;case"solvent accessible surface":this.createSurfaceRepresentation(n,3,c.wireframe,c.opacity);break;case"molecular surface":this.createSurfaceRepresentation(n,4,c.wireframe,c.opacity);break}}},setStyle2Atoms:function(a){this.style2atoms={};for(var b in a){if(this.style2atoms[this.atoms[b].style]===undefined){this.style2atoms[this.atoms[b].style]={}}this.style2atoms[this.atoms[b].style][b]=1}},setAtomStyleByOptions:function(a){if(a.sidechains!==undefined){for(var b in this.peptides){this.atoms[b].style=a.sidechains.toLowerCase()}}if(a.secondary!==undefined){for(var b in this.peptides){this.atoms[b].style=a.secondary.toLowerCase()}}if(a.ligands!==undefined){for(var b in this.ligands){this.atoms[b].style=a.ligands.toLowerCase()}}if(a.ions!==undefined){for(var b in this.ions){this.atoms[b].style=a.ions.toLowerCase()}}if(a.water!==undefined){for(var b in this.water){this.atoms[b].style=a.water.toLowerCase()}}if(a.nucleotides!==undefined){for(var b in this.nucleotides){this.atoms[b].style=a.nucleotides.toLowerCase()}}},rebuildScene:function(b){jQuery.extend(this.options,b);this.scene=new THREE.Scene();this.directionalLight=new THREE.DirectionalLight(16777215,1.2);if(this.camera_z>0){this.directionalLight.position.set(0,0,1)}else{this.directionalLight.position.set(0,0,-1)}var a=new THREE.AmbientLight(2105376);this.scene.add(this.directionalLight);this.scene.add(a);this.mdl=new THREE.Object3D();this.scene.add(this.mdl);this.objects=[];this.raycaster=new THREE.Raycaster();this.projector=new THREE.Projector();this.mouse=new THREE.Vector2();var c=this.backgroundColors[this.options.background.toLowerCase()];this.renderer.setClearColor(c);this.perspectiveCamera=new THREE.PerspectiveCamera(20,this.container.whratio,0.1,10000);this.perspectiveCamera.position.set(0,0,this.camera_z);this.perspectiveCamera.lookAt(new THREE.Vector3(0,0,0));this.orthographicCamera=new THREE.OrthographicCamera();this.orthographicCamera.position.set(0,0,this.camera_z);this.orthographicCamera.lookAt(new THREE.Vector3(0,0,0));this.cameras={perspective:this.perspectiveCamera,orthographic:this.orthographicCamera,};this.setCamera();this.applyOptions(this.options)},setCamera:function(){this.camera=this.cameras[this.options.camera.toLowerCase()];if(this.camera===this.perspectiveCamera){if(this.camera_z>0){this.camera.position.z=this.maxD*2}else{this.camera.position.z=-this.maxD*2}this.controls=new THREE.TrackballControls(this.camera,document.getElementById(this.id),this)}else{if(this.camera===this.orthographicCamera){this.camera.right=this.maxD/2*2.5;this.camera.left=-this.camera.right;this.camera.top=this.camera.right/this.container.whratio;this.camera.bottom=-this.camera.right/this.container.whratio;if(this.camera_z>0){this.camera.near=10000;this.camera.far=-10000}else{this.camera.near=-10000;this.camera.far=10000}this.controls=new THREE.OrthographicTrackballControls(this.camera,document.getElementById(this.id),this)}}this.camera.updateProjectionMatrix()},applyTransformation:function(b,d,c){var a={};a.update=false;a._zoomFactor=b;a.mouseChange=new THREE.Vector2();a.mouseChange.copy(d);a.quaternion=new THREE.Quaternion();a.quaternion.copy(c);this.controls.update(a)},render:function(){this.directionalLight.position.copy(this.camera.position);this.renderer.gammaInput=true;this.renderer.gammaOutput=true;this.renderer.setPixelRatio(window.devicePixelRatio);this.renderer.render(this.scene,this.camera)},setRotationCenter:function(a){this.mdl.position.sub(a)},draw:function(a,b){this.rebuildScene(a);if(b===undefined||b){this.applyPrevColor()}if(this.bSSOnly){this.drawHelixBrick(this.molid2ss,this.molid2color)}if(this.bAssembly){this.drawSymmetryMates2()}if(this.highlightAtoms!==undefined&&Object.keys(this.highlightAtoms).length>0&&Object.keys(this.highlightAtoms).length<Object.keys(this.displayAtoms).length){this.removeHighlightObjects();this.addHighlightObjects(undefined,undefined)}if(this.bRender===true){this.applyTransformation(this._zoomFactor,this.mouseChange,this.quaternion);this.render()}},zoomIn:function(b){var a={};a._zoomFactor=1-b;a.update=true;this.controls.update(a);this.render()},zoomOut:function(b){var a={};a._zoomFactor=1+b;a.update=true;this.controls.update(a);this.render()},rotateLeft:function(d){var b=new THREE.Vector3(0,1,0);var e=-d/180*Math.PI;b.applyQuaternion(this.camera.quaternion).normalize();var c=new THREE.Quaternion();c.setFromAxisAngle(b,-e);var a={};a.quaternion=c;a.update=true;this.controls.update(a);this.render()},rotateRight:function(d){var b=new THREE.Vector3(0,1,0);var e=d/180*Math.PI;b.applyQuaternion(this.camera.quaternion).normalize();var c=new THREE.Quaternion();c.setFromAxisAngle(b,-e);var a={};a.quaternion=c;a.update=true;this.controls.update(a);this.render()},rotateUp:function(d){var b=new THREE.Vector3(1,0,0);var e=-d/180*Math.PI;b.applyQuaternion(this.camera.quaternion).normalize();var c=new THREE.Quaternion();c.setFromAxisAngle(b,-e);var a={};a.quaternion=c;a.update=true;this.controls.update(a);this.render()},rotateDown:function(d){var b=new THREE.Vector3(1,0,0);var e=d/180*Math.PI;b.applyQuaternion(this.camera.quaternion).normalize();var c=new THREE.Quaternion();c.setFromAxisAngle(b,-e);var a={};a.quaternion=c;a.update=true;this.controls.update(a);this.render()},translateLeft:function(b){var c=new THREE.Vector2(0,0);c.x-=b/100;var a={};a.mouseChange=c;a.update=true;this.controls.update(a);this.render()},translateRight:function(b){var c=new THREE.Vector2(0,0);c.x+=b/100;var a={};a.mouseChange=c;a.update=true;this.controls.update(a);this.render()},translateUp:function(b){var c=new THREE.Vector2(0,0);c.y-=b/100;var a={};a.mouseChange=c;a.update=true;this.controls.update(a);this.render()},translateDown:function(b){var c=new THREE.Vector2(0,0);c.y+=b/100;var a={};a.mouseChange=c;a.update=true;this.controls.update(a);this.render()},showPicking:function(d){this.removeHighlightObjects();this.highlightAtoms={};if(this.picking===1){this.highlightAtoms[d.serial]=1}else{if(this.picking===2){var c=d.structure+"_"+d.chain+"_"+d.resi;this.highlightAtoms=this.residues[c]}}this.addHighlightObjects();var a="."+d.chain+":"+d.resi;var e=a+"@"+d.name;var f=[];var b={};b.position=d.coord;if(this.picking===1){b.text=e}else{if(this.picking===2){b.text=a}}f.push(b);this.createLabelRepresentation(f)},removeHighlightObjects:function(){for(var a in this.prevHighlightObjects){this.mdl.remove(this.prevHighlightObjects[a])}this.prevHighlightObjects=[];this.render()},addHighlightObjects:function(a){if(a===undefined){a=this.highlightColor}this.applyDisplayOptions(this.options,this.intersectHash(this.highlightAtoms,this.displayAtoms),this.bHighlight);this.render()},zoominSelection:function(){if(Object.keys(this.highlightAtoms).length>1){var a=this.centerAtoms(this.hash2Atoms(this.highlightAtoms));this.maxD=a.maxD;if(this.maxD<25){this.maxD=25}this.mdl.position.add(this.center).sub(a.center);this.center=a.center;this.setCamera()}this.render()}};
/*! full_ui.js
 * UI with full features
 */
if(typeof jQuery==="undefined"){throw new Error("iCn3DUI requires jQuery")}if(typeof iCn3D==="undefined"){throw new Error("iCn3DUI requires iCn3D")}if(!$.ui.dialog.prototype._makeDraggableBase){$.ui.dialog.prototype._makeDraggableBase=$.ui.dialog.prototype._makeDraggable;$.ui.dialog.prototype._makeDraggable=function(){this._makeDraggableBase();this.uiDialog.draggable("option","containment",false)}}var iCn3DUI=function(a){var b=this;b.cfg=a;b.divid=b.cfg.divid;b.pre=b.divid+"_";b.inputid="";b.RESIDUE_WIDTH=10;b.RESIDUE_WIDTH2=10;b.MENU_HEIGHT=40;b.MENU_WIDTH=690;b.LESSWIDTH=20;b.LESSHEIGHT=20;b.ROTATION_DIRECTION="right";b.HIDE_SELECTION=true;b.ALTERNATE_STRUCTURE=-1;b.EXTRAHEIGHT=2*b.MENU_HEIGHT;if(b.cfg.showmenu!=undefined&&b.cfg.showmenu==false){b.EXTRAHEIGHT=0}b.SELECT_RESIDUE=false;b.selectedResidues={};b.CRASHED=false;b.prevCommands="";b.options={};b.options.camera="perspective";b.options.background="black";b.options.color="spectrum";b.options.sidechains="nothing";b.options.secondary="ribbon";b.options.surface="Van der Waals surface";b.options.opacity="0.8";b.options.wireframe="no";b.options.ligands="stick";b.options.water="nothing";b.options.ions="sphere";b.options.hbonds="no";b.options.labels="no";b.options.lines="no";b.options.rotationcenter="molecule center";b.options.axis="no";b.options.picking="residue";b.options.nucleotides="phosphorus trace";b.options.surfaceregion="nothing";if(b.cfg.cid!==undefined){b.options.picking="atom"}b.modifyIcn3d()};iCn3DUI.prototype={constructor:iCn3DUI,modifyIcn3d:function(){var a=this;a.modifyIcn3dShowPicking()},modifyIcn3dShowPicking:function(){var a=this;iCn3D.prototype.showPicking=function(e){this.removeHighlightObjects();this.highlightAtoms={};if(this.picking===1){this.highlightAtoms[e.serial]=1}else{if(this.picking===2){var b=e.structure+"_"+e.chain+"_"+e.resi;this.highlightAtoms=this.residues[b]}}this.addHighlightObjects();if(this.picking===2){var c=this.id.split("_");a.pre=c[0]+"_";var f=e.structure+"_"+e.chain+"_"+e.resi;a.clearSelection();a.removeSeqChainBkgd();a.removeSeqResidueBkgd();if($("#"+a.pre+f).length!==0){$("#"+a.pre+f).addClass("highlightSeq")}}else{if(this.picking===1){a.removeSeqChainBkgd();a.removeSeqResidueBkgd()}}var d={};d.factor=this._zoomFactor;d.mouseChange=this.mouseChange;d.quaternion=this.quaternion;this.commands.push("pickatom "+e.serial+"|||"+JSON.stringify(d));this.logs.push("pickatom "+e.serial+" (chain: "+e.structure+"_"+e.chain+", residue: "+e.resn+", number: "+e.resi+", atom: "+e.name+")");if($("#"+a.pre+"logtext").length){$("#"+a.pre+"logtext").val("> "+this.logs.join("\n> ")+"\n> ").scrollTop($("#"+a.pre+"logtext")[0].scrollHeight)}}},show3DStructure:function(){var a=this;a.deferred=$.Deferred(function(){if(a.isSessionStorageSupported()){a.getCommandsBeforeCrash()}var g=window.innerWidth,d=window.innerHeight;if(a.cfg.width.toString().indexOf("%")!==-1){g=g*a.cfg.width.substr(0,a.cfg.width.toString().indexOf("%"))/100-a.LESSWIDTH}else{g=a.cfg.width}if(a.cfg.height.toString().indexOf("%")!==-1){d=d*a.cfg.height.substr(0,a.cfg.height.toString().indexOf("%"))/100-a.EXTRAHEIGHT-a.LESSHEIGHT}else{d=a.cfg.height}a.setMenu(a.divid);a.allEventFunctions();if(a.cfg.showmenu!=undefined&&a.cfg.showmenu==false){a.EXTRAHEIGHT=0;a.hideMenu(g,d)}else{a.EXTRAHEIGHT=2*a.MENU_HEIGHT;a.showMenu(g,d)}a.icn3d=new iCn3D(a.pre+"canvas");$("#"+a.pre+"canvas").width(g).height(d);var c=parseInt(d)+a.EXTRAHEIGHT;$("#"+a.pre+"viewer").width(g).height(c);a.icn3d.setWidthHeight(g,d);if(a.cfg.bCalphaOnly!==undefined){a.icn3d.bCalphaOnly=a.cfg.bCalphaOnly}a.icn3d.cloneHash(a.options,a.icn3d.options);a.STATENUMBER=a.icn3d.commands.length;if(a.isSessionStorageSupported()&&a.CRASHED){a.CRASHED=false;var f=a.commandsBeforeCrash.split("|||")[0];var i=f.substr(f.lastIndexOf(" ")+1);if(i===a.cfg.pdbid||i===a.cfg.mmdbid||i===a.cfg.gi||i===a.cfg.cid||i===a.cfg.mmcif||i===a.cfg.align){a.loadStateFile(a.commandsBeforeCrash);return}}if(a.cfg.pdbid!==undefined){a.inputid=a.cfg.pdbid;var h=document.location.protocol;var e=a.cfg.pdbid;if(h==="http:"){a.setLogCommand("load pdb "+a.cfg.pdbid,true);a.downloadPdb(e)}else{if(h==="https:"){a.setLogCommand("load mmdb "+a.cfg.pdbid,true);a.downloadMmdb(e)}}}else{if(a.cfg.mmdbid!==undefined){a.inputid=a.cfg.mmdbid;a.icn3d.moleculeTitle="MMDB ID "+a.cfg.mmdbid;a.setLogCommand("load mmdb "+a.cfg.mmdbid,true);a.downloadMmdb(a.cfg.mmdbid)}else{if(a.cfg.gi!==undefined){a.inputid=a.cfg.gi;a.icn3d.moleculeTitle="Protein gi "+a.cfg.mmdbid;a.setLogCommand("load gi "+a.cfg.gi,true);a.downloadGi(a.cfg.gi)}else{if(a.cfg.cid!==undefined){a.inputid=a.cfg.cid;a.icn3d.moleculeTitle="PubChem CID "+a.cfg.cid;a.setLogCommand("load cid "+a.cfg.cid,true);a.downloadCid(a.cfg.cid)}else{if(a.cfg.mmcif!==undefined){a.inputid=a.cfg.mmcif;a.icn3d.moleculeTitle="mmCIF "+a.cfg.mmcif;a.setLogCommand("load mmcif "+a.cfg.mmcif,true);a.downloadMmcif(a.cfg.mmcif)}else{if(a.cfg.align!==undefined){var b=a.cfg.align.split(",");a.inputid=b[0]+"_"+b[3];a.icn3d.moleculeTitle="Structure Alignment of MMDB ID "+b[0]+" (BioUnit "+b[1]+", Molecule "+b[2]+") and MMDB ID "+b[3]+" (BioUnit "+b[4]+", Molecule "+b[5]+")";a.setLogCommand("load alignment "+a.cfg.align,true);a.downloadAlignment(a.cfg.align)}else{alert("Please input a gi, MMDB ID, PDB ID, CID, or mmCIF...")}}}}}}});return a.deferred},clearSelection:function(){var a=this;$("#"+a.pre+"chainid").val("");$("#"+a.pre+"structureid").val("");$("#"+a.pre+"alignChainid").val("");$("#"+a.pre+"customResidues").val("");$("#"+a.pre+"chainid2").val("");$("#"+a.pre+"structureid2").val("");$("#"+a.pre+"alignChainid2").val("");$("#"+a.pre+"customResidues2").val("");$("#"+a.pre+"customAtoms").val("")},removeSeqChainBkgd:function(a){$(".seqTitle").each(function(b){if(a===undefined){$(this).removeClass("highlightSeq")}else{if($(this).attr("chain")!==a){$(this).removeClass("highlightSeq")}}})},removeSeqResidueBkgd:function(){$(".residue").each(function(a){$(this).removeClass("highlightSeq")})},hideMenu:function(b,a){var c=this;if($("#"+c.pre+"menulist")[0]!==undefined){$("#"+c.pre+"menulist")[0].style.display="none"}if($("#"+c.pre+"menuLogSection")[0]!==undefined){$("#"+c.pre+"menuLogSection")[0].style.display="none"}if($("#"+c.pre+"commandlog")[0]!==undefined){$("#"+c.pre+"commandlog")[0].style.display="none"}if($("#"+c.pre+"selection")[0]!==undefined){$("#"+c.pre+"selection")[0].style.display="none"}$("#"+c.pre+"viewer").width(b).height(a);$("#"+c.pre+"canvas").width(b).height(a)},showMenu:function(c,b){var d=this;if($("#"+d.pre+"menulist")[0]!==undefined){$("#"+d.pre+"menulist")[0].style.display="block"}if($("#"+d.pre+"menuLogSection")[0]!==undefined){$("#"+d.pre+"menuLogSection")[0].style.display="block"}if($("#"+d.pre+"commandlog")[0]!==undefined){$("#"+d.pre+"commandlog")[0].style.display="block"}if($("#"+d.pre+"selection")[0]!==undefined){$("#"+d.pre+"selection")[0].style.display="block"}var a=parseInt(b)+d.EXTRAHEIGHT;$("#"+d.pre+"viewer").width(c).height(a);$("#"+d.pre+"canvas").width(c).height(b)},resizeCanvas:function(c,b){var d=this;if(d.cfg.resize!==undefined&&d.cfg.resize&&!d.isMobile()){var a=parseInt(b)-d.EXTRAHEIGHT;$("#"+d.pre+"canvas").width(c).height(a);$("#"+d.pre+"viewer").width(c).height(b);d.icn3d.setWidthHeight(c,a);d.icn3d.draw()}},setOption:function(e,c){var b=this;var d={};d[e]=c;if(e==="color"){b.icn3d.setColorByOptions(d,b.icn3d.highlightAtoms);if(b.icn3d.chainsColor&&Object.keys(b.icn3d.chainsColor).length>0){var a=b.getSequencesAnnotations(Object.keys(b.icn3d.chains),false);$("#"+b.pre+"dl_sequence").html(a.sequencesHtml);$("#"+b.pre+"dl_sequence").width(b.RESIDUE_WIDTH*a.maxSeqCnt+200);a=b.getAlignSequencesAnnotations(Object.keys(b.icn3d.alignChains),false);$("#"+b.pre+"dl_sequence2").html(a.sequencesHtml);$("#"+b.pre+"dl_sequence2").width(b.RESIDUE_WIDTH2*a.maxSeqCnt+200)}}b.icn3d.draw(d)},setStyle:function(d,c){var e=this;var a={};switch(d){case"protein":a=e.icn3d.intersectHash(e.icn3d.highlightAtoms,e.icn3d.peptides);break;case"nucleotides":a=e.icn3d.intersectHash(e.icn3d.highlightAtoms,e.icn3d.nucleotides);break;case"ligands":a=e.icn3d.intersectHash(e.icn3d.highlightAtoms,e.icn3d.ligands);break;case"ions":a=e.icn3d.intersectHash(e.icn3d.highlightAtoms,e.icn3d.ions);break;case"water":a=e.icn3d.intersectHash(e.icn3d.highlightAtoms,e.icn3d.water);break}for(var b in a){e.icn3d.atoms[b].style=c}e.icn3d.draw()},setLogCommand:function(d,a){var c=this;var b={};b.factor=c.icn3d._zoomFactor;b.mouseChange=c.icn3d.mouseChange;b.quaternion=c.icn3d.quaternion;if(a){c.icn3d.commands.push(d+"|||"+JSON.stringify(b));if(c.isSessionStorageSupported()){c.saveCommandsToSession()}c.STATENUMBER=c.icn3d.commands.length}c.icn3d.logs.push(d);$("#"+c.pre+"logtext").val("> "+c.icn3d.logs.join("\n> ")+"\n> ").scrollTop($("#"+c.pre+"logtext")[0].scrollHeight)},openDialog:function(g,f){var e=this;var c=400,b=150;var d=e.isMac()&&!e.isMobile();if(g===e.pre+"dl_selectresidues"||g===e.pre+"dl_alignment"){if($(window).width()>$(window).height()){e.resizeCanvas(0.5*$(window).width(),$(window).height()-e.LESSHEIGHT);b=d?"auto":$(window).height()-e.LESSHEIGHT-2*e.MENU_HEIGHT;c=d?"auto":0.5*$(window).width()-e.LESSWIDTH;var a={my:"left top",at:"right top",of:"#"+e.pre+"canvas",collision:"none"};e.cfg.resize=false;window.dialog=$("#"+g).dialog({autoOpen:true,title:f,height:b,width:c,modal:false,position:a,close:function(h){e.cfg.resize=true;e.resizeCanvas($(window).width()-e.LESSWIDTH,$(window).height()-e.LESSHEIGHT)}})}else{if(e.isMobile()){e.resizeCanvas($(window).width()-e.LESSWIDTH,$(window).height()-e.LESSHEIGHT-30)}b=d?"auto":250;c=d?"auto":$(window).width()-e.LESSWIDTH;var a={my:"left top",at:"left bottom-30",of:"#"+e.pre+"canvas",collision:"none"};window.dialog=$("#"+g).dialog({autoOpen:true,title:f,height:b,width:c,modal:false,position:a})}}else{b="auto";c="auto";var a={my:"left top",at:"left bottom-30",of:"#"+e.pre+"canvas",collision:"none"};window.dialog=$("#"+g).dialog({autoOpen:true,title:f,height:b,width:c,modal:false,position:a})}$(".ui-dialog .ui-button span").removeClass("ui-icon-closethick").addClass("ui-icon-close")},renderStructure:function(g){var e=this;var c=e.getStructureSelections(g);var f=e.getChainSelections(g);var h=e.getAlignChainSelections();var b=e.getResidueSelections();var a=e.getAtomSelections();if($("#"+e.pre+"structureid")){$("#"+e.pre+"structureid").html(c)}if($("#"+e.pre+"chainid")){$("#"+e.pre+"chainid").html(f)}if($("#"+e.pre+"alignChainid")){$("#"+e.pre+"alignChainid").html(h)}if($("#"+e.pre+"customResidues")){$("#"+e.pre+"customResidues").html(b)}if($("#"+e.pre+"structureid2")){$("#"+e.pre+"structureid2").html(c)}if($("#"+e.pre+"chainid2")){$("#"+e.pre+"chainid2").html(f)}if($("#"+e.pre+"alignChainid2")){$("#"+e.pre+"alignChainid2").html(h)}if($("#"+e.pre+"customResidues2")){$("#"+e.pre+"customResidues2").html(b)}if($("#"+e.pre+"customAtoms")){$("#"+e.pre+"customAtoms").html(a)}var d=e.getSequencesAnnotations(Object.keys(e.icn3d.chains));if($("#"+e.pre+"dl_sequence")){$("#"+e.pre+"dl_sequence").html(d.sequencesHtml);$("#"+e.pre+"dl_sequence").width(e.RESIDUE_WIDTH*d.maxSeqCnt+200)}d=e.getAlignSequencesAnnotations(Object.keys(e.icn3d.alignChains));if($("#"+e.pre+"dl_sequence2")){$("#"+e.pre+"dl_sequence2").html(d.sequencesHtml);$("#"+e.pre+"dl_sequence2").width(e.RESIDUE_WIDTH2*d.maxSeqCnt+200)}if(g){e.icn3d.draw(e.options)}else{e.icn3d.draw()}if(e.cfg.command!==undefined){e.loadStateFile(e.cfg.command)}},downloadPdb:function(a){var c=this;var b="//www.ncbi.nlm.nih.gov/Structure/mmcifparser/mmcifparser.cgi?pdbid="+a;c.icn3d.bCid=undefined;$.ajax({url:b,dataType:"text",cache:true,beforeSend:function(){if($("#"+c.pre+"wait")){$("#"+c.pre+"wait").show()}if($("#"+c.pre+"canvas")){$("#"+c.pre+"canvas").hide()}if($("#"+c.pre+"log")){$("#"+c.pre+"log").hide()}},complete:function(){if($("#"+c.pre+"wait")){$("#"+c.pre+"wait").hide()}if($("#"+c.pre+"canvas")){$("#"+c.pre+"canvas").show()}if($("#"+c.pre+"log")){$("#"+c.pre+"log").show()}},success:function(d){c.loadPdbData(d)}})},loadPdbData:function(b){var a=this;a.icn3d.loadPDB(b);a.pmid=a.icn3d.pmid;if(a.cfg.align===undefined&&Object.keys(a.icn3d.structures).length==1){$("#"+a.pre+"alternateWrapper").hide()}a.icn3d.inputid.idtype="pdbid";a.icn3d.inputid.id=pdbid;a.icn3d.setAtomStyleByOptions(a.options);a.icn3d.setColorByOptions(a.options,a.icn3d.atoms);a.renderStructure(true);if(a.cfg.rotate!==undefined){a.rotateStructure(a.cfg.rotate,true)}if(a.deferred!==undefined){a.deferred.resolve()}if(a.deferred2!==undefined){a.deferred2.resolve()}},rotateStructure:function(b,c){var a=this;if(a.icn3d.bStopRotate){return false}if(c!==undefined&&c){if(b==="left"){a.ROTATION_DIRECTION="left"}else{if(b==="right"){a.ROTATION_DIRECTION="right"}else{if(b==="up"){a.ROTATION_DIRECTION="up"}else{if(b==="down"){a.ROTATION_DIRECTION="down"}else{return false}}}}}if(b==="left"&&a.ROTATION_DIRECTION==="left"){a.icn3d.rotateLeft(5)}else{if(b==="right"&&a.ROTATION_DIRECTION==="right"){a.icn3d.rotateRight(5)}else{if(b==="up"&&a.ROTATION_DIRECTION==="up"){a.icn3d.rotateUp(5)}else{if(b==="down"&&a.ROTATION_DIRECTION==="down"){a.icn3d.rotateDown(5)}else{return false}}}}setTimeout(function(){a.rotateStructure(b)},1000)},downloadMmcif:function(b){var c=this;var a="//www.ncbi.nlm.nih.gov/Structure/mmcifparser/mmcifparser.cgi?mmcif="+b;c.icn3d.bCid=undefined;$.ajax({url:a,dataType:"jsonp",cache:true,beforeSend:function(){if($("#"+c.pre+"wait")){$("#"+c.pre+"wait").show()}if($("#"+c.pre+"canvas")){$("#"+c.pre+"canvas").hide()}if($("#"+c.pre+"log")){$("#"+c.pre+"log").hide()}},complete:function(){if($("#"+c.pre+"wait")){$("#"+c.pre+"wait").hide()}if($("#"+c.pre+"canvas")){$("#"+c.pre+"canvas").show()}if($("#"+c.pre+"log")){$("#"+c.pre+"log").show()}},success:function(d){c.loadMmcifData(d)}})},loadMmcifData:function(g){var f=this;if(g.atoms!==undefined){f.loadAtomDataIn(g,g.mmcif,"mmcif");if(f.cfg.align===undefined&&Object.keys(f.icn3d.structures).length==1){$("#"+f.pre+"alternateWrapper").hide()}var b=g.assembly;for(var e=0,a=b.length;e<a;++e){if(f.icn3d.biomtMatrices[e]==undefined){f.icn3d.biomtMatrices[e]=new THREE.Matrix4().identity()}for(var c=0,d=b[e].length;c<d;++c){f.icn3d.biomtMatrices[e].elements[c]=b[e][c]}}f.icn3d.inputid.idtype="mmcif";f.icn3d.inputid.id=mmcif;f.icn3d.setAtomStyleByOptions(f.options);f.icn3d.setColorByOptions(f.options,f.icn3d.atoms);f.renderStructure(true);if(f.cfg.rotate!==undefined){f.rotateStructure(f.cfg.rotate,true)}if(f.deferred!==undefined){f.deferred.resolve()}if(f.deferred2!==undefined){f.deferred2.resolve()}}else{alert("invalid atoms data.");return false}},downloadAlignment:function(g){var c=this;var a="//structure.ncbi.nlm.nih.gov/Structure/vastpp/vastpp.cgi?cmd=c&w3d&ids="+g;var e="//structure.ncbi.nlm.nih.gov/Structure/vastpp/vastpp.cgi?cmd=c1&d&ids="+g;if(c.cfg.inpara!==undefined){a+=c.cfg.inpara;e+=c.cfg.inpara}c.icn3d.bCid=undefined;c.icn3d.pdbid_chain2title={};var b=$.ajax({url:e,dataType:"jsonp",cache:true,beforeSend:function(){if($("#"+c.pre+"wait")){$("#"+c.pre+"wait").show()}if($("#"+c.pre+"canvas")){$("#"+c.pre+"canvas").hide()}if($("#"+c.pre+"log")){$("#"+c.pre+"log").hide()}},complete:function(){if($("#"+c.pre+"wait")){$("#"+c.pre+"wait").hide()}if($("#"+c.pre+"canvas")){$("#"+c.pre+"canvas").show()}if($("#"+c.pre+"log")){$("#"+c.pre+"log").show()}}});var f={};var d=b.then(function(m){f=m.seqalign;var k=0;for(var n in m){if(k<2){var i=m[n].pdbid;var h=m[n].molecule;for(var j in h){var l=h[j].chain;c.icn3d.pdbid_chain2title[i+"_"+l]=h[j].name}}++k}return $.ajax({url:a,dataType:"jsonp",cache:true,beforeSend:function(){if($("#"+c.pre+"wait")){$("#"+c.pre+"wait").show()}if($("#"+c.pre+"canvas")){$("#"+c.pre+"canvas").hide()}if($("#"+c.pre+"log")){$("#"+c.pre+"log").hide()}},complete:function(){if($("#"+c.pre+"wait")){$("#"+c.pre+"wait").hide()}if($("#"+c.pre+"canvas")){$("#"+c.pre+"canvas").show()}if($("#"+c.pre+"log")){$("#"+c.pre+"log").show()}}})});d.done(function(h){if(h.atoms!==undefined){c.loadAtomDataIn(h,undefined,"align",f);if(c.cfg.align===undefined&&Object.keys(c.icn3d.structures).length==1){$("#"+c.pre+"alternateWrapper").hide()}c.icn3d.inputid.idtype="alignment";c.icn3d.inputid.id=g;c.icn3d.setAtomStyleByOptions(c.options);c.icn3d.setColorByOptions(c.options,c.icn3d.atoms,true);c.renderStructure(true);if(c.cfg.rotate!==undefined){c.rotateStructure(c.cfg.rotate,true)}if(c.cfg.bShowSeqByDefault!==undefined&&c.cfg.bShowSeqByDefault){c.openDialog(c.pre+"dl_alignment","Select residues in aligned sequences")}if(c.deferred!==undefined){c.deferred.resolve()}if(c.deferred2!==undefined){c.deferred2.resolve()}}else{alert("invalid atoms data.");return false}})},downloadCid:function(c){var b=this;var a="//pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+c+"/record/SDF/?record_type=3d&response_type=display";b.icn3d.bCid=true;$.ajax({url:a,dataType:"text",cache:true,beforeSend:function(){if($("#"+b.pre+"wait")){$("#"+b.pre+"wait").show()}if($("#"+b.pre+"canvas")){$("#"+b.pre+"canvas").hide()}if($("#"+b.pre+"log")){$("#"+b.pre+"log").hide()}},complete:function(){if($("#"+b.pre+"wait")){$("#"+b.pre+"wait").hide()}if($("#"+b.pre+"canvas")){$("#"+b.pre+"canvas").show()}if($("#"+b.pre+"log")){$("#"+b.pre+"log").show()}},success:function(e){var d=b.loadCidAtomData(e);if(b.cfg.align===undefined&&Object.keys(b.icn3d.structures).length==1){$("#"+b.pre+"alternateWrapper").hide()}if(!d){alert("The SDF of CID "+c+" has the wrong format...")}else{b.icn3d.inputid.idtype="cid";b.icn3d.inputid.id=c;b.icn3d.setAtomStyleByOptions(b.options);b.icn3d.setColorByOptions(b.options,b.icn3d.atoms);b.renderStructure(true);if(b.cfg.rotate!==undefined){b.rotateStructure(b.cfg.rotate,true)}if(b.deferred!==undefined){b.deferred.resolve()}if(b.deferred2!==undefined){b.deferred2.resolve()}}}}).fail(function(){alert("This CID may not have 3D structure...")})},loadCidAtomData:function(K){var J=this;var a=K.split("\n");if(a.length<4){return false}J.icn3d.init();var L="1";var v="A";var F=1;var w="LIG";var u=L;var n=L+"_"+v;var t=n+"_"+F;var I=parseInt(a[3].substr(0,3));if(isNaN(I)||I<=0){return false}var h=parseInt(a[3].substr(3,3));var j=4;if(a.length<j+I+h){return false}var g=0;var e=I;var G,r;var d={};for(G=g;G<e;G++){r=a[j];j++;var f=G;var q=parseFloat(r.substr(0,10));var o=parseFloat(r.substr(10,10));var m=parseFloat(r.substr(20,10));var A=new THREE.Vector3(q,o,m);var M=r.substr(31,3).replace(/ /g,"");var l={het:true,serial:f,name:M,resn:w,structure:L,chain:v,resi:F,coord:A,b:0,elem:M,bonds:[],ss:"coil",ssbegin:false,ssend:false,bondOrder:[]};J.icn3d.atoms[f]=l;d[f]=1}J.icn3d.displayAtoms=d;J.icn3d.highlightAtoms=d;J.icn3d.structures[u]=[n];J.icn3d.chains[n]=d;J.icn3d.residues[t]=d;J.icn3d.residueId2Name[t]=w;if(J.icn3d.chainsSeq[n]===undefined){J.icn3d.chainsSeq[n]=[]}if(J.icn3d.chainsAnno[n]===undefined){J.icn3d.chainsAnno[n]=[]}if(J.icn3d.chainsAnno[n][0]===undefined){J.icn3d.chainsAnno[n][0]=[]}if(J.icn3d.chainsAnnoTitle[n]===undefined){J.icn3d.chainsAnnoTitle[n]=[]}if(J.icn3d.chainsAnnoTitle[n][0]===undefined){J.icn3d.chainsAnnoTitle[n][0]=[]}var E={};E.resi=F;E.name=w;J.icn3d.chainsSeq[n].push(E);J.icn3d.chainsAnno[n][0].push(F);J.icn3d.chainsAnnoTitle[n][0].push("");for(G=0;G<h;G++){r=a[j];j++;var B=parseInt(r.substr(0,3))-1+g;var c=parseInt(r.substr(3,3))-1+g;var D=parseInt(r.substr(6,3));J.icn3d.atoms[B].bonds.push(c);J.icn3d.atoms[B].bondOrder.push(D);J.icn3d.atoms[c].bonds.push(B);J.icn3d.atoms[c].bondOrder.push(D)}var k=new THREE.Vector3(9999,9999,9999);var p=new THREE.Vector3(-9999,-9999,-9999);var H=new THREE.Vector3();var C=0;for(var G in J.icn3d.atoms){var b=J.icn3d.atoms[G];var A=b.coord;H.add(A);k.min(A);p.max(A);++C;if(b.het){if($.inArray(b.elem,J.icn3d.ionsArray)!==-1){J.icn3d.ions[b.serial]=1}else{J.icn3d.ligands[b.serial]=1}}}J.icn3d.pmin=k;J.icn3d.pmax=p;J.icn3d.cnt=C;J.icn3d.maxD=J.icn3d.pmax.distanceTo(J.icn3d.pmin);J.icn3d.center=H.multiplyScalar(1/J.icn3d.cnt);if(J.icn3d.maxD<25){J.icn3d.maxD=25}return true},downloadMmdb:function(c){var b=this;var a="//www.ncbi.nlm.nih.gov/Structure/mmdb/mmdb_strview.cgi?program=w3d&uid="+c;b.icn3d.bCid=undefined;if(b.cfg.inpara!==undefined){a+=b.cfg.inpara}$.ajax({url:a,dataType:"jsonp",cache:true,beforeSend:function(){if($("#"+b.pre+"wait")){$("#"+b.pre+"wait").show()}if($("#"+b.pre+"canvas")){$("#"+b.pre+"canvas").hide()}if($("#"+b.pre+"log")){$("#"+b.pre+"log").hide()}},complete:function(){if($("#"+b.pre+"wait")){$("#"+b.pre+"wait").hide()}if($("#"+b.pre+"canvas")){$("#"+b.pre+"canvas").show()}if($("#"+b.pre+"log")){$("#"+b.pre+"log").show()}},success:function(M){if((b.cfg.inpara!==undefined&&b.cfg.inpara.indexOf("mols=")!=-1)||(M.atomcount<=M.threshold&&M.atoms!==undefined)){var B=(M.pdbId!==undefined)?M.pdbId:M.mmdbId;b.loadAtomDataIn(M,B,"mmdbid");if(b.cfg.align===undefined&&Object.keys(b.icn3d.structures).length==1){if($("#"+b.pre+"alternateWrapper")!==null){$("#"+b.pre+"alternateWrapper").hide()}}b.icn3d.inputid.idtype="mmdbid";b.icn3d.inputid.id=B;b.icn3d.setAtomStyleByOptions(b.options);b.icn3d.setColorByOptions(b.options,b.icn3d.atoms,true);b.renderStructure(true);if(b.cfg.rotate!==undefined){b.rotateStructure(b.cfg.rotate,true)}}if(b.cfg.inpara!==undefined&&b.cfg.inpara.indexOf("mols=")==-1&&M.atomcount>M.threshold&&M.molid2rescount!==undefined){var y=40;b.icn3d.bSSOnly=true;var B=(M.pdbId!==undefined)?M.pdbId:M.mmdbId;b.loadAtomDataIn(M,B,"mmdbid");b.icn3d.inputid.idtype="mmdbid";b.icn3d.inputid.id=B;b.options.nucleotides="phosphorus lines";b.icn3d.setAtomStyleByOptions(b.options);b.icn3d.setColorByOptions(b.options,b.icn3d.atoms,true);var E=M.molid2rescount;var t={},o={},G={};var w="<table width='100%'><tr><td></td><th>#</th><th align='center'>Chain</th><th align='center'>Residue Count</th></tr>";var A=1;for(var I in E){var v="#"+("000000"+E[I].color.toString(16)).slice(-6);w+="<tr style='color:"+v+"'><td><input type='checkbox' name='"+b.pre+"filter_ckbx' value='"+I+"'/></td><td align='center'>"+A+"</td><td align='center'>"+E[I].chain+"</td><td align='center'>"+E[I].resCount+"</td></tr>";t[I]=v;var N=B+"_"+E[I].chain;o[N]=I;G[I]=N;++A}if(Object.keys(b.icn3d.ligands).length>0){w+="<tr><td><input type='checkbox' name='"+b.pre+"filter_ckbx' value='ligands'/></td><td align='center'>"+A+"</td><td align='center'>Ligands</td><td align='center'>"+Object.keys(b.icn3d.ligands).length+" atoms</td></tr>"}w+="</table>";var h={};for(var I in b.icn3d.chains){var F={};var D=b.icn3d.centerAtoms(b.icn3d.hash2Atoms(b.icn3d.chains[I])).center;F.position=D;var N=I.substr(I.indexOf("_")+1);F.text=N;F.size=y;F.color=t[o[I]];F.background="#FFFFFF";h[o[I]]=F}molid2ss={};for(var I in M.helix){for(var H=0,k=M.helix[I].length;H<k;++H){var P=M.helix[I][H];var C={};C.type="helix";C.startResi=P.from;C.endResi=P.to;C.coords=[];C.coords.push(P.end);C.coords.push(P.start);if(molid2ss[I]===undefined){molid2ss[I]=[]}molid2ss[I].push(C)}}for(var I in M.brick){for(var H=0,k=M.brick[I].length;H<k;++H){var p=M.brick[I][H];var C={};C.type="brick";C.startResi=p.from;C.endResi=p.to;C.coords=[];var u={},m={},g={};u.x=0.25*(p["000"][0]+p["010"][0]+p["011"][0]+p["001"][0]);u.y=0.25*(p["000"][1]+p["010"][1]+p["011"][1]+p["001"][1]);u.z=0.25*(p["000"][2]+p["010"][2]+p["011"][2]+p["001"][2]);m.x=0.25*(p["100"][0]+p["110"][0]+p["111"][0]+p["101"][0]);m.y=0.25*(p["100"][1]+p["110"][1]+p["111"][1]+p["101"][1]);m.z=0.25*(p["100"][2]+p["110"][2]+p["111"][2]+p["101"][2]);g.x=p["010"][0]-p["000"][0];g.y=p["010"][1]-p["000"][1];g.z=p["010"][2]-p["000"][2];C.coords.push(u);C.coords.push(m);C.coords.push(g);if(molid2ss[I]===undefined){molid2ss[I]=[]}molid2ss[I].push(C)}}for(var I in molid2ss){molid2ss[I].sort(function(j,i){return parseFloat(j.startResi)-parseFloat(i.startResi)})}if(b.icn3d.cnt!==0){var L=b.icn3d.pmin;var r=b.icn3d.pmax;var l=b.icn3d.center.multiplyScalar(b.icn3d.cnt);var q=b.icn3d.cnt}else{var L=new THREE.Vector3(9999,9999,9999);var r=new THREE.Vector3(-9999,-9999,-9999);var l=new THREE.Vector3();var q=0}for(var I in molid2ss){var O=new THREE.Vector3(9999,9999,9999);var f=new THREE.Vector3(-9999,-9999,-9999);var K=new THREE.Vector3();var x=0;for(var H=0,k=molid2ss[I].length;H<k;++H){var n=molid2ss[I][H].coords[0];L.min(n);r.max(n);l.add(n);O.min(n);f.max(n);K.add(n);++q;++x;n=molid2ss[I][H].coords[1];L.min(n);r.max(n);l.add(n);O.min(n);f.max(n);K.add(n);++q;++x}var J=K.multiplyScalar(1/x);var F={};var D=new THREE.Vector3();D.x=J.x;D.y=J.y;D.z=J.z;F.position=D;var N=G[I];F.text=N.substr(N.indexOf("_")+1);F.size=y;F.color=t[I];F.background="#FFFFFF";h[I]=F}b.icn3d.maxD=r.distanceTo(L);b.icn3d.center=l.multiplyScalar(1/q);for(var I in molid2ss){for(var H=1,k=molid2ss[I].length;H<k;++H){var C={};C.type="coil";C.startResi=molid2ss[I][H-1].endResi;C.endResi=molid2ss[I][H].startResi;C.coords=[];C.coords.push(molid2ss[I][H-1].coords[1]);C.coords.push(molid2ss[I][H].coords[0]);molid2ss[I].push(C)}}b.icn3d.savedLabels=h;b.icn3d.molid2ss=molid2ss;b.icn3d.molid2color=t;b.renderStructure(true);if(b.cfg.rotate!==undefined){b.rotateStructure(b.cfg.rotate,true)}$("#"+b.pre+"dl_filter_table").html(w);var z="Select chains to display";var d=250,e=(b.isMobile())?"auto":200;var D={my:"left top",at:"left+10 top+93",of:"#"+b.pre+"canvas",collision:"none"};window.dialog=$("#"+b.pre+"dl_filter").dialog({autoOpen:true,title:z,height:e,width:d,modal:false,position:D});$(".ui-dialog .ui-button span").removeClass("ui-icon-closethick").addClass("ui-icon-close")}if(b.deferred!==undefined){b.deferred.resolve()}if(b.deferred2!==undefined){b.deferred2.resolve()}if(M.atoms===undefined&&M.molid2rescount===undefined){alert("invalid MMDB data.");return false}}})},downloadGi:function(a){var c=this;var d;var b="//eutils.ncbi.nlm.nih.gov/entrez/eutils/elink.fcgi?dbfrom=protein&db=structure&linkname=protein_structure&id="+a;c.icn3d.bCid=undefined;c.setLogCommand("load gi "+a,false);$.ajax({url:b,dataType:"text",success:function(f){if(f.indexOf("<Link>")===-1){alert("There are no MMDB IDs available for the gi "+a)}else{var h=f.substr(f.indexOf("<Link>"));var i=h.indexOf("<Id>");var e=h.indexOf("</Id>");var g=h.substr(i+4,e-i-4);c.downloadMmdb(g)}}})},loadAtomDataIn:function(af,N,aj,x){var u=this;u.icn3d.init();var ae=new THREE.Vector3(9999,9999,9999);var z=new THREE.Vector3(-9999,-9999,-9999);var p=new THREE.Vector3();var A=af.atoms;var H=0;var h=0;var o={};var U={};u.pmid=af.pubmedid;if(aj==="align"){for(var ab=0,J=af.aligned_structures.length;ab<J;++ab){var D=af.aligned_structures[ab];if(ab===1){u.icn3d.secondId=D.pdbid}for(var Y=D.range[0];Y<=D.range[1];++Y){var y=D.pdbid;var L=D.mmdbid;o[Y]=y.toString();U[L]=y}}}var V={};var a={};if(aj==="mmdbid"||aj==="align"){if(aj==="mmdbid"){if(af.molid2chain!==undefined){for(var ad in af.molid2chain){V[ad]=af.molid2chain[ad].chain}}}else{if(aj==="align"){if(af.molid2chain!==undefined){for(var S in af.molid2chain){for(var ad in af.molid2chain[S]){a[U[S]+"_"+ad]=af.molid2chain[S][ad].chain}}}}}}var T={};var ag="",ai="",G="";var B="",e="",M="";for(var ab in A){++H;T[ab]=H;var P=A[ab];P.serial=H;var c;if(aj==="mmdbid"||aj==="mmcif"){c=N}else{if(aj==="align"){c=o[H]}}if(P.chain===undefined&&(aj==="mmdbid"||aj==="align")){if(aj==="mmdbid"){var ad=P.ids.m;P.chain=(V[ad]===undefined)?"Misc":V[ad]}else{if(aj==="align"){var ad=P.ids.m;P.chain=(a[c+"_"+ad]===undefined)?"Misc":a[c+"_"+ad]}}}else{P.chain=(P.chain==="")?"Misc":P.chain}P.resi=parseInt(P.resi);if(P.color!==undefined){P.color=new THREE.Color(P.color)}P.coord=new THREE.Vector3(P.coord.x,P.coord.y,P.coord.z);if(aj==="mmdbid"||aj==="align"){P.structure=c}var n="-";if(P.ss==="helix"){n="H"}else{if(P.ss==="sheet"){n="E"}else{if(!P.het){n="C"}}}u.icn3d.secondarys[P.structure+"_"+P.chain+"_"+P.resi]=n;ae.min(P.coord);z.max(P.coord);p.add(P.coord);if(P.mt==="p"||P.mt==="n"){if(P.mt==="p"){u.icn3d.peptides[H]=1;if(P.name==="CA"){u.icn3d.calphas[H]=1}}else{if(P.mt==="n"){u.icn3d.nucleotides[H]=1;if(P.name=="P"){u.icn3d.nucleotidesP[H]=1}}}u.icn3d.het=false}else{if(P.mt==="s"){u.icn3d.water[H]=1;u.icn3d.het=true}else{if(P.mt==="l"){u.icn3d.ligands[H]=1;if(P.bonds.length===0){u.icn3d.ions[H]=1}u.icn3d.het=true}}}if(P.resn=="HOH"){u.icn3d.water[H]=1}u.icn3d.atoms[H]=P;u.icn3d.displayAtoms[H]=1;u.icn3d.highlightAtoms[H]=1;var w=P.structure+"_"+P.chain;if(u.icn3d.chains[w]===undefined){u.icn3d.chains[w]={}}u.icn3d.chains[w][H]=1;var I=P.structure+"_"+P.chain+"_"+P.resi;if(u.icn3d.residues[I]===undefined){u.icn3d.residues[I]={}}u.icn3d.residues[I][H]=1;B=P.structure;e=B+"_"+P.chain;M=e+"_"+P.resi;if(M!==G){if(e!==ai){if(H!==1){if(u.icn3d.structures[ag]===undefined){u.icn3d.structures[ag]=[]}u.icn3d.structures[ag].push(ai)}}}var O=u.icn3d.residueName2Abbr(P.resn.substr(0,3));u.icn3d.residueId2Name[I]=O;if(P.resi!=h){if(u.icn3d.chainsSeq[w]===undefined){u.icn3d.chainsSeq[w]=[]}if(u.icn3d.chainsAnno[w]===undefined){u.icn3d.chainsAnno[w]=[]}if(u.icn3d.chainsAnno[w][0]===undefined){u.icn3d.chainsAnno[w][0]=[]}if(u.icn3d.chainsAnno[w][1]===undefined){u.icn3d.chainsAnno[w][1]=[]}if(u.icn3d.chainsAnnoTitle[w]===undefined){u.icn3d.chainsAnnoTitle[w]=[]}if(u.icn3d.chainsAnnoTitle[w][0]===undefined){u.icn3d.chainsAnnoTitle[w][0]=[]}if(u.icn3d.chainsAnnoTitle[w][1]===undefined){u.icn3d.chainsAnnoTitle[w][1]=[]}var ah={};ah.resi=P.resi;ah.name=O;var r="";if(P.resi%10===0){r=P.resi.toString()}u.icn3d.chainsSeq[w].push(ah);u.icn3d.chainsAnno[w][0].push(r);u.icn3d.chainsAnno[w][1].push(n);u.icn3d.chainsAnnoTitle[w][0].push("");u.icn3d.chainsAnnoTitle[w][1].push("SS");if(aj==="mmdbid"||aj==="align"){u.icn3d.chainsColor[w]=P.color}}h=P.resi;ag=B;ai=e;G=M}af.atoms={};if(u.icn3d.structures[B]===undefined){u.icn3d.structures[B]=[]}u.icn3d.structures[B].push(e);if(aj!=="mmcif"){for(var ab in u.icn3d.atoms){var t=(u.icn3d.atoms[ab].bonds===undefined)?0:u.icn3d.atoms[ab].bonds.length;for(var Y=0;Y<t;++Y){u.icn3d.atoms[ab].bonds[Y]=T[u.icn3d.atoms[ab].bonds[Y]]}}}u.icn3d.cnt=H;u.icn3d.pmin=ae;u.icn3d.pmax=z;u.icn3d.maxD=z.distanceTo(ae);u.icn3d.center=p.multiplyScalar(1/u.icn3d.cnt);if(u.icn3d.maxD<25){u.icn3d.maxD=25}if(aj==="align"&&x!==undefined){for(var ab=0,J=x.length;ab<J;++ab){var aa=x[ab][0];var d=af.aligned_structures[0].pdbid;var ac=aa.mid;var X=a[d+"_"+ac];var g=d+"_"+X;var K={};var E=aa.mseq.length,q=-1;for(var Y=0,m=aa.mseq.length;Y<m;++Y){var C=aa.mseq[Y][1];var v=(aa.mseq[Y][2]==="~")?"-":aa.mseq[Y][2];var R=aa.mseq[Y][3];if(R==1){if(Y<E){E=Y}if(Y>q){q=Y}}K[Y]={resi:C,resn:v,aligned:R}}aa=x[ab][1];var b=af.aligned_structures[1].pdbid;var Z=aa.sid;var W=a[b+"_"+Z];var f=b+"_"+W;if(u.icn3d.alignChainsAnnoTitle[g]===undefined){u.icn3d.alignChainsAnnoTitle[g]=[]}if(u.icn3d.alignChainsAnnoTitle[g][0]===undefined){u.icn3d.alignChainsAnnoTitle[g][0]=[]}if(u.icn3d.alignChainsAnnoTitle[g][1]===undefined){u.icn3d.alignChainsAnnoTitle[g][1]=[]}if(u.icn3d.alignChainsAnnoTitle[g][2]===undefined){u.icn3d.alignChainsAnnoTitle[g][2]=[]}if(u.icn3d.alignChainsAnnoTitle[g][3]===undefined){u.icn3d.alignChainsAnnoTitle[g][3]=[]}if(u.icn3d.alignChainsAnnoTitle[g][4]===undefined){u.icn3d.alignChainsAnnoTitle[g][4]=[]}if(u.icn3d.alignChainsAnnoTitle[g][5]===undefined){u.icn3d.alignChainsAnnoTitle[g][5]=[]}if(u.icn3d.alignChainsAnnoTitle[g][6]===undefined){u.icn3d.alignChainsAnnoTitle[g][6]=[]}u.icn3d.alignChainsAnnoTitle[g][0].push("SS");u.icn3d.alignChainsAnnoTitle[g][1].push("");u.icn3d.alignChainsAnnoTitle[g][2].push("");u.icn3d.alignChainsAnnoTitle[g][3].push("");u.icn3d.alignChainsAnnoTitle[g][4].push(f);u.icn3d.alignChainsAnnoTitle[g][5].push(g);u.icn3d.alignChainsAnnoTitle[g][6].push("");var Q=1;for(var Y=E;Y<=q;++Y){var C=aa.sseq[Y][1];var v=(aa.sseq[Y][2]==="~")?"-":aa.sseq[Y][2];var R=K[Y].aligned+aa.sseq[Y][3];var F;if(R===2){if(K[Y].resn===v){F="#F00"}else{F="#00F"}}else{F="#CCC"}if(u.icn3d.alignChainsSeq[g]===undefined){u.icn3d.alignChainsSeq[g]=[]}var ah={};ah.mmdbid=d;ah.chain=X;ah.resi=K[Y].resi;ah.resn=K[Y].resn;ah.aligned=R;ah.color=F;u.icn3d.alignChainsSeq[g].push(ah);if(!isNaN(K[Y].resi)){if(u.icn3d.alignChains[g]===undefined){u.icn3d.alignChains[g]={}}$.extend(u.icn3d.alignChains[g],u.icn3d.residues[g+"_"+K[Y].resi])}if(u.icn3d.alignChainsSeq[f]===undefined){u.icn3d.alignChainsSeq[f]=[]}ah={};ah.mmdbid=b;ah.chain=W;ah.resi=C;ah.resn=v;ah.aligned=R;ah.color=F;u.icn3d.alignChainsSeq[f].push(ah);if(!isNaN(C)){if(u.icn3d.alignChains[f]===undefined){u.icn3d.alignChains[f]={}}$.extend(u.icn3d.alignChains[f],u.icn3d.residues[f+"_"+C])}if(u.icn3d.alignChainsAnno[g]===undefined){u.icn3d.alignChainsAnno[g]=[]}if(u.icn3d.alignChainsAnno[g][0]===undefined){u.icn3d.alignChainsAnno[g][0]=[]}if(u.icn3d.alignChainsAnno[g][1]===undefined){u.icn3d.alignChainsAnno[g][1]=[]}if(u.icn3d.alignChainsAnno[g][2]===undefined){u.icn3d.alignChainsAnno[g][2]=[]}if(Y===E){if(u.icn3d.alignChainsAnno[g][3]===undefined){u.icn3d.alignChainsAnno[g][3]=[]}if(u.icn3d.alignChainsAnno[g][4]===undefined){u.icn3d.alignChainsAnno[g][4]=[]}if(u.icn3d.alignChainsAnno[g][5]===undefined){u.icn3d.alignChainsAnno[g][5]=[]}if(u.icn3d.alignChainsAnno[g][6]===undefined){u.icn3d.alignChainsAnno[g][6]=[]}u.icn3d.alignChainsAnno[g][3].push("");u.icn3d.alignChainsAnno[g][4].push(u.icn3d.pdbid_chain2title[f]);u.icn3d.alignChainsAnno[g][5].push(u.icn3d.pdbid_chain2title[g]);u.icn3d.alignChainsAnno[g][6].push("")}var I=g+"_"+K[Y].resi;var k=u.icn3d.secondarys[I];u.icn3d.alignChainsAnno[g][0].push(k);var l=".";if(Q%5===0){l="*"}if(Q%10===0){l="|"}u.icn3d.alignChainsAnno[g][1].push(l);var r="";if(Q%10===0){r=Q.toString()}u.icn3d.alignChainsAnno[g][2].push(r);++Q}}x={}}af={}},getStructureSelections:function(l,e){var k=this;var g="";var d=l?" selected":"";var m=Object.keys(k.icn3d.structures).sort();for(var f in m){var h=m[f];if(e!==undefined){d=(e.indexOf(h)!==-1)?" selected":""}var b=(k.icn3d.secondId!==undefined&&h.indexOf(k.icn3d.secondId)===0)?"&nbsp;&nbsp;&nbsp;":"";g+="<option value='"+h+"'"+d+">"+b+m[f]+"</option>";if(d===" selected"){for(var c in k.icn3d.structures[h]){var a=k.icn3d.structures[h][c];k.icn3d.highlightAtoms=k.icn3d.unionHash(k.icn3d.highlightAtoms,k.icn3d.chains[a])}}}return g},getChainSelections:function(i,d){var h=this;var e="";var c=i?" selected":"";if(d===undefined){for(var a in h.icn3d.chains){var b=(h.icn3d.secondId!==undefined&&a.indexOf(h.icn3d.secondId)===0)?"&nbsp;&nbsp;&nbsp;":"";e+="<option value='"+a+"' "+c+">"+b+a+"</option>";h.icn3d.highlightAtoms=h.icn3d.unionHash(h.icn3d.highlightAtoms,h.icn3d.chains[a])}}else{for(var a in h.icn3d.chains){var g=a.indexOf("_");var f=a.substr(0,g);var b=(h.icn3d.secondId!==undefined&&a.indexOf(h.icn3d.secondId)===0)?"&nbsp;&nbsp;&nbsp;":"";if(d!==null&&d.toString().toLowerCase().indexOf(f.toLowerCase())!==-1){e+="<option value='"+a+"' selected>"+b+a+"</option>";h.icn3d.highlightAtoms=h.icn3d.unionHash(h.icn3d.highlightAtoms,h.icn3d.chains[a])}else{e+="<option value='"+a+"'>"+b+a+"</option>"}}}return e},getAlignChainSelections:function(){var d=this;var c="";for(var b in d.icn3d.alignChains){var a=(d.icn3d.secondId!==undefined&&b.indexOf(d.icn3d.secondId)===0)?"&nbsp;&nbsp;&nbsp;":"";c+="<option value='"+b+"'>"+a+b+"</option>";d.icn3d.highlightAtoms=d.icn3d.unionHash(d.icn3d.highlightAtoms,d.icn3d.alignChains[b])}return c},getResidueSelections:function(e){var d=this;var b="";var c=false;for(var a in d.icn3d.definedNames2Residues){if(a===e){b+="<option value='"+a+"' selected='selected'>"+a+"</option>";c=true}else{b+="<option value='"+a+"'>"+a+"</option>"}}if(c){$("#"+d.pre+"chainid").val("");$("#"+d.pre+"structureid").val("");$("#"+d.pre+"chainid2").val("");$("#"+d.pre+"structureid2").val("")}return b},getAtomSelections:function(e){var d=this;var b="";var c=false;for(var a in d.icn3d.definedNames2Atoms){if(a===e){b+="<option value='"+a+"' selected='selected'>"+a+"</option>";c=true}else{b+="<option value='"+a+"'>"+a+"</option>"}}if(c){$("#"+d.pre+"chainid").val("");$("#"+d.pre+"structureid").val("");$("#"+d.pre+"chainid2").val("");$("#"+d.pre+"structureid2").val("")}return b},getSequencesAnnotations:function(q,d,v){var z=this;var y=(z.icn3d.moleculeTitle==="")?"<b>Sequences with coordinates:</b>":"<b>Sequences of "+z.icn3d.moleculeTitle+" with coordinates: </b>";y+=" (click to select, click again to deselect, click <button style='white-space:nowrap;' class='"+z.pre+"stopselection'>Stop Selection</button> to stop the current selection)<br/><br/>";var g=0;for(var r in q){r=q[r];if(d===undefined||d){z.icn3d.highlightAtoms=z.icn3d.unionHash(z.icn3d.highlightAtoms,z.icn3d.chains[r])}var h=[],u="";var b=(z.icn3d.chainsSeq[r]!==undefined)?z.icn3d.chainsSeq[r].length:0;if(b>g){g=b}var x=r.indexOf("_");var A=r.substr(0,x);var m=r.substr(x+1);u+="<span class='residueNum' title='starting residue number'>"+z.icn3d.chainsSeq[r][0].resi+"</span>";var f=parseInt(z.icn3d.chainsSeq[r][0].resi);for(var o=0,c=b;o<c;++o){var e=A+"_"+m+"_"+z.icn3d.chainsSeq[r][o].resi;var C="class='residue'";if(v!==undefined&&v.indexOf(e)!==-1){C="class='residue highlightSeq'"}var w=(z.icn3d.chainsSeq[r][o].name.length===1)?z.icn3d.chainsSeq[r][o].name:z.icn3d.chainsSeq[r][o].name.trim().substr(0,1).toLowerCase();u+="<span id='"+z.pre+A+"_"+m+"_"+z.icn3d.chainsSeq[r][o].resi+"' "+C+">"+w+"</span>";if(f<parseInt(z.icn3d.chainsSeq[r][o].resi)){f=parseInt(z.icn3d.chainsSeq[r][o].resi)}}u+="<span class='residueNum' title='ending residue number'>"+f+"</span>";var B=(z.icn3d.chainsAnno[r]!==undefined)?z.icn3d.chainsAnno[r].length:0;for(var p=0,t=B;p<t;++p){h[p]="";h[p]+="<span class='residueNum'></span>";for(var o=0,c=z.icn3d.chainsAnno[r][p].length;o<c;++o){var l=z.icn3d.chainsAnno[r][p][o];h[p]+="<span>"+l+"</span>"}h[p]+="<span class='residueNum'></span>"}for(var p=0,t=B;p<t;++p){y+="<div class='residueLine' style='white-space:nowrap;'><div class='annoTitle' chain='"+r+"' anno='"+p+"'>"+z.icn3d.chainsAnnoTitle[r][p][0]+" </div>"+h[p]+"<br/></div>"}var n=(z.icn3d.chainsColor[r]!==undefined)?"#"+z.icn3d.chainsColor[r].getHexString():"#000000";var a=r;title=(z.icn3d.pdbid_chain2title!==undefined)?z.icn3d.pdbid_chain2title[r]:"";y+='<div class="seqTitle" chain="'+r+'" anno="sequence" style="color:'+n+'" title="'+title+'">'+a+' </div><span class="seqLine" style="color:'+n+'">'+u+"</span><br/>"}return{sequencesHtml:y,maxSeqCnt:g}},getAlignSequencesAnnotations:function(h,d){var v=this;var u="<b>Aligned Sequences:</b>";u+=" (click to select, click again to deselect, click <button style='white-space:nowrap;' class='"+v.pre+"stopselection'>Stop Selection</button> to stop the current selection)<br/><br/>";var f=0;for(var p in h){p=h[p];if(d===undefined||d){v.icn3d.highlightAtoms=v.icn3d.unionHash(v.icn3d.highlightAtoms,v.icn3d.alignChains[p])}var g=[],r="";var b=(v.icn3d.alignChainsSeq[p]!==undefined)?v.icn3d.alignChainsSeq[p].length:0;if(b>f){f=b}var t=p.indexOf("_");var x=p.substr(0,t);var l=p.substr(t+1);r+="<span class='residueNum' title='starting residue number'>"+v.icn3d.alignChainsSeq[p][0].resi+"</span>";for(var m=0,c=b;m<c;++m){var e="N/A",w="",n="#000";if(!isNaN(v.icn3d.alignChainsSeq[p][m].resi)){e=v.icn3d.alignChainsSeq[p][m].resi;w=v.pre+x+"_"+l+"_"+e;n=v.icn3d.alignChainsSeq[p][m].color}var A="class='residue'";if(v.icn3d.alignChainsSeq[p][m].aligned===2){A="class='residue alignSeq'"}r+="<span id='"+w+"' "+A+" style='color:"+n+"'>"+v.icn3d.alignChainsSeq[p][m].resn+"</span>"}r+="<span class='residueNum' title='ending residue number'>"+v.icn3d.alignChainsSeq[p][b-1].resi+"</span>";var z=(v.icn3d.alignChainsAnno[p]!==undefined)?v.icn3d.alignChainsAnno[p].length:0;for(var o=0,q=z;o<q;++o){g[o]="";g[o]+="<span class='residueNum'></span>";for(var m=0,c=v.icn3d.alignChainsAnno[p][o].length;m<c;++m){g[o]+="<span>"+v.icn3d.alignChainsAnno[p][o][m]+"</span>"}g[o]+="<span class='residueNum'></span>"}var n=(v.icn3d.chainsColor[p]!==undefined)?"#"+v.icn3d.chainsColor[p].getHexString():"#000000";var a=p,y=(v.icn3d.pdbid_chain2title!==undefined)?v.icn3d.pdbid_chain2title[p]:"";for(var o=z-1;o>=0;--o){u+="<div class='residueLine' style='white-space:nowrap;'><div class='seqTitle' chain='"+p+"' anno='"+o+"'>"+v.icn3d.alignChainsAnnoTitle[p][o][0]+"</div>"+g[o]+"<br/></div>"}u+='<div class="seqTitle" chain="'+p+'" anno="sequence" style="color:'+n+'" title="'+y+'">'+a+' </div><span class="seqLine" style="color:'+n+'">'+r+"</span><br/>"}return{sequencesHtml:u,maxSeqCnt:f}},addCustomSelection:function(b,c,a,d,g,i){var e=this;if(!(a in e.icn3d.definedNames2Residues)){if(i){e.icn3d.definedNames2Residues[a]=b}e.icn3d.definedNames2Atoms[a]=c;e.icn3d.definedNames2Descr[a]=d;e.icn3d.definedNames2Command[a]=g;var h=e.getResidueSelections(a);var f=e.getAtomSelections(a);$("#"+e.pre+"customResidues").html(h);$("#"+e.pre+"customResidues2").html(h);$("#"+e.pre+"customAtoms").html(f)}else{if(i){e.icn3d.definedNames2Residues[a]=e.icn3d.definedNames2Residues[a].concat(b)}e.icn3d.definedNames2Atoms[a]=e.icn3d.definedNames2Atoms[a].concat(c);e.icn3d.definedNames2Descr[a]=d;e.icn3d.definedNames2Command[a]=g;var h=e.getResidueSelections(a);var f=e.getAtomSelections(a);$("#"+e.pre+"customResidues").html(h);$("#"+e.pre+"customResidues2").html(h);$("#"+e.pre+"customAtoms").html(f)}},changeStructureid:function(e){var f=this;f.icn3d.removeHighlightObjects();f.icn3d.highlightAtoms={};f.ALTERNATE_STRUCTURE=Object.keys(f.icn3d.structures).indexOf(e[0]);$("#"+f.pre+"chainid").val("");$("#"+f.pre+"alignChainid").val("");$("#"+f.pre+"customResidues").val("");$("#"+f.pre+"chainid2").val("");$("#"+f.pre+"alignChainid2").val("");$("#"+f.pre+"customResidues2").val("");$("#"+f.pre+"customAtoms").val("");if(e!==null){f.setLogCommand("select molecule "+e.toString(),true)}var g=f.getChainSelections(false,e);$("#"+f.pre+"chainid").html(g);$("#"+f.pre+"chainid2").html(g);var d=[];for(var b in f.icn3d.residues){var h=b.indexOf("_");var a=b.substr(0,h);if(e.toString().toLowerCase().indexOf(a.toLowerCase())!==-1){d.push(b);f.icn3d.highlightAtoms=f.icn3d.unionHash(f.icn3d.highlightAtoms,f.icn3d.residues[b])}}var c=f.getSequencesAnnotations(Object.keys(f.icn3d.chains),false,d);$("#"+f.pre+"dl_sequence").html(c.sequencesHtml);$("#"+f.pre+"dl_sequence").width(f.RESIDUE_WIDTH*c.maxSeqCnt+200);f.icn3d.addHighlightObjects()},changeChainid:function(b){var f=this;f.icn3d.removeHighlightObjects();f.icn3d.highlightAtoms={};$("#"+f.pre+"structureid").val("");$("#"+f.pre+"alignChainid").val("");$("#"+f.pre+"customResidues").val("");$("#"+f.pre+"structureid2").val("");$("#"+f.pre+"alignChainid2").val("");$("#"+f.pre+"customResidues2").val("");$("#"+f.pre+"customAtoms").val("");if(b!==null){f.setLogCommand("select chain "+b.toString(),true)}var e=[];for(var a in f.icn3d.residues){var g=a.lastIndexOf("_");var d=a.substr(0,g);if(b.toString().toLowerCase().indexOf(d.toLowerCase())!==-1){e.push(a);f.icn3d.highlightAtoms=f.icn3d.unionHash(f.icn3d.highlightAtoms,f.icn3d.residues[a])}}var c=f.getSequencesAnnotations(Object.keys(f.icn3d.chains),false,e);$("#"+f.pre+"dl_sequence").html(c.sequencesHtml);$("#"+f.pre+"dl_sequence").width(f.RESIDUE_WIDTH*c.maxSeqCnt+200);f.icn3d.addHighlightObjects()},changeResidueid:function(g){var h=this;h.icn3d.removeHighlightObjects();h.icn3d.highlightAtoms={};$("#"+h.pre+"structureid").val("");$("#"+h.pre+"chainid").val("");$("#"+h.pre+"alignChainid").val("");$("#"+h.pre+"customResidues").val("");$("#"+h.pre+"structureid2").val("");$("#"+h.pre+"chainid2").val("");$("#"+h.pre+"alignChainid2").val("");$("#"+h.pre+"customResidues2").val("");$("#"+h.pre+"customAtoms").val("");if(g!==null){h.setLogCommand("select residue "+g.toString(),true)}var a="";for(var c=0,f=g.length;c<f;++c){h.icn3d.highlightAtoms=h.icn3d.unionHash(h.icn3d.highlightAtoms,h.icn3d.residues[g[c]])}a+="<b>Annotation(s):</b> Previously selected residues<br/>";var b=[];for(var e in h.icn3d.chains){b.push(e)}var d=h.getSequencesAnnotations(b,false,g);$("#"+h.pre+"dl_sequence").html(a+d.sequencesHtml);$("#"+h.pre+"dl_sequence").width(h.RESIDUE_WIDTH*d.maxSeqCnt+200);h.icn3d.addHighlightObjects()},changeAlignChainid:function(c){var b=this;b.icn3d.removeHighlightObjects();b.icn3d.highlightAtoms={};$("#"+b.pre+"structureid").val("");$("#"+b.pre+"chainid").val("");$("#"+b.pre+"customResidues").val("");$("#"+b.pre+"structureid2").val("");$("#"+b.pre+"chainid2").val("");$("#"+b.pre+"customResidues2").val("");$("#"+b.pre+"customAtoms").val("");if(c!==null){b.setLogCommand("select alignChain "+c.toString(),true)}var a=b.getAlignSequencesAnnotations(c);$("#"+b.pre+"dl_sequence2").html(a.sequencesHtml);$("#"+b.pre+"dl_sequence2").width(b.RESIDUE_WIDTH2*a.maxSeqCnt+200);b.icn3d.addHighlightObjects()},showCustomResidues:function(n){var o=this;o.icn3d.removeHighlightObjects();o.icn3d.highlightAtoms={};$("#"+o.pre+"chainid").val("");$("#"+o.pre+"alignChainid").val("");$("#"+o.pre+"structureid").val("");$("#"+o.pre+"chainid2").val("");$("#"+o.pre+"alignChainid2").val("");$("#"+o.pre+"structureid2").val("");$("#"+o.pre+"customAtoms").val("");d+=" (click to select, click again to deselect, click <button style='white-space:nowrap;' class='"+o.pre+"stopselection'>Stop Selection</button> to stop the current selection)<br/><br/>";var d="";var f="";var b={};for(var k=0;k<n.length;++k){var c=o.icn3d.definedNames2Residues[n[k]];if(c===undefined){continue}var e=o.icn3d.definedNames2Descr[n[k]];f+="<b>"+n[k]+":</b> "+e+"; ";for(var g=0,h=c.length;g<h;++g){b[c[g]]=1;o.icn3d.highlightAtoms=o.icn3d.unionHash(o.icn3d.highlightAtoms,o.icn3d.residues[c[g]])}}d+="<b>Annotation(s):</b> "+f+"<br/>";var m=[];for(var a in o.icn3d.chains){m.push(a)}var l=o.getSequencesAnnotations(m,false,Object.keys(b));$("#"+o.pre+"dl_sequence").html(d+l.sequencesHtml);$("#"+o.pre+"dl_sequence").width(o.RESIDUE_WIDTH*l.maxSeqCnt+200);o.icn3d.addHighlightObjects()},showCustomAtoms:function(c){var v=this;v.icn3d.removeHighlightObjects();v.icn3d.highlightAtoms={};$("#"+v.pre+"chainid").val("");$("#"+v.pre+"alignChainid").val("");$("#"+v.pre+"structureid").val("");$("#"+v.pre+"customResidues").val("");$("#"+v.pre+"chainid2").val("");$("#"+v.pre+"alignChainid2").val("");$("#"+v.pre+"structureid2").val("");$("#"+v.pre+"customResidues2").val("");$("#"+v.pre+"command").val("");$("#"+v.pre+"command_name").val("");$("#"+v.pre+"command_desc").val("");u+=" (click to select, click again to deselect, click <button style='white-space:nowrap;' class='"+v.pre+"stopselection'>Stop Selection</button> to stop the current selection)<br/><br/>";var u="";var q="";var d={};for(var o=0;o<c.length;++o){var t=v.icn3d.definedNames2Atoms[c[o]];var w={};for(var m=0,p=t.length;m<p;++m){var a=v.icn3d.atoms[t[m]];var e=a.structure+"_"+a.chain+"_"+a.resi;w[e]=1}var r=Object.keys(w);if(r===undefined){continue}var f=v.icn3d.definedNames2Descr[c[o]];q+="<b>"+c[o]+":</b> "+f+"; ";for(var m=0,p=r.length;m<p;++m){d[r[m]]=1}}u+="<b>Annotation(s):</b> "+q+"<br/>";var l=[];for(var h in v.icn3d.chains){l.push(h)}var b=v.getSequencesAnnotations(l,false,Object.keys(d));$("#"+v.pre+"dl_sequence").html(u+b.sequencesHtml);$("#"+v.pre+"dl_sequence").width(v.RESIDUE_WIDTH*b.maxSeqCnt+200);v.icn3d.highlightAtoms={};for(var o=0;o<c.length;++o){var t=v.icn3d.definedNames2Atoms[c[o]];var g=v.icn3d.definedNames2Descr[c[o]];var n=v.icn3d.definedNames2Command[c[o]];if(o===0){$("#"+v.pre+"command").val(n);$("#"+v.pre+"command_name").val(c[o]);$("#"+v.pre+"command_desc").val(g)}else{var k=$("#command").val();$("#"+v.pre+"command").val(k+"; "+n);var k=$("#command_name").val();$("#"+v.pre+"command_name").val(k+"; "+c[o]);var k=$("#command_desc").val();$("#"+v.pre+"command_desc").val(k+"; "+g)}for(var m=0,p=t.length;m<p;++m){v.icn3d.highlightAtoms[t[m]]=1}}v.icn3d.addHighlightObjects()},showSelected:function(d){var o=this;o.icn3d.displayAtoms={};var h=[];var n=$("#"+o.pre+"chainid").val();var l=$("#"+o.pre+"chainid2").val();if(n){h=h.concat(n)}if(l){h=h.concat(l)}if(h){for(var f in h){var a=h[f];o.icn3d.displayAtoms=o.icn3d.unionHash(o.icn3d.displayAtoms,o.icn3d.chains[a])}}h=[];n=$("#"+o.pre+"alignChainid").val();l=$("#"+o.pre+"alignChainid2").val();if(n){h=h.concat(n)}if(l){h=h.concat(l)}if(h){for(var f in h){var a=h[f];o.icn3d.displayAtoms=o.icn3d.unionHash(o.icn3d.displayAtoms,o.icn3d.alignChains[a])}}if(d===o.pre+"customAtoms"||d===o.pre+"customResidues"||d===o.pre+"customResidues2"){var m=[];if(d===o.pre+"customAtoms"){m=$("#"+d).val()}else{var k=$("#"+o.pre+"customResidues").val();var g=$("#"+o.pre+"customResidues2").val();if(k){m=m.concat(k)}if(g){m=m.concat(g)}}if(m){for(var f in m){if(d===o.pre+"customAtoms"){var c=o.icn3d.definedNames2Atoms[m[f]];for(var e in c){o.icn3d.displayAtoms[c[e]]=1}}else{if(d===o.pre+"customResidues"){var b=o.icn3d.definedNames2Residues[m[f]];for(var e in b){o.icn3d.displayAtoms=o.icn3d.unionHash(o.icn3d.displayAtoms,o.icn3d.residues[b[e]])}}}}}}var p={};p.rotationcenter="display center";o.icn3d.draw(p)},selectResiduesAtoms:function(N,h,H){var u=this;var l=N.replace(/\s/g,"").split(";");var p=[];var K=[];var g=true;for(var S=0,D=l.length;S<D;++S){var E=l[S].indexOf("#");var d=l[S].indexOf(".");var O=l[S].indexOf(":");var v=l[S].indexOf("@");var z,M,r,L;var T=l[S];if(v===-1){L="*"}else{L=T.substr(v+1);T=T.substr(0,v)}if(O===-1){r="*"}else{r=T.substr(O+1);T=T.substr(0,O)}if(d===-1){M="*"}else{M=T.substr(d+1);T=T.substr(0,d)}if(E===-1){z="*"}else{z=T.substr(E+1);T=T.substr(0,E)}if(L!=="*"){g=false}var F,V,G,U=[],y=[],A,t;if(z==="*"){U=Object.keys(u.icn3d.structures)}else{U=z.split(",")}if(M==="*"){var b=Object.keys(u.icn3d.chains);for(var R in b){G=b[R];F=G.substr(0,G.indexOf("_"));if(U.toString().toLowerCase().indexOf(F.toLowerCase())!==-1){y.push(G)}}}else{for(var R in U){F=U[R];var x=M.split(",");for(var Q in x){y.push(F+"_"+x[Q])}}}var e=r.split(",");for(var R in e){var J=false;var B=e[R].indexOf("-");var f;var n=false;if(B!==-1){A=e[R].substr(0,B);t=e[R].substr(B+1);J=true}else{if(!isNaN(e[R])){A=e[R];t=A;J=true}else{if(e[R]==="*"){n=true}else{if(e[R]!=="peptides"&&e[R]!=="nucleotides"&&e[R]!=="ligands"&&e[R]!=="ions"&&e[R]!=="water"){var q=e[R].toUpperCase();f=(e[R].length===1)?q:u.icn3d.residueName2Abbr(q)}}}}var o={};for(var w in y){G=y[w];if(J){for(var Q=parseInt(A);Q<=parseInt(t);++Q){var a=G+"_"+Q;p.push(a);for(var P in u.icn3d.residues[a]){if(L==="*"||L===u.icn3d.atoms[P].name){K.push(P)}}}}else{if(G in u.icn3d.chains){var c=u.icn3d.chains[G];for(var P in c){var q=u.icn3d.atoms[P].resn.substr(0,3).toUpperCase();if(n||u.icn3d.residueName2Abbr(q)===f||(e[R]==="peptides"&&P in u.icn3d.peptides)||(e[R]==="nucleotides"&&P in u.icn3d.nucleotides)||(e[R]==="ligands"&&P in u.icn3d.ligands)||(e[R]==="ions"&&P in u.icn3d.ions)||(e[R]==="water"&&P in u.icn3d.water)){o[G+"_"+u.icn3d.atoms[P].resi]=1;if(L==="*"||L===u.icn3d.atoms[P].name){K.push(P)}}}}}}for(var C in o){p.push(C)}}}if(h!==""){u.addCustomSelection(p,K,h,H,N,g);var I=[h];u.showCustomResidues(I)}},pickCustomSphere:function(q,l){var o=this;o.clearSelection();var p={};for(var e in o.icn3d.highlightAtoms){p[e]=o.icn3d.atoms[e]}var g=o.icn3d.getAtomsWithinAtom(o.icn3d.hash2Atoms(o.icn3d.displayAtoms),p,parseFloat(l));var m={},c=[];for(var e in g){var k=g[e];var f=k.structure+"_"+k.chain+"_"+k.resi;m[f]=1;c.push(e)}var b=Object.keys(m);o.icn3d.highlightAtoms={};for(var j in b){var f=b[j];for(var e in o.icn3d.residues[f]){o.icn3d.highlightAtoms[e]=1}}var a,h;var d=o.icn3d.getFirstAtomObj(p);a="sphere."+d.chain+":"+o.icn3d.residueName2Abbr(d.resn.substr(0,3))+d.resi+"-"+$("#"+o.pre+"radius_aroundsphere").val()+"A";h="select a sphere around currently selected "+Object.keys(o.icn3d.highlightAtoms).length+" atoms with a radius of "+l+" angstrom";o.addCustomSelection(b,c,a,h,q,true);var n=[a];o.showCustomResidues(n)},showHbonds:function(m,f){var l=this;var n={};n.hbonds="yes";var d={};for(var e in l.icn3d.atoms){if(!l.icn3d.highlightAtoms.hasOwnProperty(e)&&l.icn3d.displayAtoms.hasOwnProperty(e)){d[e]=l.icn3d.atoms[e]}}var c=l.icn3d.getFirstAtomObj(l.icn3d.highlightAtoms);if(Object.keys(d).length>0&&Object.keys(l.icn3d.highlightAtoms).length>0){l.icn3d.calculateLigandHbonds(d,l.icn3d.intersectHash2Atoms(l.icn3d.displayAtoms,l.icn3d.highlightAtoms),parseFloat(f));l.clearSelection();var j={},b=[];for(var e in l.icn3d.highlightAtoms){var g=l.icn3d.atoms[e].structure+"_"+l.icn3d.atoms[e].chain+"_"+l.icn3d.atoms[e].resi;j[g]=1;b.push(e)}var a="hbonds_"+c.serial;var h="all atoms that are hydrogen-bonded with the selected atoms";l.addCustomSelection(Object.keys(j),b,a,h,m,true);var k=[a];l.showCustomResidues(k);l.icn3d.draw(n)}},addLabel:function(i,h,f,d,j,b,a){var e=this;var g={};var c=new THREE.Vector3();c.x=h;c.y=f;c.z=d;g.position=c;g.text=i;g.size=j;g.color=b;g.background=a;e.icn3d.labels.push(g);e.icn3d.removeHighlightObjects()},addLine:function(b,i,f,a,h,d,c,e){var g=this;var j={};j.position1=new THREE.Vector3(b,i,f);j.position2=new THREE.Vector3(a,h,d);j.color=c;j.dashed=e;g.icn3d.lines.push(j);g.icn3d.removeHighlightObjects()},selectAChain:function(n,g){var k=this;var a=g.replace(/\s/g,"");var l="Selection from chain annotation in 'Select Residue' dialog";var b=[],c=[];k.icn3d.removeHighlightObjects();k.icn3d.highlightAtoms={};for(var e in k.icn3d.chainsSeq[n]){var h=k.icn3d.chainsSeq[n][e];var f=n+"_"+h.resi;var m=h.name;if(m!==""&&m!=="-"){b.push(f);for(var d in k.icn3d.residues[f]){c.push(d);k.icn3d.highlightAtoms[d]=1}}}k.addCustomSelection(b,c,a,g,l,true);k.icn3d.addHighlightObjects()},selectAAlignChain:function(n,g){var k=this;var a=g.replace(/\s/g,"");var l="Selection from chain annotation in 'Select Residue' dialog";var b=[],c=[];k.icn3d.removeHighlightObjects();k.icn3d.highlightAtoms={};for(var e in k.icn3d.alignChainsSeq[n]){var h=k.icn3d.alignChainsSeq[n][e];var f=n+"_"+h.resi;var m=h.name;if(m!==""&&m!=="-"){b.push(f);for(var d in k.icn3d.residues[f]){c.push(d);k.icn3d.highlightAtoms[d]=1}}}k.addCustomSelection(b,c,a,g,l,true);k.icn3d.addHighlightObjects()},selectAResidue:function(f,c){var g=this;var h=c.replace(/\s/g,"");var a="Selection of a residue in 'Select Residue' dialog";var e=[],b=[];e.push(f);for(var d in g.icn3d.residues[f]){b.push(d);g.icn3d.highlightAtoms[d]=1}g.addCustomSelection(e,b,h,c,a,true)},back:function(){var a=this;a.STATENUMBER--;if(a.STATENUMBER<1){a.STATENUMBER=1}else{a.execCommands(a.STATENUMBER)}a.adjustIcon()},forward:function(){var a=this;a.STATENUMBER++;if(a.STATENUMBER>a.icn3d.commands.length){a.STATENUMBER=a.icn3d.commands.length}else{a.execCommands(a.STATENUMBER)}a.adjustIcon()},toggleSelection:function(){var b=this;if(b.HIDE_SELECTION){for(var a in b.icn3d.displayAtoms){if(b.icn3d.highlightAtoms.hasOwnProperty(a)){delete b.icn3d.displayAtoms[a]}}b.HIDE_SELECTION=false}else{b.icn3d.displayAtoms=b.icn3d.unionHash(b.icn3d.displayAtoms,b.icn3d.highlightAtoms);b.HIDE_SELECTION=true}b.icn3d.draw()},alternateStructures:function(){var h=this;h.icn3d.displayAtoms={};var g=Object.keys(h.icn3d.structures);for(var f=0,c=g.length;f<c;++f){var a=g[f];if(f>h.ALTERNATE_STRUCTURE||(h.ALTERNATE_STRUCTURE===c-1&&f===0)){for(var b in h.icn3d.structures[a]){var e=h.icn3d.structures[a][b];h.icn3d.displayAtoms=h.icn3d.unionHash(h.icn3d.displayAtoms,h.icn3d.chains[e])}var g=[];g.push(a);h.changeStructureid(g);var d=h.getStructureSelections(false,g);$("#"+h.pre+"structureid").html(d);$("#"+h.pre+"structureid2").html(d);h.ALTERNATE_STRUCTURE=f;break}}h.icn3d.draw()},adjustIcon:function(){var a=this;if(a.STATENUMBER===1){if($("#"+a.pre+"back").hasClass("middleIcon")){$("#"+a.pre+"back").toggleClass("middleIcon");$("#"+a.pre+"back").toggleClass("endIcon")}}else{if($("#"+a.pre+"back").hasClass("endIcon")){$("#"+a.pre+"back").toggleClass("middleIcon");$("#"+a.pre+"back").toggleClass("endIcon")}}if(a.STATENUMBER===a.icn3d.commands.length){if($("#"+a.pre+"forward").hasClass("middleIcon")){$("#"+a.pre+"forward").toggleClass("middleIcon");$("#"+a.pre+"forward").toggleClass("endIcon")}}else{if($("#"+a.pre+"forward").hasClass("endIcon")){$("#"+a.pre+"forward").toggleClass("middleIcon");$("#"+a.pre+"forward").toggleClass("endIcon")}}},toggle:function(d,c,b,a){var e=this;$("#"+d).toggleClass("ui-icon-plus");$("#"+d).toggleClass("ui-icon-minus");$("#"+c).toggleClass("ui-icon-plus");$("#"+c).toggleClass("ui-icon-minus");$("#"+d).toggleClass("shown");$("#"+d).toggleClass("hidden");$("#"+c).toggleClass("shown");$("#"+c).toggleClass("hidden");$("#"+b).toggleClass("shown");$("#"+b).toggleClass("hidden");$("#"+a).toggleClass("shown");$("#"+a).toggleClass("hidden")},isIE:function(){var c=this;var b=window.navigator.userAgent;var a=b.indexOf("MSIE ");if(a>0||!!navigator.userAgent.match(/Trident.*rv\:11\./)){return true}else{return false}},saveFile:function(b,d){var e=this;if(e.isIE()){if(window.navigator.msSaveBlob){if(d==="text"){var c=e.icn3d.commands.join("\n");var f=decodeURIComponent(c);var a=new Blob([f],{type:"text/html;charset=utf-8;"});navigator.msSaveBlob(a,b)}else{if(d==="png"){e.icn3d.render();var a=e.icn3d.renderer.domElement.msToBlob();navigator.msSaveBlob(a,b)}}}}else{var f;if(d==="text"){var c=e.icn3d.commands.join("\n");f="data:text;charset=utf-8,"+encodeURIComponent(c)}else{if(d==="png"){e.icn3d.render();var c=e.icn3d.renderer.domElement.toDataURL("image/png");f=c}}window.open(f,"_blank")}},loadStateFile:function(a){var b=this;b.icn3d.bRender=false;a=a.replace(/;/g,"\n");b.icn3d.commands=a.split("\n");b.STATENUMBER=b.icn3d.commands.length;b.execCommands(b.STATENUMBER)},execCommandsBase:function(d,a){var c=this;for(var b=d;b<=a;++b){if(c.icn3d.commands[b].indexOf("load")!==-1){$.when(c.applyCommandLoad(c.icn3d.commands[b])).then(function(){c.execCommandsBase(b+1,a)});return}else{c.applyCommand(c.icn3d.commands[b])}}},execCommands:function(a){var d=this;d.icn3d.bRender=false;d.execCommandsBase(0,a-1);d.icn3d.bRender=true;var b=d.icn3d.commands[a-1].split("|||");if(b.length==2){var c=JSON.parse(b[1]);d.icn3d._zoomFactor=c.factor;d.icn3d.mouseChange.x=c.mouseChange.x;d.icn3d.mouseChange.y=c.mouseChange.y;d.icn3d.quaternion._x=c.quaternion._x;d.icn3d.quaternion._y=c.quaternion._y;d.icn3d.quaternion._z=c.quaternion._z;d.icn3d.quaternion._w=c.quaternion._w}d.icn3d.draw()},applyCommandLoad:function(a){var b=this;b.setLogCommand(a,true);console.log("commandStr: "+a);b.deferred2=$.Deferred(function(){var d=a.split("|||");var c=d[0].replace(/\s\s/g," ").trim();var e=c.toLowerCase();if(e.indexOf("load")!==-1){var f=e.substr(e.lastIndexOf(" ")+1);if(e.indexOf("pdb")!==-1){b.downloadPdb(f)}else{if(e.indexOf("mmcif")!==-1){b.downloadMmcif(f)}else{if(e.indexOf("mmdb")!==-1){b.downloadMmdb(f)}else{if(e.indexOf("term")!==-1){b.downloadTerm(f)}else{if(e.indexOf("gi")!==-1){b.downloadGi(f)}else{if(e.indexOf("cid")!==-1){b.downloadCid(f)}else{if(e.indexOf("align")!==-1){b.downloadAlignment(f)}}}}}}}}});return b.deferred2},applyCommand:function(g){var x=this;x.setLogCommand(g,true);var a=g.split("|||");var p=a[0].replace(/\s\s/g," ").trim();var d=p.toLowerCase();if(d.indexOf("export state file")!==-1){}else{if(p.indexOf("select molecule")!==-1){var l=p.substr(p.lastIndexOf(" ")+1).split(",");if(l!==null){x.changeStructureid(l)}}else{if(p.indexOf("select chain")!==-1){var l=p.substr(p.lastIndexOf(" ")+1).split(",");if(l!==null){x.changeChainid(l)}}else{if(p.indexOf("select alignChain")!==-1){var l=p.substr(p.lastIndexOf(" ")+1).split(",");if(l!==null){x.changeAlignChainid(l)}}else{if(p.indexOf("select residue")!==-1){var l=p.substr(p.lastIndexOf(" ")+1).split(",");if(l!==null){x.changeResidueid(l)}}else{if(p.indexOf("select customresidues")!==-1){var l=p.substr(p.lastIndexOf(" ")+1).split(",");if(l!==null){x.showCustomResidues(l)}}else{if(p.indexOf("select customatoms")!==-1){var l=p.substr(p.lastIndexOf(" ")+1).split(",");if(l!==null){x.showCustomAtoms(l)}}else{if(d.indexOf("show selected customResidues")!==-1){x.showSelected(x.pre+"customResidues")}else{if(d.indexOf("show selected customAtoms")!==-1){x.showSelected(x.pre+"customAtoms")}else{if(d.indexOf("select")!==-1&&d.indexOf("name")!==-1&&d.indexOf("description")!==-1){var h=p.split(" | ");var o=h[0].substr(h[0].lastIndexOf(" ")+1);var u=h[1].substr(h[1].lastIndexOf(" ")+1);var m=h[2].substr(h[2].lastIndexOf(" ")+1);x.selectResiduesAtoms(o,u,m)}else{if(d.indexOf("picking yes")!==-1){x.icn3d.picking=1;x.icn3d.options.picking="atom"}else{if(d.indexOf("picking no")!==-1){x.icn3d.picking=0;x.icn3d.options.picking="no";x.icn3d.draw(undefined,undefined);x.icn3d.removeHighlightObjects()}else{if(d.indexOf("picking residue")!==-1){x.icn3d.picking=2;x.icn3d.options.picking="residue"}else{if(d.indexOf("pickatom")!==-1){var w=parseInt(d.substr(d.lastIndexOf(" ")+1));x.icn3d.pickedatom=x.icn3d.atoms[w];var i=x.icn3d.pickedatom.structure+"_"+x.icn3d.pickedatom.chain+"_"+x.icn3d.pickedatom.resi;if($("#"+x.pre+i).length!==0){$("#"+x.pre+i).toggleClass("highlightSeq")}}else{if(d.indexOf("select aroundsphere")!==-1){var h=d.split(" | ");var e=h[1].substr(h[1].lastIndexOf(" ")+1);var o="select aroundsphere | radius "+e;x.pickCustomSphere(o,e)}else{if(d.indexOf("style")!==-1){var j=d.substr(d.indexOf(" ")+1);var b=j.substr(0,j.indexOf(" "));var v=j.substr(j.indexOf(" ")+1);x.setStyle(b,v)}else{if(d.indexOf("color")!==-1){var r=d.substr(d.indexOf(" ")+1);var f={};f.color=r;x.icn3d.setColorByOptions(f,x.icn3d.highlightAtoms)}else{if(d.indexOf("showsurface")!==-1||d.substr(0,7)==="surface"||d.substr(0,7)==="opacity"||d.substr(0,9)==="wireframe"||d.substr(0,6)==="camera"||d.substr(0,10)==="background"||d.substr(0,4)==="axis"){var q=d.substr(d.indexOf(" ")+1);x.options.showsurface=q}else{if(d.indexOf("reset")!==-1){x.show3DStructure()}else{if(d.indexOf("toggle highlight")!==-1){if(x.icn3d.prevHighlightObjects.length>0){x.icn3d.removeHighlightObjects()}else{x.icn3d.addHighlightObjects()}}else{if(d.indexOf("assembly yes")!==-1){x.icn3d.bAssembly=true}else{if(d.indexOf("assembly no")!==-1){x.icn3d.bAssembly=false}else{if(d.indexOf("add label")!==-1){var h=d.split(" | ");var k=h[0].substr(h[0].lastIndexOf(" ")+1);x.addLabel(k,size,r,background);x.icn3d.draw()}else{if(d.indexOf("add line")!==-1){var h=d.split(" | ");var n=h[1].split(" ");var t=h[2].split(" ");var r=h[3].substr(h[3].lastIndexOf(" ")+1);var y=h[4].substr(h[4].lastIndexOf(" ")+1)==="true"?true:false;x.addLine(n[0],n[1],n[2],t[0],t[1],t[2],r,y)}else{if(d.indexOf("zoomin selected")!==-1){x.icn3d.zoominSelection()}else{if(d.indexOf("rotate left")!==-1){x.icn3d.bStopRotate=false;x.ROTATION_DIRECTION="left";x.rotateStructure("left")}else{if(d.indexOf("rotate right")!==-1){x.icn3d.bStopRotate=false;x.ROTATION_DIRECTION="right";x.rotateStructure("right")}else{if(d.indexOf("rotate up")!==-1){x.icn3d.bStopRotate=false;x.ROTATION_DIRECTION="up";x.rotateStructure("up")}else{if(d.indexOf("rotate down")!==-1){x.icn3d.bStopRotate=false;x.ROTATION_DIRECTION="down";x.rotateStructure("down")}else{if(d.indexOf("show hbonds |")!==-1){var h=d.split(" | ");var c=h[1].substr(h[1].lastIndexOf(" ")+1);var o="show hbonds | threshold "+c;x.showHbonds(o,c)}else{if(d.indexOf("show hbonds no")!==-1){x.options.hbonds="no";x.icn3d.draw(x.options)}else{if(d.indexOf("show distance no")!==-1){x.options.lines="no";x.icn3d.draw(x.options)}else{if(d.indexOf("show labels no")!==-1){x.options.labels="no";x.icn3d.draw(x.options)}else{if(d.indexOf("back")!==-1){x.back()}else{if(d.indexOf("forward")!==-1){x.forward()}else{if(d.indexOf("toggle selected atoms")!==-1){x.toggleSelection()}else{if(d.indexOf("select all")!==-1){x.selectAll()}else{if(d.indexOf("select complement")!==-1){x.selectComplement()}else{if(d.indexOf("set highlight color")!==-1){var r=d.substr(20);if(r==="yellow"){x.icn3d.highlightColor=new THREE.Color(16776960);x.icn3d.matShader=x.icn3d.setOutlineColor("yellow")}else{if(r==="green"){x.icn3d.highlightColor=new THREE.Color(65280);x.icn3d.matShader=x.icn3d.setOutlineColor("green")}else{if(r==="red"){x.icn3d.highlightColor=new THREE.Color(16711680);x.icn3d.matShader=x.icn3d.setOutlineColor("red")}}}x.icn3d.draw()}else{if(d.indexOf("set highlight style")!==-1){var v=d.substr(20);if(v==="outline"){x.icn3d.bHighlight=1}else{if(v==="object"){x.icn3d.bHighlight=2}}x.icn3d.draw()}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},setMenu:function(e){var c=this;var b="";b+="<div style='position:relative;'>";b+="  <!--https://forum.jquery.com/topic/looking-for-a-jquery-horizontal-menu-bar-->";b+="  <div id='"+c.pre+"menulist' style='position:absolute; z-index:999; float:left; display:table-row; margin: 3px 0px 0px 3px;'>";b+="    <table border='0' cellpadding='0' cellspacing='0' width='100'><tr>";b+="    <td valign='top'>";b+="    <div style='float:left; margin:10px 5px 0px 5px;'>";b+="          <span id='"+c.pre+"back' class='ui-icon ui-icon-arrowthick-1-w middleIcon link' title='Step backward'></span>";b+="    </div>";b+="    </td>";b+="    <td valign='top'>";b+="    <div style='float:left; margin:10px 5px 0px 5px;'>";b+="          <span id='"+c.pre+"forward' class='ui-icon ui-icon-arrowthick-1-e middleIcon link' title='Step forward'></span>";b+="    </div>";b+="    </td>";b+="    <td valign='top'>";b+="    <div style='float:left;'>";b+="          <accordion id='"+c.pre+"accordion1'>";b+="              <h3>File</h3>";b+="              <div>";b+="              <ul class='menu'>";b+="                <li>Retrieve by ID";b+="                  <ul>";b+="                    <li><span id='"+c.pre+"menu1_pdbid' class='link'>PDB ID</span></li>";b+="                    <li><span id='"+c.pre+"menu1_mmcifid' class='link'>mmCIF ID</span></li>";b+="                    <li><span id='"+c.pre+"menu1_mmdbid' class='link'>MMDB ID</span></li>";b+="                    <li><span id='"+c.pre+"menu1_gi' class='link'>gi</span></li>";b+="                    <li><span id='"+c.pre+"menu1_cid' class='link'>PubChem CID</span></li>";b+="                  </ul>";b+="                </li>";b+="                <li><span id='"+c.pre+"menu1_pdbfile' class='link'>Open PDB File</span></li>";b+="                <li><span id='"+c.pre+"menu1_state' class='link'>Open State/Script</span></li>";b+="                <li><span id='"+c.pre+"menu1_exportState' class='link'>Export State<br/></span></li>";b+="                <li><span id='"+c.pre+"menu1_exportCanvas' class='link'>Export Image</span></li>";b+="                <li>Links";b+="                  <ul>";b+="                    <li><span id='"+c.pre+"menu1_link_structure' class='link'>Search Structure</span></li>";b+="                    <li><span id='"+c.pre+"menu1_link_vast' class='link'>Find Similar Structures</span></li>";b+="                    <li><span id='"+c.pre+"menu1_link_pubmed' class='link'>Literature</span></li>";b+="                  </ul>";b+="                </li>";b+="              </ul>";b+="              </div>";b+="          </accordion>";b+="    </div>";b+="    </td>";b+="    <td valign='top'>";b+="    <div style='float:left;'>";b+="          <accordion id='"+c.pre+"accordion2'>";b+="              <h3>Select</h3>";b+="              <div>";b+="              <ul class='menu'>";b+="                <li>Select";b+="                  <ul>";if(c.cfg.cid===undefined){b+="                      <li><input type='radio' name='"+c.pre+"menu2_select' id='"+c.pre+"menu2_select_chain'><label for='"+c.pre+"menu2_select_chain'>Structure/Chain</label></li>"}b+="                      <li><input type='radio' name='"+c.pre+"menu2_select' id='"+c.pre+"menu2_selectall'><label for='"+c.pre+"menu2_selectall'>All</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu2_select' id='"+c.pre+"menu2_selectcomplement'><label for='"+c.pre+"menu2_selectcomplement'>Complement</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu2_select' id='"+c.pre+"menu2_aroundsphere'><label for='"+c.pre+"menu2_aroundsphere'>Custom Sphere</label></li>";if(c.cfg.cid===undefined){b+="                      <li><input type='radio' name='"+c.pre+"menu2_select' id='"+c.pre+"menu2_selectresidues'><label for='"+c.pre+"menu2_selectresidues'>Sequences</label></li>"}if(c.cfg.align!==undefined){b+="                      <li><input type='radio' name='"+c.pre+"menu2_select' id='"+c.pre+"menu2_alignment'><label for='"+c.pre+"menu2_alignment'>Aligned Seq.</label></li>"}b+="                      <li><input type='radio' name='"+c.pre+"menu2_select' id='"+c.pre+"menu2_command'><label for='"+c.pre+"menu2_command'>by Command</label></li>";b+="                  </ul>";b+="                </li>";b+="                <li>Picking";b+="                  <ul>";if(c.cfg.cid===undefined){b+="                      <li><input type='radio' name='"+c.pre+"menu2_picking' id='"+c.pre+"menu2_pickingResidue' checked><label for='"+c.pre+"menu2_pickingResidue'>Residue</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu2_picking' id='"+c.pre+"menu2_pickingYes'><label for='"+c.pre+"menu2_pickingYes'>Atom</label></li>"}else{b+="                      <li><input type='radio' name='"+c.pre+"menu2_picking' id='"+c.pre+"menu2_pickingResidue'><label for='"+c.pre+"menu2_pickingResidue'>Residue</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu2_picking' id='"+c.pre+"menu2_pickingYes' checked><label for='"+c.pre+"menu2_pickingYes'>Atom</label></li>"}b+="                      <li><input type='radio' name='"+c.pre+"menu2_picking' id='"+c.pre+"menu2_pickingNo'><label for='"+c.pre+"menu2_pickingNo'>Off</label></li>";b+="                  </ul>";b+="                </li>";b+="                <li>Display";b+="                  <ul>";if(c.cfg.align!==undefined){b+="                      <li><input type='radio' name='"+c.pre+"menu2_display' id='"+c.pre+"menu2_alternate'><label for='"+c.pre+"menu2_alternate'>Alternate Structures</label></li>"}b+="                      <li><input type='radio' name='"+c.pre+"menu2_display' id='"+c.pre+"menu2_toggle'><label for='"+c.pre+"menu2_toggle'>Toggle Selection</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu2_display' id='"+c.pre+"menu2_show_selected'><label for='"+c.pre+"menu2_show_selected'>Display Selection</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu2_display' id='"+c.pre+"toggleHighlight2'><label for='"+c.pre+"toggleHighlight2'>Toggle Highlight</label></li>";b+="                  </ul>";b+="                </li>";b+="                    <li>Highlight Color";b+="                      <ul>";b+="                        <li><input type='radio' name='"+c.pre+"menu2_hl_color' id='"+c.pre+"menu2_hl_colorYellow' checked><label for='"+c.pre+"menu2_hl_colorYellow'>Yellow</label></li>";b+="                        <li><input type='radio' name='"+c.pre+"menu2_hl_color' id='"+c.pre+"menu2_hl_colorGreen'><label for='"+c.pre+"menu2_hl_colorGreen'>Green</label></li>";b+="                        <li><input type='radio' name='"+c.pre+"menu2_hl_color' id='"+c.pre+"menu2_hl_colorRed'><label for='"+c.pre+"menu2_hl_colorRed'>Red</label></li>";b+="                      </ul>";b+="                    </li>";b+="                    <li>Highlight Style";b+="                      <ul>";if(Detector.webgl){b+="                        <li><input type='radio' name='"+c.pre+"menu2_hl_style' id='"+c.pre+"menu2_hl_styleOutline' checked><label for='"+c.pre+"menu2_hl_styleOutline'>Outline</label></li>";b+="                        <li><input type='radio' name='"+c.pre+"menu2_hl_style' id='"+c.pre+"menu2_hl_styleObject'><label for='"+c.pre+"menu2_hl_styleObject'>3D Objects</label></li>"}else{b+="                        <li><input type='radio' name='"+c.pre+"menu2_hl_style' id='"+c.pre+"menu2_hl_styleOutline'><label for='"+c.pre+"menu2_hl_styleOutline'>Outline</label></li>";b+="                        <li><input type='radio' name='"+c.pre+"menu2_hl_style' id='"+c.pre+"menu2_hl_styleObject' checked><label for='"+c.pre+"menu2_hl_styleObject'>3D Objects</label></li>"}b+="                      </ul>";b+="                    </li>";b+="              </ul>";b+="              </div>";b+="          </accordion>";b+="    </div>";b+="    </td>";b+="    <td valign='top'>";b+="    <div style='float:left;'>";b+="          <accordion id='"+c.pre+"accordion3'>";b+="              <h3>Style</h3>";b+="              <div>";b+="              <ul class='menu'>";if(c.cfg.cid===undefined){b+="                <li>Protein";b+="                  <ul>";b+="                      <li><input type='radio' name='"+c.pre+"menu3_protein' id='"+c.pre+"menu3_proteinRibbon' checked><label for='"+c.pre+"menu3_proteinRibbon'>Ribbon</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu3_protein' id='"+c.pre+"menu3_proteinStrand'><label for='"+c.pre+"menu3_proteinStrand'>Strand</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu3_protein' id='"+c.pre+"menu3_proteinCylinder'><label for='"+c.pre+"menu3_proteinCylinder'>Cylinder and Plate</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu3_protein' id='"+c.pre+"menu3_proteinCalpha'><label for='"+c.pre+"menu3_proteinCalpha'>C alpha Trace</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu3_protein' id='"+c.pre+"menu3_proteinBfactor'><label for='"+c.pre+"menu3_proteinBfactor'>B Factor Tube</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu3_protein' id='"+c.pre+"menu3_proteinLines'><label for='"+c.pre+"menu3_proteinLines'>Lines</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu3_protein' id='"+c.pre+"menu3_proteinStick'><label for='"+c.pre+"menu3_proteinStick'>Stick</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu3_protein' id='"+c.pre+"menu3_proteinBallstick'><label for='"+c.pre+"menu3_proteinBallstick'>Ball and Stick</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu3_protein' id='"+c.pre+"menu3_proteinSphere'><label for='"+c.pre+"menu3_proteinSphere'>Sphere</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu3_protein' id='"+c.pre+"menu3_proteinNothing'><label for='"+c.pre+"menu3_proteinNothing'>Hide</label></li>";b+="                  </ul>";b+="                </li>";b+="                <li>Nucleotides";b+="                  <ul>";b+="                      <li><input type='radio' name='"+c.pre+"menu3_nucl' id='"+c.pre+"menu3_nuclCartoon'><label for='"+c.pre+"menu3_nuclCartoon'>Cartoon</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu3_nucl' id='"+c.pre+"menu3_nuclPhos' checked><label for='"+c.pre+"menu3_nuclPhos'>Phosphorus Trace</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu3_nucl' id='"+c.pre+"menu3_nuclLines'><label for='"+c.pre+"menu3_nuclLines'>Lines</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu3_nucl' id='"+c.pre+"menu3_nuclStick'><label for='"+c.pre+"menu3_nuclStick'>Stick</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu3_nucl' id='"+c.pre+"menu3_nuclBallstick'><label for='"+c.pre+"menu3_nuclBallstick'>Ball and Stick</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu3_nucl' id='"+c.pre+"menu3_nuclSphere'><label for='"+c.pre+"menu3_nuclSphere'>Sphere</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu3_nucl' id='"+c.pre+"menu3_nuclNothing'><label for='"+c.pre+"menu3_nuclNothing'>Hide</label></li>";b+="                  </ul>";b+="                </li>"}b+="                <li>Ligands";b+="                  <ul>";b+="                      <li><input type='radio' name='"+c.pre+"menu3_ligands' id='"+c.pre+"menu3_ligandsLines'><label for='"+c.pre+"menu3_ligandsLines'>Lines</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu3_ligands' id='"+c.pre+"menu3_ligandsStick' checked><label for='"+c.pre+"menu3_ligandsStick'>Stick</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu3_ligands' id='"+c.pre+"menu3_ligandsBallstick'><label for='"+c.pre+"menu3_ligandsBallstick'>Ball and Stick</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu3_ligands' id='"+c.pre+"menu3_ligandsSphere'><label for='"+c.pre+"menu3_ligandsSphere'>Sphere</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu3_ligands' id='"+c.pre+"menu3_ligandsNothing'><label for='"+c.pre+"menu3_ligandsNothing'>Hide</label></li>";b+="                  </ul>";b+="                </li>";b+="                <li>Ions";b+="                  <ul>";b+="                      <li><input type='radio' name='"+c.pre+"menu3_ions' id='"+c.pre+"menu3_ionsSphere' checked><label for='"+c.pre+"menu3_ionsSphere'>Sphere</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu3_ions' id='"+c.pre+"menu3_ionsDot'><label for='"+c.pre+"menu3_ionsDot'>Dot</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu3_ions' id='"+c.pre+"menu3_ionsNothing'><label for='"+c.pre+"menu3_ionsNothing'>Hide</label></li>";b+="                  </ul>";b+="                </li>";b+="                <li>Water";b+="                  <ul>";b+="                      <li><input type='radio' name='"+c.pre+"menu3_water' id='"+c.pre+"menu3_waterSphere'><label for='"+c.pre+"menu3_waterSphere'>Sphere</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu3_water' id='"+c.pre+"menu3_waterDot'><label for='"+c.pre+"menu3_waterDot'>Dot</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu3_water' id='"+c.pre+"menu3_waterNothing' checked><label for='"+c.pre+"menu3_waterNothing'>Hide</label></li>";b+="                  </ul>";b+="                </li>";b+="              </ul>";b+="              </div>";b+="          </accordion>";b+="    </div>";b+="    </td>";b+="    <td valign='top'>";b+="    <div style='float:left;'>";b+="          <accordion id='"+c.pre+"accordion4'>";b+="              <h3>Color</h3>";b+="              <div>";b+="              <ul class='menu'>";if(c.cfg.cid===undefined){if(c.cfg.mmdbid!==undefined){b+="                <li><input type='radio' name='"+c.pre+"menu4_color' id='"+c.pre+"menu4_colorSpectrum'><label for='"+c.pre+"menu4_colorSpectrum'>Spectrum</label></li>"}else{b+="                <li><input type='radio' name='"+c.pre+"menu4_color' id='"+c.pre+"menu4_colorSpectrum' checked><label for='"+c.pre+"menu4_colorSpectrum'>Spectrum</label></li>"}b+="                <li><input type='radio' name='"+c.pre+"menu4_color' id='"+c.pre+"menu4_colorChain'><label for='"+c.pre+"menu4_colorChain'>Chain</label></li>";b+="                <li><input type='radio' name='"+c.pre+"menu4_color' id='"+c.pre+"menu4_colorSS'><label for='"+c.pre+"menu4_colorSS'>Secondary</label></li>";b+="                <li><input type='radio' name='"+c.pre+"menu4_color' id='"+c.pre+"menu4_colorBfactor'><label for='"+c.pre+"menu4_colorBfactor'>B Factor</label></li>";b+="                <li><input type='radio' name='"+c.pre+"menu4_color' id='"+c.pre+"menu4_colorResidue'><label for='"+c.pre+"menu4_colorResidue'>Residue</label></li>";b+="                <li><input type='radio' name='"+c.pre+"menu4_color' id='"+c.pre+"menu4_colorPolarity'><label for='"+c.pre+"menu4_colorPolarity'>Polarity</label></li>";b+="                <li><input type='radio' name='"+c.pre+"menu4_color' id='"+c.pre+"menu4_colorAtom'><label for='"+c.pre+"menu4_colorAtom'>Atom</label></li>"}else{b+="                <li><input type='radio' name='"+c.pre+"menu4_color' id='"+c.pre+"menu4_colorAtom' checked><label for='"+c.pre+"menu4_colorAtom'>Atom</label></li>"}b+="                <li>-</li>";b+="                <li>Unicolor";b+="                  <ul>";b+="                    <li><input type='radio' name='"+c.pre+"menu4_color' id='"+c.pre+"menu4_colorRed'><label for='"+c.pre+"menu4_colorRed'>Red</label></li>";b+="                    <li><input type='radio' name='"+c.pre+"menu4_color' id='"+c.pre+"menu4_colorGreen'><label for='"+c.pre+"menu4_colorGreen'>Green</label></li>";b+="                    <li><input type='radio' name='"+c.pre+"menu4_color' id='"+c.pre+"menu4_colorBlue'><label for='"+c.pre+"menu4_colorBlue'>Blue</label></li>";b+="                    <li><input type='radio' name='"+c.pre+"menu4_color' id='"+c.pre+"menu4_colorMagenta'><label for='"+c.pre+"menu4_colorMagenta'>Magenta</label></li>";b+="                    <li><input type='radio' name='"+c.pre+"menu4_color' id='"+c.pre+"menu4_colorYellow'><label for='"+c.pre+"menu4_colorYellow'>Yellow</label></li>";b+="                    <li><input type='radio' name='"+c.pre+"menu4_color' id='"+c.pre+"menu4_colorCyan'><label for='"+c.pre+"menu4_colorCyan'>Cyan</label></li>";b+="                    <li><input type='radio' name='"+c.pre+"menu4_color' id='"+c.pre+"menu4_colorWhite'><label for='"+c.pre+"menu4_colorWhite'>White</label></li>";b+="                    <li><input type='radio' name='"+c.pre+"menu4_color' id='"+c.pre+"menu4_colorGrey'><label for='"+c.pre+"menu4_colorGrey'>Grey</label></li>";b+="                  </ul>";b+="                <li>-</li>";b+="                <li><input type='radio' name='"+c.pre+"menu4_color' id='"+c.pre+"menu4_colorCustom'><label for='"+c.pre+"menu4_colorCustom'>Custom</label></li>";b+="              </ul>";b+="              </div>";b+="          </accordion>";b+="    </div>";b+="    </td>";b+="    <td valign='top'>";b+="    <div style='float:left;'>";b+="          <accordion id='"+c.pre+"accordion5'>";b+="              <h3>Surface</h3>";b+="              <div>";b+="              <ul class='menu'>";b+="                <li>Show Surface";b+="                  <ul>";b+="                      <li><input type='radio' name='"+c.pre+"menu5_showsurface' id='"+c.pre+"menu5_showsurfaceYes'><label for='"+c.pre+"menu5_showsurfaceYes'>Yes</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu5_showsurface' id='"+c.pre+"menu5_showsurfaceNo' checked><label for='"+c.pre+"menu5_showsurfaceNo'>No</label></li>";b+="                  </ul>";b+="                </li>";b+="                <li>Type";b+="                  <ul>";b+="                      <li><input type='radio' name='"+c.pre+"menu5_surface' id='"+c.pre+"menu5_surfaceVDW' checked><label for='"+c.pre+"menu5_surfaceVDW'>Van der Waals</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu5_surface' id='"+c.pre+"menu5_surfaceSES'><label for='"+c.pre+"menu5_surfaceSES'>Solvent Excluded</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu5_surface' id='"+c.pre+"menu5_surfaceSAS'><label for='"+c.pre+"menu5_surfaceSAS'>Solvent Accessible</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu5_surface' id='"+c.pre+"menu5_surfaceMolecular'><label for='"+c.pre+"menu5_surfaceMolecular'>Molecular Surface</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu5_surface' id='"+c.pre+"menu5_surfaceNothing'><label for='"+c.pre+"menu5_surfaceNothing'>Hide</label></li>";b+="                  </ul>";b+="                </li>";b+="                <li>Opacity";b+="                  <ul>";b+="                      <li><input type='radio' name='"+c.pre+"menu5_opacity' id='"+c.pre+"menu5_opacity10'><label for='"+c.pre+"menu5_opacity10'>1.0</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu5_opacity' id='"+c.pre+"menu5_opacity09'><label for='"+c.pre+"menu5_opacity09'>0.9</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu5_opacity' id='"+c.pre+"menu5_opacity08' checked><label for='"+c.pre+"menu5_opacity08'>0.8</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu5_opacity' id='"+c.pre+"menu5_opacity07'><label for='"+c.pre+"menu5_opacity07'>0.7</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu5_opacity' id='"+c.pre+"menu5_opacity06'><label for='"+c.pre+"menu5_opacity06'>0.6</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu5_opacity' id='"+c.pre+"menu5_opacity05'><label for='"+c.pre+"menu5_opacity05'>0.5</label></li>";b+="                  </ul>";b+="                </li>";b+="                <li>Wireframe";b+="                  <ul>";b+="                      <li><input type='radio' name='"+c.pre+"menu5_wireframe' id='"+c.pre+"menu5_wireframeYes'><label for='"+c.pre+"menu5_wireframeYes'>Yes</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu5_wireframe' id='"+c.pre+"menu5_wireframeNo' checked><label for='"+c.pre+"menu5_wireframeNo'>No</label></li>";b+="                  </ul>";b+="                </li>";b+="              </ul>";b+="              </div>";b+="          </accordion>";b+="    </div>";b+="    </td>";b+="    <td valign='top'>";b+="    <div style='float:left;'>";b+="          <accordion id='"+c.pre+"accordion6'>";b+="              <h3>Other</h3>";b+="              <div>";b+="              <ul class='menu'>";b+="                <li><span id='"+c.pre+"reset' class='link'>Reset</span></li>";b+="                <li><span id='"+c.pre+"menu6_selectedcenter' class='link'>Zoom in Selection</span></li>";b+="                <li><span id='"+c.pre+"menu6_back' class='link'>Back</span></li>";b+="                <li><span id='"+c.pre+"menu6_forward' class='link'>Forward</span></li>";if(c.cfg.cid===undefined){b+="                <li>Assembly";b+="                  <ul>";b+="                      <li><input type='radio' name='"+c.pre+"menu6_assembly' id='"+c.pre+"menu6_assemblyYes'><label for='"+c.pre+"menu6_assemblyYes'>Yes</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu6_assembly' id='"+c.pre+"menu6_assemblyNo' checked><label for='"+c.pre+"menu6_assemblyNo'>No</label></li>";b+="                  </ul>";b+="                </li>";b+="                <li>H-bonds to selection";b+="                  <ul>";b+="                      <li><input type='radio' name='"+c.pre+"menu6_hbonds' id='"+c.pre+"menu6_hbondsYes'><label for='"+c.pre+"menu6_hbondsYes'>Show</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu6_hbonds' id='"+c.pre+"menu6_hbondsNo' checked><label for='"+c.pre+"menu6_hbondsNo'>Hide</label></li>";b+="                  </ul>";b+="                </li>"}b+="                <li>Custom Labels";b+="                  <ul>";b+="                      <li><input type='radio' name='"+c.pre+"menu6_addlabel' id='"+c.pre+"menu6_addlabelYes'><label for='"+c.pre+"menu6_addlabelYes'>Show</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu6_addlabel' id='"+c.pre+"menu6_addlabelNo' checked><label for='"+c.pre+"menu6_addlabelNo'>Hide</label></li>";b+="                  </ul>";b+="                </li>";b+="                <li>Distance";b+="                  <ul>";b+="                      <li><input type='radio' name='"+c.pre+"menu6_distance' id='"+c.pre+"menu6_distanceYes'><label for='"+c.pre+"menu6_distanceYes'>Show</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu6_distance' id='"+c.pre+"menu6_distanceNo' checked><label for='"+c.pre+"menu6_distanceNo'>Hide</label></li>";b+="                  </ul>";b+="                </li>";b+="                <li>Auto Rotation";b+="                  <ul>";b+="                      <li><span id='"+c.pre+"menu6_rotateleft' class='link'>Rotate Left</span></li>";b+="                      <li><span id='"+c.pre+"menu6_rotateright' class='link'>Rotate Right</span></li>";b+="                      <li><span id='"+c.pre+"menu6_rotateup' class='link'>Rotate Up</span></li>";b+="                      <li><span id='"+c.pre+"menu6_rotatedown' class='link'>Rotate Down</span></li>";b+="                  </ul>";b+="                </li>";b+="                <li>Camera";b+="                  <ul>";b+="                      <li><input type='radio' name='"+c.pre+"menu6_camera' id='"+c.pre+"menu6_cameraPers' checked><label for='"+c.pre+"menu6_cameraPers'>Perspective</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu6_camera' id='"+c.pre+"menu6_cameraOrth'><label for='"+c.pre+"menu6_cameraOrth'>Orthographic</label></li>";b+="                  </ul>";b+="                </li>";b+="                <li>Background";b+="                  <ul>";b+="                      <li><input type='radio' name='"+c.pre+"menu6_bkgd' id='"+c.pre+"menu6_bkgdBlack' checked><label for='"+c.pre+"menu6_bkgdBlack'>Black</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu6_bkgd' id='"+c.pre+"menu6_bkgdGrey'><label for='"+c.pre+"menu6_bkgdGrey'>Grey</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu6_bkgd' id='"+c.pre+"menu6_bkgdWhite'><label for='"+c.pre+"menu6_bkgdWhite'>White</label></li>";b+="                  </ul>";b+="                </li>";b+="                <li>XYZ-axes";b+="                  <ul>";b+="                      <li><input type='radio' name='"+c.pre+"menu6_showaxis' id='"+c.pre+"menu6_showaxisYes'><label for='"+c.pre+"menu6_showaxisYes'>Show</label></li>";b+="                      <li><input type='radio' name='"+c.pre+"menu6_showaxis' id='"+c.pre+"menu6_showaxisNo' checked><label for='"+c.pre+"menu6_showaxisNo'>Hide</label></li>";b+="                  </ul>";b+="                </li>";b+="                <li>Transform Hint";b+="                  <ul>";b+="                    <li>Rotate";b+="                        <ul>";b+="                            <li>Left Mouse</li>";b+="                            <li>Key L: Left</li>";b+="                            <li>Key J: Right</li>";b+="                            <li>Key I: Up</li>";b+="                            <li>Key M: Down</li>";b+="                        </ul>";b+="                    </li>";b+="                    <li>Zoom";b+="                        <ul>";b+="                            <li>Middle Mouse</li>";b+="                            <li>Left Mouse + Shift</li>";b+="                            <li>Key Z: Zoom in</li>";b+="                            <li>Key X: Zoom out</li>";b+="                        </ul>";b+="                    </li>";b+="                    <li>Translate";b+="                        <ul>";b+="                            <li>Right Mouse</li>";b+="                            <li>Left Mouse + Ctrl</li>";b+="                            <li>Arrow Left: Left</li>";b+="                            <li>Arrow Right: Right</li>";b+="                            <li>Arrow Up: Up</li>";b+="                            <li>Arrow Down: Down</li>";b+="                        </ul>";b+="                    </li>";b+="                  </ul>";b+="                </li>";b+="                <li><a href='//www.ncbi.nlm.nih.gov/Structure/icn3d/icn3d.html' target='_blank'>Help</a></li>";b+="              </ul>";b+="              </div>";b+="          </accordion>";b+="    </div>";b+="    </td>";b+="    <td valign='top'>";b+="    <div style='float:left; margin:10px 5px 0px 5px;'>";b+="    <a href='//www.ncbi.nlm.nih.gov/Structure/icn3d/icn3d.html' target='_blank'><span class='ui-icon ui-icon-help middleIcon link' title='click to see the help page'></span></a>";b+="    </div>";b+="    </td>";b+="  </tr>";b+="  </table>";b+="  </div>";b+="  <div id='"+c.pre+"commandlog' style='position:absolute; z-index:555; float:left; display:table-row; margin: 3px 0px 0px "+c.MENU_WIDTH+"px;'>";b+="    <div style='float:left' class='commandTitle'>Script/Log (<a href='//www.ncbi.nlm.nih.gov/Structure/icn3d/icn3d.html#commands' target='_blank'><span title='click to see all commands'>Hint</span></a>)</div><br/>";b+="    <textarea id='"+c.pre+"logtext' rows='3' cols='40'></textarea>";b+="  </div>";b+="  <div id='"+c.pre+"selection' style='position:absolute; z-index:555; float:left; display:table-row; margin: 32px 0px 0px 3px;'>";b+="    <table style='margin-top: 3px;'><tr valign='center'>";if(c.cfg.cid===undefined){b+="        <td valign='top'><span class='commandTitle'>Structure:</span><br/>";b+="        <div style='margin-top:-3px;'><select id='"+c.pre+"structureid' multiple size='1' style='min-width:50px;'>";b+="        </select></div></td>";if(c.cfg.align!==undefined){b+="        <td valign='top'><span class='commandTitle'>Aligned:</span><br/>";b+="        <div style='margin-top:-3px;'><select id='"+c.pre+"alignChainid' multiple size='1' style='min-width:50px;'>";b+="        </select></div></td>"}else{b+="        <td valign='top'><span class='commandTitle'>Chain:</span><br/>";b+="        <div style='margin-top:-3px;'><select id='"+c.pre+"chainid' multiple size='1' style='min-width:50px;'>";b+="        </select></div></td>"}}b+="        <td valign='top'><span class='commandTitle'>Custom:</span><br/>";b+="        <div style='margin-top:-3px;'><select id='"+c.pre+"customResidues' multiple size='1' style='min-width:50px;'>";b+="        </select></div></td>";var d=c.isMobile()?"none":"button";b+="      <td valign='top'><div style='margin:3px 0px 0px 10px;'><button style='-webkit-appearance:"+d+"; height:36px;' id='"+c.pre+"selectall'><span style='white-space:nowrap' class='commandTitle' title='Select all atoms'>Select<br/>All</span></button></div></td>";var a;if(c.cfg.align!==undefined){a="Aligned<br/>Seq."}else{a="Sequ-<br/>ence"}if(c.cfg.cid===undefined){b+="      <td valign='top'><div style='margin:3px 0px 0px 10px;'><button style='-webkit-appearance:"+d+"; height:36px;' id='"+c.pre+"show_sequences'><span style='white-space:nowrap' class='commandTitle' title='Show the sequences of the selected structure'>"+a+"</span></button></div></td>";b+="      <td valign='top'><div id='"+c.pre+"alternateWrapper' style='margin:3px 0px 0px 10px;'><button style='-webkit-appearance:"+d+"; height:36px;' id='"+c.pre+"alternate'><span style='white-space:nowrap' class='commandTitle' title='Alternate the structures'>Alternate<br/>Selection</span></button></div></td>"}b+="      <td valign='top'><div style='margin:3px 0px 0px 10px;'><button style='-webkit-appearance:"+d+"; height:36px;' id='"+c.pre+"show_selected'><span style='white-space:nowrap' class='commandTitle' title='Display the selected atoms ONLY'>Display<br/>Selection</span></button></div></td>";b+="      <td valign='top'><div style='margin:3px 0px 0px 10px;'><button style='-webkit-appearance:"+d+"; height:36px;' id='"+c.pre+"zoomin_selection'><span style='white-space:nowrap' class='commandTitle' title='Center on the selected atoms and zoom in'>Zoom in<br/>Selection</span></button></div></td>";if(c.cfg.align===undefined){b+="      <td valign='top'><div style='margin:3px 0px 0px 10px;'><button style='-webkit-appearance:"+d+"; height:36px;' id='"+c.pre+"sviewer'><span style='white-space:nowrap' class='commandTitle' title='Show selected residues in NCBI Sequence Viewer'>Sequence<br/>Viewer</span></button></div></td>"}b+="    </tr></table>";b+="    </div>";b+="  <div id='"+c.pre+"viewer' style='width:100%; height:100%; background-color: #ddd;'>";b+="   <div id='"+c.pre+"menuLogSection'>";b+="    <div style='height: "+c.MENU_HEIGHT+"px;'></div>";b+="    <div style='height: "+c.MENU_HEIGHT+"px;'></div>";b+="   </div>";b+="    <div id='"+c.pre+"wait' style='width:100%; height: 100%; background-color: rgba(221,221,221, 0.8);'><div style='padding-top:25%; text-align: center; font-size: 2em; color: #777777;'>Loading the structure...</div></div>";b+="    <canvas id='"+c.pre+"canvas' style='width:100%; height: 100%; background-color: #000;'>Your browser does not support WebGL.</canvas>";b+="  </div>";b+="</div>";b+="<!-- dialog will not be part of the form -->";b+="<div id='"+c.pre+"allselections' class='hidden'>";b+="<div id='"+c.pre+"dl_filter' style='overflow:auto; position:relative;'>";b+="  <div style='text-align:center; margin-bottom:10px;'><button id='"+c.pre+"filter'><span style='white-space:nowrap'><b>Show Structure</b></span></button>";b+="<button id='"+c.pre+"label_3d_diagram' style='margin-left:10px;'><span style='white-space:nowrap'><b>Show Labels</b></span></button></div>";b+="  <div id='"+c.pre+"dl_filter_table' class='box'>";b+="  </div>";b+="</div>";b+="<div id='"+c.pre+"dl_selectresidues'>";b+="  <div id='"+c.pre+"dl_sequence' class='dl_sequence'>";b+="  </div>";b+="</div>";if(c.cfg.align!==undefined){b+="<div id='"+c.pre+"dl_alignment'>";b+="  <div id='"+c.pre+"dl_sequence2' class='dl_sequence'>";b+="  </div>";b+="</div>"}b+="<div id='"+c.pre+"dl_command'>";b+="  <table><tr><td valign='top'><table>";b+="<tr><td align='right'><b>Select (<a href='//www.ncbi.nlm.nih.gov/Structure/icn3d/icn3d.html#selectb' target='_blank'><span title='click to see how to select'>Hint</span></a>):</b></td><td><input type='text' id='"+c.pre+"command' placeholder='#[structures].[chains]:[residues]@[atoms]' size='30'></td></tr>";b+="<tr><td align='right'><b>Name:</b></td><td><input type='text' id='"+c.pre+"command_name' placeholder='my_selection' size='30'></td></tr>";b+="<tr><td align='right'><b>Description:</b></td><td><input type='text' id='"+c.pre+"command_desc' placeholder='description about my selection' size='30'></td></tr>";b+="<tr><td colspan='2' align='center'><button id='"+c.pre+"command_apply'><b>Apply</b></button></td></tr>";b+="  </table></td>";b+="  <td valign='top'><div>";b+="    <b>Atom Selection(s):</b> <br/>";b+="    <select id='"+c.pre+"customAtoms' multiple size='3' style='min-width:100px;'>";b+="    </select>";b+="  </td>";b+="  <td valign='top'><div>";b+="    <button id='"+c.pre+"show_selected_atom'><span style='white-space:nowrap'><b>Display Selection</b></span></button>";b+="  </div></td></tr>";b+="  <tr><td colspan='3'>(Script format: select [select] | name [name] | description [description])</td></tr></table>";b+="</div>";b+="<div id='"+c.pre+"dl_pdbid'>";b+="PDB ID: <input type='text' id='"+c.pre+"pdbid' value='2POR' size=8> ";b+="<button id='"+c.pre+"reload_pdb'>Load</button>";b+="</div>";b+="<div id='"+c.pre+"dl_pdbfile'>";b+="PDB File: <input type='file' id='"+c.pre+"pdbfile' value='2POR' size=8> ";b+="<button id='"+c.pre+"reload_pdbfile'>Load</button>";b+="</div>";b+="<div id='"+c.pre+"dl_mmcifid'>";b+="mmCIF ID: <input type='text' id='"+c.pre+"mmcifid' value='2POR' size=8> ";b+="<button id='"+c.pre+"reload_mmcif'>Load</button>";b+="</div>";b+="<div id='"+c.pre+"dl_mmdbid'>";b+="MMDB ID: <input type='text' id='"+c.pre+"mmdbid' value='2POR' size=8> ";b+="<button id='"+c.pre+"reload_mmdb'>Load</button>";b+="</div>";b+="<div id='"+c.pre+"dl_gi'>";b+="Protein gi: <input type='text' id='"+c.pre+"gi' value='827343227' size=8> ";b+="<button id='"+c.pre+"reload_gi'>Load</button>";b+="</div>";b+="<div id='"+c.pre+"dl_cid'>";b+="PubChem CID: <input type='text' id='"+c.pre+"cid' value='2244' size=8> ";b+="<button id='"+c.pre+"reload_cid'>Load</button>";b+="</div>";b+="<div id='"+c.pre+"dl_state'>";b+="State file: <input type='file' id='"+c.pre+"state'><br/>";b+="<button id='"+c.pre+"reload_state' style='margin-top: 6px;'>Load</button>";b+="</div>";b+="<div id='"+c.pre+"dl_color'>";b+="Custom Color: <input type='text' id='"+c.pre+"color' value='#FF0000' size=8> ";b+="<button id='"+c.pre+"applycustomcolor'>Apply</button>";b+="</div>";b+="<div id='"+c.pre+"dl_hbonds'>";b+="  <span style='white-space:nowrap;'>Threshold: <select id='"+c.pre+"hbondthreshold'>";b+="  <option value='3.2'>3.2</option>";b+="  <option value='3.3'>3.3</option>";b+="  <option value='3.4'>3.4</option>";b+="  <option value='3.5' selected>3.5</option>";b+="  <option value='3.6'>3.6</option>";b+="  <option value='3.7'>3.7</option>";b+="  <option value='3.8'>3.8</option>";b+="  <option value='3.9'>3.9</option>";b+="  <option value='4.0'>4.0</option>";b+="  </select> &#197;</span><br/>";b+="  <span style='white-space:nowrap'><button id='"+c.pre+"applyhbonds'>Display</button></span>";b+="</div>";b+="<div id='"+c.pre+"dl_aroundsphere'";b+="  <span style='white-space:nowrap'>1. Sphere with a radius: <input type='text' id='"+c.pre+"radius_aroundsphere' value='5' size='2'> &#197;</span><br/>";b+="  <span style='white-space:nowrap'>2. <button id='"+c.pre+"applypick_aroundsphere'>Display</button> the sphere around currently selected atoms</span>";b+="</div>";b+="<div id='"+c.pre+"dl_select_chain'>";b+="    <table><tr valign='center'>";b+="        <td valign='top'><b>Structure:</b><br/>";b+="        <select id='"+c.pre+"structureid2' multiple size='3' style='min-width:50px;'>";b+="        </select></td>";b+="        <td valign='top'><b>Chain:</b><br/>";b+="        <select id='"+c.pre+"chainid2' multiple size='3' style='min-width:50px;'>";b+="        </select></td>";if(c.cfg.align!==undefined){b+="        <td valign='top'><b>Aligned:</b><br/>";b+="        <select id='"+c.pre+"alignChainid2' multiple size='3' style='min-width:50px;'>";b+="        </select></td>"}b+="        <td valign='top'><b>Custom:</b><br/>";b+="        <select id='"+c.pre+"customResidues2' multiple size='3' style='min-width:50px;'>";b+="        </select></td>";b+="    </tr></table>";b+="</div>";b+="<div id='"+c.pre+"dl_addlabel'>";b+="1. Text: <input type='text' id='"+c.pre+"labeltext' value='Text' size=4><br/>";b+="2. Size: <input type='text' id='"+c.pre+"labelsize' value='40' size=4><br/>";b+="3. Color: <input type='text' id='"+c.pre+"labelcolor' value='#ffff00' size=4><br/>";b+="4. Background: <input type='text' id='"+c.pre+"labelbkgd' value='#cccccc' size=4><br/>";b+="<span style='white-space:nowrap'>5. Pick TWO atoms</span><br/>";b+="<span style='white-space:nowrap'>6. <button id='"+c.pre+"applypick_labels'>Display</button></span>";b+="</div>";b+="<div id='"+c.pre+"dl_distance'>";b+="  <span style='white-space:nowrap'>1. Pick TWO atoms</span><br/>";b+="  <span style='white-space:nowrap'>2. <button id='"+c.pre+"applypick_measuredistance'>Display</button></span>";b+="</div>";b+="</div>";b+="<!--/form-->";$("#"+e).html(b);$("accordion").accordion({collapsible:true,active:false,heightStyle:"content"});$("accordion div").removeClass("ui-accordion-content ui-corner-all ui-corner-bottom ui-widget-content");$(".menu").menu({position:{my:"left top",at:"right top"}});$(".menu").hover(function(){},function(){$("accordion").accordion("option","active","none")});$("#"+c.pre+"accordion1").hover(function(){$("#"+c.pre+"accordion1 div").css("display","block")},function(){$("#"+c.pre+"accordion1 div").css("display","none")});$("#"+c.pre+"accordion2").hover(function(){$("#"+c.pre+"accordion2 div").css("display","block")},function(){$("#"+c.pre+"accordion2 div").css("display","none")});$("#"+c.pre+"accordion3").hover(function(){$("#"+c.pre+"accordion3 div").css("display","block")},function(){$("#"+c.pre+"accordion3 div").css("display","none")});$("#"+c.pre+"accordion4").hover(function(){$("#"+c.pre+"accordion4 div").css("display","block")},function(){$("#"+c.pre+"accordion4 div").css("display","none")});$("#"+c.pre+"accordion5").hover(function(){$("#"+c.pre+"accordion5 div").css("display","block")},function(){$("#"+c.pre+"accordion5 div").css("display","none")});$("#"+c.pre+"accordion6").hover(function(){$("#"+c.pre+"accordion6 div").css("display","block")},function(){$("#"+c.pre+"accordion6 div").css("display","none")})},clickBack:function(){var a=this;$("#"+a.pre+"back").add("#"+a.pre+"menu6_back").click(function(b){b.preventDefault();a.setLogCommand("back",false);a.back()})},clickForward:function(){var a=this;$("#"+a.pre+"forward").add("#"+a.pre+"menu6_forward").click(function(b){b.preventDefault();a.setLogCommand("forward",false);a.forward()})},clickToggle:function(){var a=this;$("#"+a.pre+"toggle").add("#"+a.pre+"menu2_toggle").click(function(b){a.setLogCommand("toggle selected atoms",true);a.toggleSelection()})},clickHlColorYellow:function(){var a=this;$("#"+a.pre+"menu2_hl_colorYellow").click(function(b){a.setLogCommand("set highlight color yellow",true);a.icn3d.highlightColor=new THREE.Color(16776960);a.icn3d.matShader=a.icn3d.setOutlineColor("yellow");a.icn3d.draw()})},clickHlColorGreen:function(){var a=this;$("#"+a.pre+"menu2_hl_colorGreen").click(function(b){a.setLogCommand("set highlight color green",true);a.icn3d.highlightColor=new THREE.Color(65280);a.icn3d.matShader=a.icn3d.setOutlineColor("green");a.icn3d.draw()})},clickHlColorRed:function(){var a=this;$("#"+a.pre+"menu2_hl_colorRed").click(function(b){a.setLogCommand("set highlight color red",true);a.icn3d.highlightColor=new THREE.Color(16711680);a.icn3d.matShader=a.icn3d.setOutlineColor("red");a.icn3d.draw()})},clickHlStyleOutline:function(){var a=this;$("#"+a.pre+"menu2_hl_styleOutline").click(function(b){a.setLogCommand("set highlight style outline",true);a.icn3d.bHighlight=1;a.icn3d.draw()})},clickHlStyleObject:function(){var a=this;$("#"+a.pre+"menu2_hl_styleObject").click(function(b){a.setLogCommand("set highlight style object",true);a.icn3d.bHighlight=2;a.icn3d.draw()})},clickAlternate:function(){var a=this;$("#"+a.pre+"alternate").add("#"+a.pre+"menu2_alternate").click(function(b){a.setLogCommand("alternate structures",false);a.alternateStructures()})},clickMenu1_pdbid:function(){var a=this;$("#"+a.pre+"menu1_pdbid").click(function(b){a.openDialog(a.pre+"dl_pdbid","Please input PDB ID")})},clickMenu1_pdbfile:function(){var a=this;$("#"+a.pre+"menu1_pdbfile").click(function(b){a.openDialog(a.pre+"dl_pdbfile","Please input PDB File")})},clickMenu1_mmcifid:function(){var a=this;$("#"+a.pre+"menu1_mmcifid").click(function(b){a.openDialog(a.pre+"dl_mmcifid","Please input mmCIF ID")})},clickMenu1_mmdbid:function(){var a=this;$("#"+a.pre+"menu1_mmdbid").click(function(b){a.openDialog(a.pre+"dl_mmdbid","Please input MMDB ID")})},clickMenu1_gi:function(){var a=this;$("#"+a.pre+"menu1_gi").click(function(b){a.openDialog(a.pre+"dl_gi","Please input protein gi")})},clickMenu1_cid:function(){var a=this;$("#"+a.pre+"menu1_cid").click(function(b){a.openDialog(a.pre+"dl_cid","Please input PubChem CID")})},clickMenu1_state:function(){var a=this;$("#"+a.pre+"menu1_state").click(function(b){a.openDialog(a.pre+"dl_state","Please input the state file")})},clickMenu1_exportState:function(){var a=this;$("#"+a.pre+"menu1_exportState").click(function(b){a.setLogCommand("export state file",false);a.saveFile(a.inputid+"_statefile.txt","text")})},clickMenu1_exportCanvas:function(){var a=this;$("#"+a.pre+"menu1_exportCanvas").click(function(b){a.setLogCommand("export canvas",false);a.saveFile(a.inputid+"_image.png","png")})},clickMenu1_link_structure:function(){var a=this;$("#"+a.pre+"menu1_link_structure").click(function(c){var b="//www.ncbi.nlm.nih.gov/structure/?term="+a.inputid;a.setLogCommand("link to search structure "+a.inputid+": "+b,false);window.open(b,"_blank")})},clickMenu1_link_vast:function(){var a=this;$("#"+a.pre+"menu1_link_vast").click(function(c){var b="//www.ncbi.nlm.nih.gov/Structure/vastplus/vastplus.cgi?uid="+a.inputid;a.setLogCommand("link to structures similar to "+a.inputid+": "+b,false);window.open(b,"_blank")})},clickMenu1_link_pubmed:function(){var a=this;$("#"+a.pre+"menu1_link_pubmed").click(function(c){var b;if(a.pmid!==undefined){b="//www.ncbi.nlm.nih.gov/pubmed/"+a.pmid}else{b="//www.ncbi.nlm.nih.gov/pubmed/?term="+a.inputid}a.setLogCommand("link to literature about "+a.inputid+": "+b,false);window.open(b,"_blank")})},clickMenu2_selectresidues:function(){var a=this;$("#"+a.pre+"menu2_selectresidues").click(function(b){a.openDialog(a.pre+"dl_selectresidues","Select residues in sequences with coordinates")})},selectAll:function(){var c=this;c.icn3d.highlightAtoms={};for(var b in c.icn3d.chains){c.icn3d.highlightAtoms=c.icn3d.unionHash(c.icn3d.highlightAtoms,c.icn3d.chains[b])}c.icn3d.removeHighlightObjects();var a=c.getSequencesAnnotations(Object.keys(c.icn3d.chains));$("#"+c.pre+"dl_sequence").html(a.sequencesHtml);$("#"+c.pre+"dl_sequence").width(c.RESIDUE_WIDTH*a.maxSeqCnt+200);c.icn3d.addHighlightObjects()},clickMenu2_selectall:function(){var a=this;$("#"+a.pre+"menu2_selectall").add("#"+a.pre+"selectall").click(function(b){a.setLogCommand("select all",true);a.selectAll()})},selectComplement:function(){var j=this;var c={};var g={};var h;for(var d in j.icn3d.atoms){if(!j.icn3d.highlightAtoms.hasOwnProperty(d)){c[d]=1;h=j.icn3d.atoms[d].structure+"_"+j.icn3d.atoms[d].chain+"_"+j.icn3d.atoms[d].resi;g[h]=1}}j.icn3d.highlightAtoms={};j.icn3d.cloneHash(c,j.icn3d.highlightAtoms);j.icn3d.removeHighlightObjects();var b="<b>Annotation(s):</b> Complement of the current selection<br/>";var f=[];for(var a in j.icn3d.chains){f.push(a)}var e=j.getSequencesAnnotations(f,false,Object.keys(g));$("#"+j.pre+"dl_sequence").html(b+e.sequencesHtml);$("#"+j.pre+"dl_sequence").width(j.RESIDUE_WIDTH*e.maxSeqCnt+200);j.icn3d.addHighlightObjects()},clickMenu2_selectcomplement:function(){var a=this;$("#"+a.pre+"menu2_selectcomplement").click(function(b){if(Object.keys(a.icn3d.highlightAtoms).length<Object.keys(a.icn3d.atoms).length){a.setLogCommand("select complement",true);a.selectComplement()}})},clickMenu2_alignment:function(){var a=this;$("#"+a.pre+"menu2_alignment").click(function(b){a.openDialog(a.pre+"dl_alignment","Select residues in aligned sequences")})},clickMenu2_command:function(){var a=this;$("#"+a.pre+"menu2_command").click(function(b){a.openDialog(a.pre+"dl_command","Use command to define selections")})},clickMenu2_pickingYes:function(){var a=this;$("#"+a.pre+"menu2_pickingYes").click(function(b){a.icn3d.picking=1;a.icn3d.options.picking="atom";a.setLogCommand("picking yes",true)})},clickMenu2_pickingNo:function(){var a=this;$("#"+a.pre+"menu2_pickingNo").click(function(b){a.icn3d.picking=0;a.icn3d.options.picking="no";a.setLogCommand("picking no",true);a.icn3d.draw(undefined,undefined);a.icn3d.removeHighlightObjects()})},clickMenu2_pickingResidue:function(){var a=this;$("#"+a.pre+"menu2_pickingResidue").click(function(b){a.icn3d.picking=2;a.icn3d.options.picking="atom";a.setLogCommand("picking residue",true)})},clickMenu2_aroundsphere:function(){var a=this;$("#"+a.pre+"menu2_aroundsphere").click(function(b){a.openDialog(a.pre+"dl_aroundsphere","Select a sphere around current selection")})},clickMenu2_select_chain:function(){var a=this;$("#"+a.pre+"menu2_select_chain").click(function(b){a.openDialog(a.pre+"dl_select_chain","Select Structure/Chain/Custom Selection")})},clickMenu3_proteinRibbon:function(){var a=this;$("#"+a.pre+"menu3_proteinRibbon").click(function(b){a.setStyle("protein","ribbon");a.setLogCommand("style protein ribbon",true)})},clickMenu3_proteinStrand:function(){var a=this;$("#"+a.pre+"menu3_proteinStrand").click(function(b){a.setStyle("protein","strand");a.setLogCommand("style protein strand",true)})},clickMenu3_proteinCylinder:function(){var a=this;$("#"+a.pre+"menu3_proteinCylinder").click(function(b){a.setStyle("protein","cylinder & plate");a.setLogCommand("style protein cylinder & plate",true)})},clickMenu3_proteinCalpha:function(){var a=this;$("#"+a.pre+"menu3_proteinCalpha").click(function(b){a.setStyle("protein","C alpha trace");a.setLogCommand("style protein C alpha trace",true)})},clickMenu3_proteinBfactor:function(){var a=this;$("#"+a.pre+"menu3_proteinBfactor").click(function(b){a.setStyle("protein","B factor tube");a.setLogCommand("style protein B factor tube",true)})},clickMenu3_proteinLines:function(){var a=this;$("#"+a.pre+"menu3_proteinLines").click(function(b){a.setStyle("protein","lines");a.setLogCommand("style protein lines",true)})},clickMenu3_proteinStick:function(){var a=this;$("#"+a.pre+"menu3_proteinStick").click(function(b){a.setStyle("protein","stick");a.setLogCommand("style protein stick",true)})},clickMenu3_proteinBallstick:function(){var a=this;$("#"+a.pre+"menu3_proteinBallstick").click(function(b){a.setStyle("protein","ball & stick");a.setLogCommand("style protein ball & stick",true)})},clickMenu3_proteinSphere:function(){var a=this;$("#"+a.pre+"menu3_proteinSphere").click(function(b){a.setStyle("protein","sphere");a.setLogCommand("style protein sphere",true)})},clickMenu3_proteinNothing:function(){var a=this;$("#"+a.pre+"menu3_proteinNothing").click(function(b){a.setStyle("protein","nothing");a.setLogCommand("style protein nothing",true)})},clickmenu3_nuclCartoon:function(){var a=this;$("#"+a.pre+"menu3_nuclCartoon").click(function(b){a.setStyle("nucleotides","nucleotide cartoon");a.setLogCommand("style nucleotides nucleotide cartoon",true)})},clickmenu3_nuclPhos:function(){var a=this;$("#"+a.pre+"menu3_nuclPhos").click(function(b){a.setStyle("nucleotides","phosphorus trace");a.setLogCommand("style nucleotides phosphorus trace",true)})},clickmenu3_nuclLines:function(){var a=this;$("#"+a.pre+"menu3_nuclLines").click(function(b){a.setStyle("nucleotides","lines");a.setLogCommand("style nucleotides lines",true)})},clickmenu3_nuclStick:function(){var a=this;$("#"+a.pre+"menu3_nuclStick").click(function(b){a.setStyle("nucleotides","stick");a.setLogCommand("style nucleotides stick",true)})},clickmenu3_nuclBallstick:function(){var a=this;$("#"+a.pre+"menu3_nuclBallstick").click(function(b){a.setStyle("nucleotides","ball & stick");a.setLogCommand("style nucleotides ball & stick",true)})},clickmenu3_nuclSphere:function(){var a=this;$("#"+a.pre+"menu3_nuclSphere").click(function(b){a.setStyle("nucleotides","sphere");a.setLogCommand("style nucleotides sphere",true)})},clickmenu3_nuclNothing:function(){var a=this;$("#"+a.pre+"menu3_nuclNothing").click(function(b){a.setStyle("nucleotides","nothing");a.setLogCommand("style nucleotides nothing",true)})},clickMenu3_ligandsLines:function(){var a=this;$("#"+a.pre+"menu3_ligandsLines").click(function(b){a.setStyle("ligands","lines");a.setLogCommand("style ligands lines",true)})},clickMenu3_ligandsStick:function(){var a=this;$("#"+a.pre+"menu3_ligandsStick").click(function(b){a.setStyle("ligands","stick");a.setLogCommand("style ligands stick",true)})},clickMenu3_ligandsBallstick:function(){var a=this;$("#"+a.pre+"menu3_ligandsBallstick").click(function(b){a.setStyle("ligands","ball & stick");a.setLogCommand("style ligands ball & stick",true)})},clickMenu3_ligandsSphere:function(){var a=this;$("#"+a.pre+"menu3_ligandsSphere").click(function(b){a.setStyle("ligands","sphere");a.setLogCommand("style ligands sphere",true)})},clickMenu3_ligandsNothing:function(){var a=this;$("#"+a.pre+"menu3_ligandsNothing").click(function(b){a.setStyle("ligands","nothing");a.setLogCommand("style ligands nothing",true)})},clickMenu3_ionsSphere:function(){var a=this;$("#"+a.pre+"menu3_ionsSphere").click(function(b){a.setStyle("ions","sphere");a.setLogCommand("style ions sphere",true)})},clickMenu3_ionsDot:function(){var a=this;$("#"+a.pre+"menu3_ionsDot").click(function(b){a.setStyle("ions","dot");a.setLogCommand("style ions dot",true)})},clickMenu3_ionsNothing:function(){var a=this;$("#"+a.pre+"menu3_ionsNothing").click(function(b){a.setStyle("ions","nothing");a.setLogCommand("style ions nothing",true)})},clickMenu3_waterSphere:function(){var a=this;$("#"+a.pre+"menu3_waterSphere").click(function(b){a.setStyle("water","sphere");a.setLogCommand("style water sphere",true)})},clickMenu3_waterDot:function(){var a=this;$("#"+a.pre+"menu3_waterDot").click(function(b){a.setStyle("water","dot");a.setLogCommand("style water dot",true)})},clickMenu3_waterNothing:function(){var a=this;$("#"+a.pre+"menu3_waterNothing").click(function(b){a.setStyle("water","nothing");a.setLogCommand("style water nothing",true)})},clickMenu4_colorSpectrum:function(){var a=this;$("#"+a.pre+"menu4_colorSpectrum").click(function(b){a.setOption("color","spectrum");a.setLogCommand("color spectrum",true)})},clickMenu4_colorChain:function(){var a=this;$("#"+a.pre+"menu4_colorChain").click(function(b){a.setOption("color","chain");a.setLogCommand("color chain",true)})},clickMenu4_colorSS:function(){var a=this;$("#"+a.pre+"menu4_colorSS").click(function(b){a.setOption("color","secondary structure");a.setLogCommand("color secondary structure",true)})},clickMenu4_colorBfactor:function(){var a=this;$("#"+a.pre+"menu4_colorBfactor").click(function(b){a.setOption("color","B factor");a.setLogCommand("color B factor",true)})},clickMenu4_colorResidue:function(){var a=this;$("#"+a.pre+"menu4_colorResidue").click(function(b){a.setOption("color","residue");a.setLogCommand("color residue",true)})},clickMenu4_colorPolarity:function(){var a=this;$("#"+a.pre+"menu4_colorPolarity").click(function(b){a.setOption("color","polarity");a.setLogCommand("color polarity",true)})},clickMenu4_colorAtom:function(){var a=this;$("#"+a.pre+"menu4_colorAtom").click(function(b){a.setOption("color","atom");a.setLogCommand("color atom",true)})},clickMenu4_colorRed:function(){var a=this;$("#"+a.pre+"menu4_colorRed").click(function(b){a.setOption("color","red");a.setLogCommand("color red",true)})},clickMenu4_colorGreen:function(){var a=this;$("#"+a.pre+"menu4_colorGreen").click(function(b){a.setOption("color","green");a.setLogCommand("color green",true)})},clickMenu4_colorBlue:function(){var a=this;$("#"+a.pre+"menu4_colorBlue").click(function(b){a.setOption("color","blue");a.setLogCommand("color blue",true)})},clickMenu4_colorMagenta:function(){var a=this;$("#"+a.pre+"menu4_colorMagenta").click(function(b){a.setOption("color","magenta");a.setLogCommand("color magenta",true)})},clickMenu4_colorYellow:function(){var a=this;$("#"+a.pre+"menu4_colorYellow").click(function(b){a.setOption("color","yellow");a.setLogCommand("color yellow",true)})},clickMenu4_colorCyan:function(){var a=this;$("#"+a.pre+"menu4_colorCyan").click(function(b){a.setOption("color","cyan");a.setLogCommand("color cyan",true)})},clickMenu4_colorWhite:function(){var a=this;$("#"+a.pre+"menu4_colorWhite").click(function(b){a.setOption("color","white");a.setLogCommand("color white",true)})},clickMenu4_colorGrey:function(){var a=this;$("#"+a.pre+"menu4_colorGrey").click(function(b){a.setOption("color","grey");a.setLogCommand("color grey",true)})},clickMenu4_colorCustom:function(){var a=this;$("#"+a.pre+"menu4_colorCustom").click(function(b){a.openDialog(a.pre+"dl_color","Choose custom color")})},clickMenu5_showsurfaceYes:function(){var a=this;$("#"+a.pre+"menu5_showsurfaceYes").click(function(b){a.setOption("showsurface","yes");a.setLogCommand("showsurface yes",true)})},clickMenu5_showsurfaceNo:function(){var a=this;$("#"+a.pre+"menu5_showsurfaceNo").click(function(b){a.setOption("showsurface","no");a.setLogCommand("showsurface no",true)})},clickMenu5_surfaceVDW:function(){var a=this;$("#"+a.pre+"menu5_surfaceVDW").click(function(b){a.setOption("surface","Van der Waals surface");a.setLogCommand("surface Van der Waals surface",true)})},clickMenu5_surfaceSES:function(){var a=this;$("#"+a.pre+"menu5_surfaceSES").click(function(b){a.setOption("surface","solvent excluded surface");a.setLogCommand("surface solvent excluded surface",true)})},clickMenu5_surfaceSAS:function(){var a=this;$("#"+a.pre+"menu5_surfaceSAS").click(function(b){a.setOption("surface","solvent accessible surface");a.setLogCommand("surface solvent accessible surface",true)})},clickMenu5_surfaceMolecular:function(){var a=this;$("#"+a.pre+"menu5_surfaceMolecular").click(function(b){a.setOption("surface","molecular surface");a.setLogCommand("surface molecular surface",true)})},clickMenu5_surfaceNothing:function(){var a=this;$("#"+a.pre+"menu5_surfaceNothing").click(function(b){a.setOption("surface","nothing");a.setLogCommand("surface nothing",true)})},clickMenu5_opacity10:function(){var a=this;$("#"+a.pre+"menu5_opacity10").click(function(b){a.setOption("opacity","1.0");a.setLogCommand("opacity 1.0",true)})},clickMenu5_opacity09:function(){var a=this;$("#"+a.pre+"menu5_opacity09").click(function(b){a.setOption("opacity","0.9");a.setLogCommand("opacity 0.9",true)})},clickMenu5_opacity08:function(){var a=this;$("#"+a.pre+"menu5_opacity08").click(function(b){a.setOption("opacity","0.8");a.setLogCommand("opacity 0.8",true)})},clickMenu5_opacity07:function(){var a=this;$("#"+a.pre+"menu5_opacity07").click(function(b){a.setOption("opacity","0.7");a.setLogCommand("opacity 0.7",true)})},clickMenu5_opacity06:function(){var a=this;$("#"+a.pre+"menu5_opacity06").click(function(b){a.setOption("opacity","0.6");a.setLogCommand("opacity 0.6",true)})},clickMenu5_opacity05:function(){var a=this;$("#"+a.pre+"menu5_opacity05").click(function(b){a.setOption("opacity","0.5");a.setLogCommand("opacity 0.5",true)})},clickMenu5_wireframeYes:function(){var a=this;$("#"+a.pre+"menu5_wireframeYes").click(function(b){a.setOption("wireframe","yes");a.setLogCommand("wireframe yes",true)})},clickMenu5_wireframeNo:function(){var a=this;$("#"+a.pre+"menu5_wireframeNo").click(function(b){a.setOption("wireframe","no");a.setLogCommand("wireframe no",true)})},clickMenu6_assemblyYes:function(){var a=this;$("#"+a.pre+"menu6_assemblyYes").click(function(b){a.icn3d.bAssembly=true;a.setLogCommand("assembly yes",true);a.icn3d.draw()})},clickMenu6_assemblyNo:function(){var a=this;$("#"+a.pre+"menu6_assemblyNo").click(function(b){a.icn3d.bAssembly=false;a.setLogCommand("assembly no",true);a.icn3d.draw()})},clickMenu6_addlabelYes:function(){var a=this;$("#"+a.pre+"menu6_addlabelYes").click(function(b){a.openDialog(a.pre+"dl_addlabel","Add custom labels");a.icn3d.picking=1;a.icn3d.pickpair=true;a.icn3d.pickedatomNum=0})},clickMenu6_addlabelNo:function(){var a=this;$("#"+a.pre+"menu6_addlabelNo").click(function(c){a.icn3d.pickpair=false;var b="show label no";a.setLogCommand(b,true);a.options.labels="no";a.icn3d.draw(a.options)})},clickMenu6_distanceYes:function(){var a=this;$("#"+a.pre+"menu6_distanceYes").click(function(b){a.openDialog(a.pre+"dl_distance","Measure the distance of atoms");a.icn3d.picking=1;a.icn3d.pickpair=true;a.icn3d.pickedatomNum=0})},clickMenu6_distanceNo:function(){var a=this;$("#"+a.pre+"menu6_distanceNo").click(function(c){a.icn3d.pickpair=false;var b="show distance no";a.setLogCommand(b,true);a.options.lines="no";a.icn3d.draw(a.options)})},clickMenu6_selectedcenter:function(){var a=this;$("#"+a.pre+"menu6_selectedcenter").add("#"+a.pre+"zoomin_selection").click(function(b){a.setLogCommand("zoomin selected atoms",true);a.icn3d.zoominSelection()})},clickMenu6_rotateleft:function(){var a=this;$("#"+a.pre+"menu6_rotateleft").click(function(b){a.setLogCommand("rotate left",true);a.icn3d.bStopRotate=false;a.ROTATION_DIRECTION="left";a.rotateStructure("left")})},clickMenu6_rotateright:function(){var a=this;$("#"+a.pre+"menu6_rotateright").click(function(b){a.setLogCommand("rotate right",true);a.icn3d.bStopRotate=false;a.ROTATION_DIRECTION="right";a.rotateStructure("right")})},clickMenu6_rotateup:function(){var a=this;$("#"+a.pre+"menu6_rotateup").click(function(b){a.setLogCommand("rotate up",true);a.icn3d.bStopRotate=false;a.ROTATION_DIRECTION="up";a.rotateStructure("up")})},clickMenu6_rotatedown:function(){var a=this;$("#"+a.pre+"menu6_rotatedown").click(function(b){a.setLogCommand("rotate down",true);a.icn3d.bStopRotate=false;a.ROTATION_DIRECTION="down";a.rotateStructure("down")})},clickMenu6_cameraPers:function(){var a=this;$("#"+a.pre+"menu6_cameraPers").click(function(b){a.setOption("camera","perspective");a.setLogCommand("camera perspective",true)})},clickMenu6_cameraOrth:function(){var a=this;$("#"+a.pre+"menu6_cameraOrth").click(function(b){a.setOption("camera","orthographic");a.setLogCommand("camera orthographic",true)})},clickMenu6_bkgdBlack:function(){var a=this;$("#"+a.pre+"menu6_bkgdBlack").click(function(b){a.setOption("background","black");a.setLogCommand("background black",true)})},clickMenu6_bkgdGrey:function(){var a=this;$("#"+a.pre+"menu6_bkgdGrey").click(function(b){a.setOption("background","grey");a.setLogCommand("background grey",true)})},clickMenu6_bkgdWhite:function(){var a=this;$("#"+a.pre+"menu6_bkgdWhite").click(function(b){a.setOption("background","white");a.setLogCommand("background white",true)})},clickMenu6_showaxisYes:function(){var a=this;$("#"+a.pre+"menu6_showaxisYes").click(function(b){a.setOption("axis","yes");a.setLogCommand("showaxis yes",true)})},clickMenu6_showaxisNo:function(){var a=this;$("#"+a.pre+"menu6_showaxisNo").click(function(b){a.setOption("axis","no");a.setLogCommand("showaxis no",true)})},clickMenu6_hbondsYes:function(){var a=this;$("#"+a.pre+"menu6_hbondsYes").click(function(b){a.openDialog(a.pre+"dl_hbonds","Hydrogen Bonds")})},clickMenu6_hbondsNo:function(){var a=this;$("#"+a.pre+"menu6_hbondsNo").click(function(c){var b="show hbonds no";a.setLogCommand(b,true);a.options.hbonds="no";a.options.lines="no";a.icn3d.draw(a.options)})},selectSequenceNonMobile:function(){var a=this;$("#"+a.pre+"dl_sequence").selectable({stop:function(){$("#"+a.pre+"chainid").val("");$("#"+a.pre+"structureid").val("");$("#"+a.pre+"chainid2").val("");$("#"+a.pre+"structureid2").val("");$(".ui-selected",this).each(function(){var f=$(this).attr("id");if(f!==undefined&&f!==""){if(a.SELECT_RESIDUE===false){a.removeSeqChainBkgd();a.removeSeqResidueBkgd();a.icn3d.removeHighlightObjects();a.icn3d.highlightAtoms={};a.SELECT_RESIDUE=true;a.selectedResidues={};a.icn3d.highlightAtoms={};a.commanddesc="seq_"+f.substr(f.indexOf("_")+1)}$(this).toggleClass("highlightSeq");var d=f.substr(f.indexOf("_")+1);if($(this).hasClass("highlightSeq")){a.selectAResidue(d,a.commanddesc);a.selectedResidues[d]=1}for(var c in a.icn3d.residues[d]){var e=a.icn3d.atoms[c];if(!$(this).hasClass("highlightSeq")){delete a.icn3d.highlightAtoms[c];a.selectedResidues[d]=undefined}}}});var b={};a.icn3d.addHighlightObjects();$("#"+a.pre+"chainid").val("");$("#"+a.pre+"structureid").val("");$("#"+a.pre+"chainid2").val("");$("#"+a.pre+"structureid2").val("");$(".ui-selected",this).each(function(){var e=$(this).attr("chain");if($(this).hasClass("seqTitle")){a.SELECT_RESIDUE=false;a.setLogCommand("select residue "+Object.keys(a.selectedResidues),true);a.removeSeqChainBkgd(e);a.removeSeqResidueBkgd();$(this).toggleClass("highlightSeq");var d=$(this).attr("chain");var c="seq_"+$(this).text().trim();if($(this).hasClass("highlightSeq")){a.selectAChain(d,c);a.setLogCommand("select chain "+d,true)}else{a.icn3d.removeHighlightObjects();a.icn3d.highlightAtoms={};$("#"+a.pre+"customResidues").val("");$("#"+a.pre+"customResidues2").val("");$("#"+a.pre+"customAtoms").val("")}}})}});$("#"+a.pre+"dl_sequence2").selectable({stop:function(){$("#"+a.pre+"chainid").val("");$("#"+a.pre+"structureid").val("");$("#"+a.pre+"chainid2").val("");$("#"+a.pre+"structureid2").val("");$(".ui-selected",this).each(function(){var f=$(this).attr("id");if(f!==undefined&&f!==""){if(a.SELECT_RESIDUE===false){a.removeSeqChainBkgd();a.removeSeqResidueBkgd();a.icn3d.removeHighlightObjects();a.icn3d.highlightAtoms={};a.SELECT_RESIDUE=true;a.selectedResidues={};a.icn3d.highlightAtoms={};a.commanddesc="alignSeq_"+f.substr(f.indexOf("_")+1)}$(this).toggleClass("highlightSeq");var d=f.substr(f.indexOf("_")+1);if($(this).hasClass("highlightSeq")){a.selectAResidue(d,a.commanddesc);a.selectedResidues[d]=1}for(var c in a.icn3d.residues[d]){var e=a.icn3d.atoms[c];if(!$(this).hasClass("highlightSeq")){delete a.icn3d.highlightAtoms[c];a.selectedResidues[d]=undefined}}}});var b={};a.icn3d.addHighlightObjects();$("#"+a.pre+"chainid").val("");$("#"+a.pre+"structureid").val("");$("#"+a.pre+"chainid2").val("");$("#"+a.pre+"structureid2").val("");$(".ui-selected",this).each(function(){var e=$(this).attr("chain");if($(this).hasClass("seqTitle")){a.SELECT_RESIDUE=false;a.setLogCommand("select residue "+Object.keys(a.selectedResidues),true);a.removeSeqChainBkgd(e);a.removeSeqResidueBkgd();$(this).toggleClass("highlightSeq");var d=$(this).attr("chain");var c="alignSeq_"+$(this).text().trim();if($(this).hasClass("highlightSeq")){a.selectAAlignChain(d,c);a.setLogCommand("select alignChain "+d,true)}else{a.icn3d.removeHighlightObjects();a.icn3d.highlightAtoms={};$("#"+a.pre+"customResidues").val("");$("#"+a.pre+"customResidues2").val("");$("#"+a.pre+"customAtoms").val("")}}})}})},selectSequenceMobile:function(){var a=this;$("#"+a.pre+"dl_sequence").add("#"+a.pre+"dl_sequence2").on("click",".residue",function(f){$("#"+a.pre+"chainid").val("");$("#"+a.pre+"structureid").val("");$("#"+a.pre+"chainid2").val("");$("#"+a.pre+"structureid2").val("");var h=$(this).attr("id");if(h!==undefined&&h!==""){if(a.SELECT_RESIDUE===false){a.removeSeqChainBkgd();a.removeSeqResidueBkgd();a.icn3d.removeHighlightObjects();a.icn3d.highlightAtoms={};a.SELECT_RESIDUE=true;a.selectedResidues={};a.icn3d.highlightAtoms={};a.commanddesc="seq_"+h.substr(h.indexOf("_")+1)}$(this).toggleClass("highlightSeq");var c=h.substr(h.indexOf("_")+1);if($(this).hasClass("highlightSeq")){a.selectAResidue(c,a.commanddesc);a.selectedResidues[c]=1}for(var b in a.icn3d.residues[c]){var d=a.icn3d.atoms[b];if(!$(this).hasClass("highlightSeq")){delete a.icn3d.highlightAtoms[b];a.selectedResidues[c]=undefined}}}var g={};a.icn3d.addHighlightObjects()})},selectChainMobile:function(){var a=this;$("#"+a.pre+"dl_sequence").on("click",".seqTitle",function(d){$("#"+a.pre+"chainid").val("");$("#"+a.pre+"structureid").val("");$("#"+a.pre+"chainid2").val("");$("#"+a.pre+"structureid2").val("");var f=$(this).attr("chain");a.SELECT_RESIDUE=false;a.setLogCommand("select residue "+Object.keys(a.selectedResidues),true);a.removeSeqChainBkgd(f);a.removeSeqResidueBkgd();$(this).toggleClass("highlightSeq");var c=$(this).attr("chain");var b="seq_"+$(this).text().trim();if($(this).hasClass("highlightSeq")){a.selectAChain(c,b);a.setLogCommand("select chain "+c,true)}else{a.icn3d.removeHighlightObjects();a.icn3d.highlightAtoms={};$("#"+a.pre+"customResidues").val("");$("#"+a.pre+"customResidues2").val("");$("#"+a.pre+"customAtoms").val("")}});$("#"+a.pre+"dl_sequence2").on("click",".seqTitle",function(d){$("#"+a.pre+"chainid").val("");$("#"+a.pre+"structureid").val("");$("#"+a.pre+"chainid2").val("");$("#"+a.pre+"structureid2").val("");var f=$(this).attr("chain");a.removeSeqChainBkgd(f);a.removeSeqResidueBkgd();$(this).toggleClass("highlightSeq");var c=$(this).attr("chain");var b="alignSeq_"+$(this).text().trim();if($(this).hasClass("highlightSeq")){a.selectAAlignChain(c,b);a.setLogCommand("select alignChain "+c,true)}else{a.icn3d.removeHighlightObjects();a.icn3d.highlightAtoms={};$("#"+a.pre+"customResidues").val("");$("#"+a.pre+"customResidues2").val("");$("#"+a.pre+"customAtoms").val("")}})},clickStructureid:function(){var a=this;$("#"+a.pre+"structureid").change(function(c){var b=$(this).val();$("#"+a.pre+"structureid2").val("");a.changeStructureid(b)});$("#"+a.pre+"structureid2").change(function(c){var b=$(this).val();$("#"+a.pre+"structureid").val("");a.changeStructureid(b)});$("#"+a.pre+"structureid").focus(function(b){if(a.isMobile()){$("#"+a.pre+"structureid").val("")}$(this).attr("size",$("#"+a.pre+"structureid option").length)});$("#"+a.pre+"structureid").blur(function(b){$(this).attr("size",1)})},clickChainid:function(){var a=this;$("#"+a.pre+"chainid").change(function(c){var b=$(this).val();$("#"+a.pre+"chainid2").val("");a.changeChainid(b)});$("#"+a.pre+"chainid2").change(function(c){var b=$(this).val();$("#"+a.pre+"chainid").val("");a.changeChainid(b)});$("#"+a.pre+"chainid").focus(function(b){if(a.isMobile()){$("#"+a.pre+"chainid").val("")}$(this).attr("size",$("#"+a.pre+"chainid option").length)});$("#"+a.pre+"chainid").blur(function(b){$(this).attr("size",1)})},clickAlignChainid:function(){var a=this;$("#"+a.pre+"alignChainid").change(function(c){var b=$(this).val();$("#"+a.pre+"alignChainid2").val();a.changeAlignChainid(b)});$("#"+a.pre+"alignChainid2").change(function(c){var b=$(this).val();$("#"+a.pre+"alignChainid").val();a.changeAlignChainid(b)});$("#"+a.pre+"alignChainid").focus(function(b){if(a.isMobile()){$("#"+a.pre+"alignChainid").val("")}$(this).attr("size",$("#"+a.pre+"alignChainid option").length)});$("#"+a.pre+"alignChainid").blur(function(b){$(this).attr("size",1)})},clickCustomResidues:function(){var a=this;$("#"+a.pre+"customResidues").change(function(c){var b=$(this).val();$("#"+a.pre+"customResidues2").val("");if(b!==null){a.setLogCommand("select customresidues "+b.toString(),true);a.showCustomResidues(b)}});$("#"+a.pre+"customResidues2").change(function(c){var b=$(this).val();$("#"+a.pre+"customResidues").val("");if(b!==null){a.setLogCommand("select customresidues "+b.toString(),true);a.showCustomResidues(b)}});$("#"+a.pre+"customResidues").focus(function(b){if(a.isMobile()){$("#"+a.pre+"customResidues").val("")}$(this).attr("size",$("#"+a.pre+"customResidues option").length)});$("#"+a.pre+"customResidues").blur(function(b){$(this).attr("size",1)})},clickCustomAtoms:function(){var a=this;$("#"+a.pre+"customAtoms").change(function(c){var b=$(this).val();if(b!==null){a.setLogCommand("select customatoms "+b.toString(),true);a.showCustomAtoms(b)}});$("#"+a.pre+"customAtoms").focus(function(b){if(a.isMobile()){$("#"+a.pre+"customAtoms").val("")}})},clickShow_selected:function(){var a=this;$("#"+a.pre+"show_selected").add("#"+a.pre+"menu2_show_selected").click(function(b){a.setLogCommand("show selected customResidues",true);if($("#"+a.pre+"alignChainid").length>0&&$("#"+a.pre+"alignChainid").val()!==null){a.showSelected(a.pre+"alignChainid")}else{if($("#"+a.pre+"chainid").val()!==null||$("#"+a.pre+"customResidues").val()!==null){a.showSelected(a.pre+"customResidues")}}})},clickShow_sequences:function(){var a=this;$("#"+a.pre+"show_sequences").click(function(b){if($("#"+a.pre+"alignChainid").length>0){a.openDialog(a.pre+"dl_alignment","Select residues in aligned sequences")}else{if($("#"+a.pre+"chainid").length>0){a.openDialog(a.pre+"dl_selectresidues","Select residues in sequences with coordinates")}}})},clickShow_selected_atom:function(){var a=this;$("#"+a.pre+"show_selected_atom").click(function(b){b.preventDefault();a.setLogCommand("show selected customAtoms",true);a.showSelected(a.pre+"customAtoms")})},clickCommand_apply:function(){var a=this;$("#"+a.pre+"command_apply").click(function(f){f.preventDefault();var b=$("#"+a.pre+"command").val();var d=$("#"+a.pre+"command_name").val();var c=$("#"+a.pre+"command_desc").val();a.setLogCommand("select "+b+" | name "+d+" | description "+c,true);a.selectResiduesAtoms(b,d,c)})},clickReload_pdb:function(){var a=this;$("#"+a.pre+"reload_pdb").click(function(b){b.preventDefault();dialog.dialog("close");a.setLogCommand("load pdb "+$("#"+a.pre+"pdbid").val(),false);window.open("//www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?pdbid="+$("#"+a.pre+"pdbid").val(),"_blank")})},clickReload_mmcif:function(){var a=this;$("#"+a.pre+"reload_mmcif").click(function(b){b.preventDefault();dialog.dialog("close");a.setLogCommand("load mmcif "+$("#"+a.pre+"mmcifid").val(),false);window.open("//www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?mmcif="+$("#"+a.pre+"mmcifid").val(),"_blank")})},clickReload_mmdb:function(){var a=this;$("#"+a.pre+"reload_mmdb").click(function(b){b.preventDefault();dialog.dialog("close");a.setLogCommand("load mmdb "+$("#"+a.pre+"mmdbid").val(),false);window.open("//www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?mmdbid="+$("#"+a.pre+"mmdbid").val(),"_blank")})},clickReload_gi:function(){var a=this;$("#"+a.pre+"reload_gi").click(function(b){b.preventDefault();dialog.dialog("close");a.setLogCommand("load gi "+$("#"+a.pre+"gi").val(),false);window.open("//www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?gi="+$("#"+a.pre+"gi").val(),"_blank")})},clickReload_cid:function(){var a=this;$("#"+a.pre+"reload_cid").click(function(b){b.preventDefault();dialog.dialog("close");a.setLogCommand("load cid "+$("#"+a.pre+"cid").val(),false);window.open("//www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?cid="+$("#"+a.pre+"cid").val(),"_blank")})},clickReload_state:function(){var a=this;$("#"+a.pre+"reload_state").click(function(d){d.preventDefault();dialog.dialog("close");var c=$("#"+a.pre+"state")[0].files[0];if(!c){alert("Please select a file before clicking 'Load'")}else{if(!window.File||!window.FileReader||!window.FileList||!window.Blob){alert("The File APIs are not fully supported in this browser.")}var b=new FileReader();b.onload=function(g){var f=g.target.result;a.setLogCommand("load state file "+c,false);a.loadStateFile(f)};b.readAsText(c)}})},clickReload_pdbfile:function(){var a=this;$("#"+a.pre+"reload_pdbfile").click(function(d){d.preventDefault();dialog.dialog("close");var c=$("#"+a.pre+"pdbfile")[0].files[0];if(!c){alert("Please select a file before clicking 'Load'")}else{if(!window.File||!window.FileReader||!window.FileList||!window.Blob){alert("The File APIs are not fully supported in this browser.")}var b=new FileReader();b.onload=function(g){var f=g.target.result;a.setLogCommand("load pdb file "+$("#"+a.pre+"pdbfile").val(),false);a.loadPdbData(f)};b.readAsText(c)}})},clickApplycustomcolor:function(){var a=this;$("#"+a.pre+"applycustomcolor").click(function(b){b.preventDefault();dialog.dialog("close");a.setOption("color",$("#"+a.pre+"color").val());a.setLogCommand("color "+$("#"+a.pre+"color").val(),true)})},clickApplypick_aroundsphere:function(){var a=this;$("#"+a.pre+"applypick_aroundsphere").click(function(d){d.preventDefault();dialog.dialog("close");var c=$("#"+a.pre+"radius_aroundsphere").val();var b="select aroundsphere | radius "+c;a.setLogCommand(b,true);a.pickCustomSphere(b,c)})},clickApplyhbonds:function(){var a=this;$("#"+a.pre+"applyhbonds").click(function(d){d.preventDefault();dialog.dialog("close");var c=$("#"+a.pre+"hbondthreshold").val();var b="show hbonds | threshold "+c;a.setLogCommand(b,true);a.showHbonds(b,c)})},clickApplypick_labels:function(){var a=this;$("#"+a.pre+"applypick_labels").click(function(d){d.preventDefault();dialog.dialog("close");var i=$("#"+a.pre+"labeltext").val();var k=$("#"+a.pre+"labelsize").val();var c=$("#"+a.pre+"labelcolor").val();var b=$("#"+a.pre+"labelbkgd").val();if(a.icn3d.pickedatom===undefined||a.icn3d.pickedatom2===undefined){alert("Please pick another atom")}else{var h=(a.icn3d.pickedatom.coord.x+a.icn3d.pickedatom2.coord.x)/2;var g=(a.icn3d.pickedatom.coord.y+a.icn3d.pickedatom2.coord.y)/2;var f=(a.icn3d.pickedatom.coord.z+a.icn3d.pickedatom2.coord.z)/2;a.setLogCommand("add label "+i+" | x "+h+" y "+g+" z "+f+" | size "+k+" | color "+c+" | background "+b,true);a.addLabel(i,h,g,f,k,c,b);a.icn3d.pickpair=false;var j={};j.labels="yes";a.icn3d.draw(j)}})},clickApplypick_measuredistance:function(){var a=this;$("#"+a.pre+"applypick_measuredistance").click(function(g){g.preventDefault();dialog.dialog("close");if(a.icn3d.pickedatom===undefined||a.icn3d.pickedatom2===undefined){alert("Please pick another atom")}else{var b=parseInt(a.icn3d.pickedatom.coord.distanceTo(a.icn3d.pickedatom2.coord)*10)/10;var k=b.toString()+" A";var m,d,c;var j=(a.icn3d.pickedatom.coord.x+a.icn3d.pickedatom2.coord.x)/2;var i=(a.icn3d.pickedatom.coord.y+a.icn3d.pickedatom2.coord.y)/2;var h=(a.icn3d.pickedatom.coord.z+a.icn3d.pickedatom2.coord.z)/2;a.setLogCommand("add label "+k+" | x "+j+" y "+i+" z "+h+" | size "+m+" | color "+d+" | background "+c,true);a.addLabel(k,j,i,h,m,d,c);var d="#FFFF00";var f=true;a.setLogCommand("add line | x1 "+a.icn3d.pickedatom.coord.x+" y1 "+a.icn3d.pickedatom.coord.y+" z1 "+a.icn3d.pickedatom.coord.z+" | x2 "+a.icn3d.pickedatom2.coord.x+" y2 "+a.icn3d.pickedatom2.coord.y+" z2 "+a.icn3d.pickedatom2.coord.z+" | color "+d+" | dashed "+f,true);a.addLine(a.icn3d.pickedatom.coord.x,a.icn3d.pickedatom.coord.y,a.icn3d.pickedatom.coord.z,a.icn3d.pickedatom2.coord.x,a.icn3d.pickedatom2.coord.y,a.icn3d.pickedatom2.coord.z,d,f);a.icn3d.pickpair=false;var l={};l.labels="yes";l.lines="yes";a.icn3d.draw(l)}})},clickReset:function(){var a=this;$("#"+a.pre+"reset").click(function(b){b.preventDefault();a.setLogCommand("reset",true);a.show3DStructure()})},clickToggleHighlight:function(){var a=this;$("#"+a.pre+"toggleHighlight").add("#"+a.pre+"toggleHighlight2").click(function(b){a.setLogCommand("toggle highlight",true);if(a.icn3d.prevHighlightObjects.length>0){a.icn3d.removeHighlightObjects()}else{a.icn3d.addHighlightObjects()}})},clickSviewer:function(){var a=this;$("#"+a.pre+"sviewer").click(function(l){var m={};for(var j in a.icn3d.highlightAtoms){var o=a.icn3d.atoms[j].chain+"_"+a.icn3d.atoms[j].resi;m[o]=1}var d=Object.keys(m).sort();console.log("residueArray: "+d);var r="",k=0,f,g;var h="";for(var j=0,q=d.length;j<q;++j){var p=d[j].lastIndexOf("_");var b=d[j].substr(0,p);var n=parseInt(d[j].substr(p+1));if(j==0){f=n}if(j!=0&&b!=r){h+=" gi "+f+" "+k+"\n";h+=";";f=n}if(j!=0&&n!=k+1&&r==b){h+=" gi "+f+" "+k+"\n";f=n}r=b;k=n}h+=" gi "+f+" "+k+"\n";console.log("data: "+h);var c="http://testpubchem.ncbi.nlm.nih.gov/wangjiy/icn3d2/sviewer.html?id="+a.cfg.gi+"&track=neighbors&data="+h;window.open(c,"_blank")})},pressCommandtext:function(){var a=this;$("#"+a.pre+"logtext").keypress(function(h){var g=(h.keyCode?h.keyCode:h.which);if(g==13){h.preventDefault();var b=$(this).val();a.icn3d.bRender=true;var d=b.split("\n");var c=d[d.length-1].substr(2);a.icn3d.logs.push(c);$("#"+a.pre+"logtext").val("> "+a.icn3d.logs.join("\n> ")+"\n> ").scrollTop($("#"+a.pre+"logtext")[0].scrollHeight);if(c!==""){var f={};f.factor=a.icn3d._zoomFactor;f.mouseChange=a.icn3d.mouseChange;f.quaternion=a.icn3d.quaternion;a.icn3d.commands.push(c+"|||"+JSON.stringify(f));a.applyCommand(c+"|||"+JSON.stringify(f));a.icn3d.draw()}}})},clickFilter_ckbx_all:function(){var a=this;$("#"+a.pre+"filter_ckbx_all").click(function(f){var b=document.getElementsByName(a.pre+"filter_ckbx");if($(this)[0].checked==true){for(var d=0,c=b.length;d<c;++d){b[d].checked=true}}else{for(var d=0,c=b.length;d<c;++d){b[d].checked=false}}})},clickFilter:function(){var a=this;$("#"+a.pre+"filter").click(function(j){var c=document.getElementsByName(a.pre+"filter_ckbx");var b="";var h="&het=0";for(var g=0,d=c.length;g<d;++g){if(c[g].checked){if(c[g].value=="ligands"){h="&het=2"}else{b+=c[g].value+","}}}if(b==""){b=c[0].value}var f=document.URL+"&mols="+b+"&complexity=2"+h;window.open(f,"_self")})},clickLabel_3d_diagram:function(){var a=this;$("#"+a.pre+"label_3d_diagram").click(function(g){var c=document.getElementsByName(a.pre+"filter_ckbx");var b="";var h=[];for(var f=0,d=c.length;f<d;++f){if(c[f].checked){if(c[f].value!="ligands"){h.push(a.icn3d.savedLabels[c[f].value])}}}a.icn3d.labels=h;a.icn3d.createLabelRepresentation(a.icn3d.labels);a.icn3d.render()})},clickStopSelection:function(){var a=this;$(document).on("click","."+a.pre+"stopselection",function(b){a.SELECT_RESIDUE=false;a.setLogCommand("select residue "+Object.keys(a.selectedResidues),true)})},bindMouseup:function(){var a=this;$("accordion").bind("mouseup touchend",function(b){if(a.icn3d.controls){a.icn3d.controls.noRotate=false;a.icn3d.controls.noZoom=false;a.icn3d.controls.noPan=false}})},bindMousedown:function(){var a=this;$("accordion").bind("mousedown touchstart",function(b){if(a.icn3d.controls){a.icn3d.controls.noRotate=true;a.icn3d.controls.noZoom=true;a.icn3d.controls.noPan=true}})},windowResize:function(){var a=this;if(a.cfg.resize!==undefined&&a.cfg.resize&&!a.isMobile()){$(window).resize(function(){var c=$(window).width()-a.LESSWIDTH;var b=$(window).height()-a.LESSHEIGHT;a.resizeCanvas(c,b)})}},isMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},isMac:function(){return/Mac/i.test(navigator.userAgent)},isSessionStorageSupported:function(){var b="test";try{sessionStorage.setItem(b,"1");sessionStorage.removeItem(b);return true}catch(a){return false}},saveCommandsToSession:function(){var b=this;var a=b.icn3d.commands.join("\n");var c=decodeURIComponent(a);sessionStorage.setItem("commands",c)},getCommandsBeforeCrash:function(){var a=this;window.addEventListener("load",function(){sessionStorage.setItem("good_exit","pending")});window.addEventListener("beforeunload",function(){sessionStorage.setItem("good_exit","true")});if(sessionStorage.getItem("good_exit")&&sessionStorage.getItem("good_exit")!=="true"){a.CRASHED=true;a.commandsBeforeCrash=sessionStorage.getItem("commands")}},allEventFunctions:function(){var a=this;if(!a.isMobile()){a.selectSequenceNonMobile()}else{a.selectSequenceMobile();a.selectChainMobile()}a.clickBack();a.clickForward();a.clickToggle();a.clickHlColorYellow();a.clickHlColorGreen();a.clickHlColorRed();a.clickHlStyleOutline();a.clickHlStyleObject();a.clickAlternate();a.clickMenu1_pdbid();a.clickMenu1_pdbfile();a.clickMenu1_mmcifid();a.clickMenu1_mmdbid();a.clickMenu1_gi();a.clickMenu1_cid();a.clickMenu1_state();a.clickMenu1_exportState();a.clickMenu1_exportCanvas();a.clickMenu1_link_structure();a.clickMenu1_link_vast();a.clickMenu1_link_pubmed();a.clickMenu2_selectresidues();a.clickMenu2_selectcomplement();a.clickMenu2_selectall();a.clickMenu2_alignment();a.clickMenu2_command();a.clickMenu2_pickingYes();a.clickMenu2_pickingNo();a.clickMenu2_pickingResidue();a.clickMenu2_aroundsphere();a.clickMenu2_select_chain();a.clickMenu3_proteinRibbon();a.clickMenu3_proteinStrand();a.clickMenu3_proteinCylinder();a.clickMenu3_proteinCalpha();a.clickMenu3_proteinBfactor();a.clickMenu3_proteinLines();a.clickMenu3_proteinStick();a.clickMenu3_proteinBallstick();a.clickMenu3_proteinSphere();a.clickMenu3_proteinNothing();a.clickmenu3_nuclCartoon();a.clickmenu3_nuclPhos();a.clickmenu3_nuclLines();a.clickmenu3_nuclStick();a.clickmenu3_nuclBallstick();a.clickmenu3_nuclSphere();a.clickmenu3_nuclNothing();a.clickMenu3_ligandsLines();a.clickMenu3_ligandsStick();a.clickMenu3_ligandsBallstick();a.clickMenu3_ligandsSphere();a.clickMenu3_ligandsNothing();a.clickMenu3_ionsSphere();a.clickMenu3_ionsDot();a.clickMenu3_ionsNothing();a.clickMenu3_waterSphere();a.clickMenu3_waterDot();a.clickMenu3_waterNothing();a.clickMenu4_colorSpectrum();a.clickMenu4_colorChain();a.clickMenu4_colorSS();a.clickMenu4_colorBfactor();a.clickMenu4_colorResidue();a.clickMenu4_colorPolarity();a.clickMenu4_colorAtom();a.clickMenu4_colorRed();a.clickMenu4_colorGreen();a.clickMenu4_colorBlue();a.clickMenu4_colorMagenta();a.clickMenu4_colorYellow();a.clickMenu4_colorCyan();a.clickMenu4_colorWhite();a.clickMenu4_colorGrey();a.clickMenu4_colorCustom();a.clickMenu5_showsurfaceYes();a.clickMenu5_showsurfaceNo();a.clickMenu5_surfaceVDW();a.clickMenu5_surfaceSES();a.clickMenu5_surfaceSAS();a.clickMenu5_surfaceSAS();a.clickMenu5_surfaceNothing();a.clickMenu5_opacity10();a.clickMenu5_opacity09();a.clickMenu5_opacity08();a.clickMenu5_opacity07();a.clickMenu5_opacity06();a.clickMenu5_opacity05();a.clickMenu5_wireframeYes();a.clickMenu5_wireframeNo();a.clickMenu6_assemblyYes();a.clickMenu6_assemblyNo();a.clickMenu6_addlabelYes();a.clickMenu6_addlabelNo();a.clickMenu6_distanceYes();a.clickMenu6_distanceNo();a.clickMenu6_selectedcenter();a.clickMenu6_rotateleft();a.clickMenu6_rotateright();a.clickMenu6_rotateup();a.clickMenu6_rotatedown();a.clickMenu6_cameraPers();a.clickMenu6_cameraOrth();a.clickMenu6_bkgdBlack();a.clickMenu6_bkgdGrey();a.clickMenu6_bkgdWhite();a.clickMenu6_showaxisYes();a.clickMenu6_showaxisNo();a.clickMenu6_hbondsYes();a.clickMenu6_hbondsNo();a.clickStructureid();a.clickChainid();a.clickAlignChainid();a.clickCustomResidues();a.clickCustomAtoms();a.clickShow_selected();a.clickShow_sequences();a.clickShow_selected_atom();a.clickCommand_apply();a.clickReload_pdb();a.clickReload_pdbfile();a.clickReload_mmcif();a.clickReload_mmdb();a.clickReload_gi();a.clickReload_cid();a.clickReload_state();a.clickApplycustomcolor();a.clickApplypick_aroundsphere();a.clickApplyhbonds();a.clickApplypick_labels();a.clickApplypick_measuredistance();a.clickReset();a.clickToggleHighlight();a.clickSviewer();a.pressCommandtext();a.clickFilter_ckbx_all();a.clickFilter();a.clickLabel_3d_diagram();a.clickStopSelection();a.bindMouseup();a.bindMousedown();a.windowResize()}};